<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Analyzer & Content Creator</title>
    <script>
        // Verificar autentica√ß√£o antes de carregar a p√°gina
        (function() {
            fetch('/api/check-auth')
                .then(response => response.json())
                .then(data => {
                    if (!data.authenticated) {
                        window.location.href = '/login.html';
                    }
                })
                .catch(error => {
                    console.error('Erro ao verificar autentica√ß√£o:', error);
                    window.location.href = '/login.html';
                });
        })();
    </script>
    <style>
        /* Estilos para o modal de reescrita */
        .rewrite-modal {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .rewrite-modal.active {
            opacity: 1 !important;
            visibility: visible !important;
            display: flex !important;
        }
        
        .rewrite-modal .modal-content {
            transform: scale(0.8);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        .rewrite-modal.active .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        :root {
            --background-color: #0a0a0a;
            --surface-color: #1a1a1a;
            --border-color: #383838;
            --text-primary: #ffffff;
            --text-secondary: #acacac;
            --primary-color: #10a37f;
            --primary-dark: #0d8c6e;
            --accent-color: #8e44ad;
            --error-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --modal-bg: rgba(0, 0, 0, 0.8);
            --modal-content-bg: #1a1a1a;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        /* Animated background */
        /* body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(16, 163, 127, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(218, 112, 214, 0.05) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
            z-index: -1;
        } */

        @keyframes backgroundShift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(-20px, -10px) rotate(1deg); }
            66% { transform: translate(20px, 10px) rotate(-1deg); }
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            height: 100vh;
            position: fixed;
            padding: 24px;
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 700;
            color: white;
            box-shadow: 0 8px 32px rgba(16, 163, 127, 0.3);
        }

        .brand-text {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .new-chat-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            border: none;
            border-radius: 12px;
            padding: 16px 20px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            margin-bottom: 24px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 14px;
            box-shadow: 0 4px 20px rgba(16, 163, 127, 0.3);
        }
        
        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(16, 163, 127, 0.4);
        }

        .new-chat-btn:active {
            transform: translateY(0);
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) transparent;
        }
        
        .nav-header {
            font-size: 12px;
            color: var(--text-muted);
            padding: 16px 0 8px 0;
            margin-top: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .nav-item {
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            margin-bottom: 4px;
            font-size: 14px;
            font-weight: 400;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(16, 163, 127, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .nav-item:hover {
            background: var(--surface-hover);
            transform: translateX(4px);
        }

        .nav-item:hover::before {
            left: 100%;
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, rgba(16, 163, 127, 0.15), rgba(102, 126, 234, 0.15));
            border-left: 3px solid var(--primary-color);
            color: var(--primary-color);
        }

        .nav-item-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .sidebar-footer {
            border-top: 1px solid var(--border-color);
            padding-top: 16px;
        }
        
        .logout-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
            font-size: 14px;
        }
        
        .logout-btn:hover {
            background: rgba(231, 76, 60, 0.2);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: rgba(13, 17, 23, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            width: 100%;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            text-align: center;
            padding: 32px 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            margin: 0 -24px 0 -24px;
        }

        .header h1 {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--accent-color));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 400;
            opacity: 0.9;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 140px);
            overflow: hidden;
            margin-top: 24px;
        }

        .tabs {
            display: flex;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 16px 16px 0 0;
            border: 1px solid var(--glass-border);
            border-bottom: none;
            overflow: hidden;
        }

        .tab {
            flex: 1;
            padding: 16px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            position: relative;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .tab.active {
            color: var(--text-primary);
            background: rgba(16, 163, 127, 0.1);
        }

        .tab.active::before {
            width: 80%;
        }

        .tab:hover:not(.active) {
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        .tab-content {
            flex: 1;
            display: none;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-top: none;
            border-radius: 0 0 16px 16px;
        }

        .tab-content.active {
            display: flex;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            scroll-behavior: smooth;
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) transparent;
            -webkit-overflow-scrolling: touch; /* Melhora rolagem em dispositivos iOS */
        }
        
        /* Garantir que o chat continue rol√°vel em dispositivos m√≥veis */
        @media (max-width: 1024px) {
            .messages {
                -webkit-overflow-scrolling: touch;
                overflow-y: auto !important;
                max-height: calc(100vh - 250px);
            }
            
            #chat-messages {
                padding-bottom: 100px; /* Espa√ßo extra para o bot√£o de reescrita */
            }
        }
        
        /* Estilos para o modal de reescrita */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--modal-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: var(--modal-content-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 22px;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .message-row {
            margin-bottom: 24px;
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-row.user .message {
            background: linear-gradient(135deg, rgba(16, 163, 127, 0.1), rgba(102, 126, 234, 0.1));
            border: 1px solid rgba(16, 163, 127, 0.2);
            margin-left: auto;
            max-width: 80%;
            border-radius: 20px 20px 4px 20px;
        }
        
        .message-row.bot .message {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            max-width: 85%;
            border-radius: 20px 20px 20px 4px;
        }

        .message {
            padding: 20px 24px;
            display: flex;
            gap: 16px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .message:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            font-size: 14px;
            flex-shrink: 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        }

        .message-content {
            flex: 1;
            line-height: 1.7;
            color: var(--text-primary);
            position: relative;
        }

        .input-container {
            padding: 24px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
        }

        .input-form {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
        }

        .input-group {
            flex: 1;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .input-group textarea,
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 16px 56px 16px 20px;
            background: var(--surface-color);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
            color: var(--text-primary);
            resize: none;
            font-family: inherit;
        }
        
        .input-group textarea {
            min-height: 56px;
            max-height: 200px;
        }

        .input-group textarea:focus,
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(16, 163, 127, 0.1);
            background: var(--surface-hover);
        }
        
        .send-button {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(16, 163, 127, 0.3);
            position: absolute;
            right: 8px;
            bottom: 8px;
        }

        .send-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 32px rgba(16, 163, 127, 0.4);
        }
        
        .send-button:active {
            transform: translateY(0) scale(0.98);
        }

        .send-button:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
            opacity: 0.5;
            transform: none;
        }

        /* Loading animations */
        .loading {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-secondary);
            font-style: italic;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(16, 163, 127, 0.3);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 0;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        /* Form components */
        .form-grid, .form-row {
            display: grid;
            gap: 16px;
            width: 100%;
        }
        
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .form-row {
            grid-template-columns: 1fr 1fr;
        }

        .form-card {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            backdrop-filter: blur(10px);
        }

        .form-card-title {
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        /* Results and content */
        .result-section {
            background: linear-gradient(135deg, rgba(16, 163, 127, 0.05), rgba(102, 126, 234, 0.05));
            border-radius: 16px;
            padding: 24px;
            margin-top: 20px;
            border-left: 4px solid var(--primary-color);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }

        .result-section h3 {
            color: var(--primary-color);
            margin-bottom: 16px;
            font-weight: 600;
            font-size: 18px;
        }

        /* Buttons */
        .create-button, .copy-all-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 24px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 20px rgba(16, 163, 127, 0.3);
        }

        .create-button:hover, .copy-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(16, 163, 127, 0.4);
        }

        .copy-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }

        .copy-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        /* Chat specific styles */
        .url-input-container {
            position: relative;
            margin-bottom: 12px;
            width: 100%;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--surface-color);
            transition: all 0.3s ease;
            overflow: visible;
            display: block;
            padding: 16px;
        }
        
        .url-input-container:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(16, 163, 127, 0.2);
        }
        
        .url-input-container textarea {
            width: 100%;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            outline: none;
            color: var(--text-primary);
            font-size: 13px;
            line-height: 1.3;
            resize: none;
            font-family: inherit;
            max-height: 60px;
            overflow-y: auto;
            min-height: 36px;
            height: 36px;
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) transparent;
            margin-bottom: 8px;
        }
        
        .url-input-container textarea::-webkit-scrollbar {
            width: 6px;
        }
        
        .url-input-container textarea::-webkit-scrollbar-track {
            background: var(--surface-hover);
        }
        
        .url-input-container textarea::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }
        
        .url-input-container textarea::placeholder {
            color: var(--text-muted);
            font-style: italic;
        }
        
        #text-input-container {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        #text-input-container:focus-within {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        #text-input-container .extract-url-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        #text-input-container .extract-url-btn:hover {
            background: linear-gradient(135deg, #7b8ff7, #8659b5);
        }

        .extract-url-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 13px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            max-width: 100px;
            align-self: flex-end;
        }

        .extract-url-btn:hover {
            background: var(--primary-dark);
        }

        /* Extract options and Instagram styles */
        .extract-options {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            width: 100%;
        }

        .instagram-options {
            animation: slideDown 0.3s ease-out;
            margin-bottom: 10px;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                max-height: 200px;
                transform: translateY(0);
            }
        }

        .instagram-option {
            padding: 8px 0;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .instagram-option:hover {
            background-color: rgba(225, 19, 108, 0.05);
        }
        
        .chat-input-container {
            position: relative;
        }

        #chat-input {
            width: 100%;
            padding: 16px 56px 16px 20px;
            background: var(--surface-color);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            outline: none;
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.5;
            resize: none;
            font-family: inherit;
            transition: all 0.3s ease;
            min-height: 56px; /* Altura m√≠nima para evitar que seja cortado */
            height: auto; /* Garantir que a altura seja calculada automaticamente */
            overflow-y: hidden; /* Evitar barras de rolagem desnecess√°rias */
        }

        #chat-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(16, 163, 127, 0.1);
            background: var(--surface-hover);
        }

        #chat-input::placeholder {
            color: var(--text-muted);
            font-style: italic;
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 260px;
            }
            
            .main-content {
                margin-left: 260px;
            }

            .header h1 {
                font-size: 2rem;
            }
        }

        /* Estilos para tablets (iPad) */
        @media (min-width: 768px) and (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }
            
            .main-content {
                margin-left: 240px;
            }
            
            /* Ajustes espec√≠ficos para o bot√£o de reescrita em iPad */
            .rewrite-btn {
                padding: 15px !important;
                font-size: 16px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                margin-top: 20px !important;
                position: relative !important;
                z-index: 10 !important;
            }
            
            .rewrite-btn-icon {
                margin-right: 10px !important;
                font-size: 18px !important;
            }
            
            .rewrite-btn-text {
                font-weight: bold !important;
            }
            
            /* Garantir que as op√ß√µes de reescrita sejam vis√≠veis */
            #rewrite-options {
                max-height: none !important;
                overflow: visible !important;
            }
            
            /* Ajustar espa√ßamento para melhor visualiza√ß√£o */
            .rewrite-option {
                margin-bottom: 15px !important;
            }
        }
        
        /* Estilos para dispositivos m√≥veis */
        @media (max-width: 767px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
                z-index: 1000;
                position: fixed;
                top: 0;
                bottom: 0;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 0 16px;
            }

            .header {
                margin: 0 -16px 0 -16px;
                padding: 24px 16px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                min-width: 50%;
                padding: 12px 16px;
                font-size: 13px;
            }
            
            /* Ajustes para o painel de reescrita humanizada em dispositivos m√≥veis */
            .rewrite-options-grid {
                grid-template-columns: 1fr !important;
            }
            
            #rewrite-options {
                padding: 10px !important;
            }
            
            .rewrite-btn {
                padding: 15px 10px !important;
                font-size: 14px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                margin-top: 20px !important;
                position: sticky !important;
                bottom: 0 !important;
                z-index: 10 !important;
            }
            
            .rewrite-btn-icon {
                margin-right: 8px !important;
            }
            
            /* Bot√£o para mostrar mat√©rias salvas em dispositivos m√≥veis */
            .saved-articles-mobile-btn {
                display: block !important;
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(135deg, var(--accent-color), #9b59b6);
                color: white;
                border: none;
                border-radius: 50%;
                width: 60px;
                height: 60px;
                font-size: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 16px rgba(142, 68, 173, 0.4);
                z-index: 999;
            }
        }

        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(16, 163, 127, 0.3);
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
        }

        /* Scrollbar styling */
        .messages::-webkit-scrollbar,
        .sidebar-nav::-webkit-scrollbar {
            width: 6px;
        }

        .messages::-webkit-scrollbar-track,
        .sidebar-nav::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages::-webkit-scrollbar-thumb,
        .sidebar-nav::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .messages::-webkit-scrollbar-thumb:hover,
        .sidebar-nav::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Copy notification */
        .copy-notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 500;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(16, 163, 127, 0.4);
        }

        .copy-notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Feature cards for create tab */
        .feature-title {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.8rem;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .feature-description {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .info-card {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.05));
            border: 1px solid rgba(255, 193, 7, 0.2);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 16px;
        }

        .info-card-header {
            padding: 12px 20px;
            background: rgba(255, 193, 7, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid rgba(255, 193, 7, 0.2);
        }

        .info-title {
            font-weight: 600;
            color: #ffc107;
        }

        .info-card-content {
            padding: 16px 20px;
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Enhanced animations */
        @keyframes slideInFromLeft {
            from {
                transform: translateX(-30px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideInFromRight {
            from {
                transform: translateX(30px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .message-row.user {
            animation: slideInFromRight 0.5s ease-out;
        }

        .message-row.bot {
            animation: slideInFromLeft 0.5s ease-out;
        }

        /* Glassmorphism effects */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
        }

        /* Hover effects */
        .interactive-hover {
            transition: all 0.3s ease;
        }

        .interactive-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        /* Estilos para as op√ß√µes de reescrita */
        .chat-options {
            margin-top: 12px;
            padding: 10px 0;
        }
        
        .chat-option-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
        }
        
        .chat-option-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--primary-color);
        }
        
        .rewrite-options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .rewrite-option {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .rewrite-option label {
            color: var(--text-secondary);
            font-size: 13px;
        }
        
        .rewrite-option select {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
        }
        
        .rewrite-info {
            color: var(--primary-color);
            font-size: 12px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .rewrite-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 13px;
            margin-top: 8px;
        }
        
        .rewrite-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3);
        }
        
        /* Estilos para edi√ß√£o de texto */
        .editor-container {
            width: 100%;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            overflow: hidden;
            background: var(--surface-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .editor-toolbar {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px;
            background: var(--surface-hover);
            border-bottom: 1px solid var(--border-color);
        }
        
        .editor-toolbar button {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
        }
        
        .editor-toolbar button:hover {
            background: var(--surface-hover);
        }
        
        .editor-toolbar .separator {
            width: 1px;
            height: 20px;
            background: var(--border-color);
            margin: 0 4px;
        }
        
        .message-editable {
            width: 100%;
            min-height: 200px;
            padding: 16px;
            background: var(--surface-color);
            color: var(--text-primary);
            border: none;
            resize: vertical;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .message-editable:focus {
            outline: none;
        }
        
        .edit-actions {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: var(--surface-hover);
            border-top: 1px solid var(--border-color);
        }
        
        .edit-actions button {
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }
        
        .save-edit-btn {
            background: var(--primary-color);
            color: white;
            border: none;
        }
        
        .save-edit-btn:hover {
            background: var(--primary-dark);
        }
        
        .cancel-edit-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        
        .cancel-edit-btn:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .edit-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .message-content:hover .edit-controls {
            opacity: 1;
        }
        
        .edit-btn {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s ease;
        }
        
        .edit-btn:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }
        
        .editor-tip {
            padding: 8px;
            background: rgba(16, 163, 127, 0.1);
            color: var(--text-secondary);
            font-size: 12px;
            text-align: center;
            border-top: 1px solid rgba(16, 163, 127, 0.2);
        }
        
        .saved-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--success-color);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        .saved-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Estilos para o di√°logo de link */
        .link-dialog {
            position: absolute;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            width: 300px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }
        
        .link-dialog div {
            margin-bottom: 12px;
        }
        
        .link-dialog label {
            display: block;
            margin-bottom: 4px;
            color: var(--text-secondary);
            font-size: 13px;
        }
        
        .link-dialog input {
            width: 100%;
            padding: 8px 12px;
            background: var(--surface-hover);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .link-dialog input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .link-dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 16px;
        }
        
        .link-dialog button {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }
        
        .add-link-btn {
            background: var(--primary-color);
            color: white;
            border: none;
        }
        
        .cancel-link-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        
        /* Estilos para o conte√∫do reescrito */
        .rewritten-content {
            width: 100%;
        }
        
        .tag {
            background: rgba(16, 163, 127, 0.1);
            color: var(--primary-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
            display: inline-block;
        }
        
        /* Estilos para artigos formatados */
        .article-formatted {
            width: 100%;
        }
        
        .article-section {
            margin-bottom: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .section-header h4 {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }
        
        .section-content {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--border-color);
        }
        
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .keyword {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .article-content {
            white-space: pre-wrap;
            line-height: 1.6;
        }
        
        .content-with-copy {
            position: relative;
        }
        
        .content-copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            z-index: 10;
        }
        
        .article-content-section {
            margin-top: 30px;
        }
        
        .extracted-content-banner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(16, 163, 127, 0.15), rgba(16, 163, 127, 0.05));
            padding: 14px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(16, 163, 127, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .extracted-content-banner p {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            color: var(--primary-color);
        }
        
        .extracted-content-banner button {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .extracted-content-banner button:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }
        
        .extracted-content-banner button::before {
            content: 'üóëÔ∏è';
            font-size: 10px;
        }
        
        /* Estilo para mensagens pr√©-formatadas */
        .pre-formatted {
            white-space: pre-wrap;
            line-height: 1.6;
        }
        
        /* Estilos para o chat de artigos */
        .article-chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(22, 27, 34, 0.3);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .article-chat-input {
            position: relative;
            margin-top: 12px;
        }
        
        #article-chat-input {
            width: 100%;
            padding: 16px 56px 16px 20px;
            background: var(--surface-color);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            outline: none;
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.5;
            resize: none;
            font-family: inherit;
            transition: all 0.3s ease;
            min-height: 56px;
            max-height: 200px;
        }
        
        #article-chat-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(16, 163, 127, 0.1);
            background: var(--surface-hover);
        }
        
        #article-chat-input::placeholder {
            color: var(--text-muted);
            font-style: italic;
        }
        
        .article-chat-input .send-button {
            position: absolute;
            right: 8px;
            bottom: 8px;
        }
        
        .chat-instruction {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 16px;
            font-style: italic;
        }

        /* Estilos para itens de URL extra√≠dos */
        .extracted-urls-summary {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .extracted-url-item {
            background: rgba(22, 27, 34, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .extracted-url-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border-color: var(--primary-color);
        }
        
        .extracted-url-item h4 {
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .url-source {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
            word-break: break-all;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .url-source::before {
            content: 'üîó';
            font-size: 10px;
        }
        
        .word-count {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: rgba(255, 255, 255, 0.05);
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .word-count::before {
            content: 'üìù';
            font-size: 10px;
        }
        
        .content-preview {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-top: 8px;
            border-left: 2px solid var(--primary-color);
            padding-left: 12px;
            background: rgba(16, 163, 127, 0.05);
            padding: 10px 12px;
            border-radius: 0 8px 8px 0;
        }
        
        /* Estilos para integra√ß√£o com WordPress */
        .wordpress-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .wordpress-modal.show {
            opacity: 1;
            visibility: visible;
            display: flex !important;
            pointer-events: auto !important;
        }
        
        .wordpress-modal-content {
            width: 600px;
            max-width: 90%;
            background: var(--surface-color);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            overflow: hidden;
        }
        
        .wordpress-modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .wordpress-modal-header h2 {
            margin: 0;
            color: var(--primary-color);
            font-size: 20px;
        }
        
        .wordpress-modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
        }
        
        .wordpress-modal-body {
            padding: 20px;
            overflow-y: auto;
        }
        
        .wordpress-form-group {
            margin-bottom: 20px;
        }
        
        .wordpress-form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .wordpress-form-group input, 
        .wordpress-form-group select {
            width: 100%;
            padding: 12px 15px;
            background: var(--surface-hover);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .wordpress-form-group input:focus, 
        .wordpress-form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .wordpress-form-group .help-text {
            margin-top: 5px;
            color: var(--text-muted);
            font-size: 12px;
            font-style: italic;
        }
        
        .wordpress-modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .wordpress-save-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .wordpress-save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 163, 127, 0.3);
        }
        
        .wordpress-test-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .wordpress-test-btn:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }
        
        .wordpress-publish-btn {
            background: linear-gradient(135deg, #0073aa, #005177);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        .wordpress-publish-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 115, 170, 0.3);
        }
        
        .wordpress-publish-btn::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 19.5c-5.2 0-9.5-4.3-9.5-9.5S6.8 2.5 12 2.5s9.5 4.3 9.5 9.5-4.3 9.5-9.5 9.5zm3.536-12.964l-4.95 4.95-2.12-2.122-1.415 1.415 3.535 3.535 6.364-6.364-1.414-1.414z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }
        
        .wordpress-status {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .wordpress-status.success {
            background: rgba(35, 134, 54, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
            display: block;
        }
        
        .wordpress-status.error {
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid var(--warning-color);
            color: var(--warning-color);
            display: block;
        }
        
        .wordpress-status.loading {
            background: rgba(16, 163, 127, 0.1);
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .wordpress-status.loading::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(16, 163, 127, 0.3);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .wordpress-preview-section {
            margin-top: 20px;
            padding: 15px;
            background: var(--surface-hover);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .wordpress-preview-section h3 {
            margin-top: 0;
            color: var(--text-secondary);
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .wordpress-preview-item {
            margin-bottom: 12px;
        }
        
        .wordpress-preview-item .label {
            color: var(--text-muted);
            font-size: 12px;
            margin-bottom: 3px;
        }
        
        .wordpress-preview-item .value {
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .empty-state-message {
            text-align: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px dashed var(--border-color);
            margin-bottom: 12px;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .empty-state-message p {
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* Estilos para os bot√µes de adicionar conte√∫do */
        .add-content-buttons {
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px dashed var(--border-color);
            text-align: center;
            animation: fadeInUp 0.3s ease-out;
        }

        .add-content-btn {
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .add-content-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .add-content-btn:active {
            transform: translateY(0);
        }

        /* Anima√ß√£o para os campos de entrada */
        .url-input-container, .text-input-container {
            transition: all 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Estilos adicionais para os bot√µes */
        .add-content-btn:nth-child(3) {
            background: linear-gradient(135deg, #8e44ad, #9b59b6) !important;
        }

        .add-content-btn:nth-child(3):hover {
            background: linear-gradient(135deg, #9b59b6, #a569c7) !important;
        }

        #show-options-btn button:hover {
            background: rgba(16, 163, 127, 0.2) !important;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <button id="mobile-menu-btn" class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
    <button id="saved-articles-mobile-btn" class="saved-articles-mobile-btn" onclick="toggleSidebar()" style="display: none;">üíæ</button>
    
    <div class="sidebar" id="sidebar">
        <button class="new-chat-btn" onclick="startNewChat()">
            <span>Nova conversa</span>
            <span>+</span>
        </button>
        
        <div class="sidebar-nav">
            <div class="nav-header">Ferramentas</div>
            <div class="nav-item" onclick="switchTab('chat')">üí¨ Chat Geral</div>
            <div class="nav-item" onclick="switchTab('seo')">üîç An√°lise SEO</div>
            <div class="nav-item" onclick="switchTab('rewrite')">‚úçÔ∏è Reescrever Conte√∫do</div>
            <div class="nav-item" onclick="switchTab('create')">üì∞ Criar Mat√©ria</div>
            
            <div class="nav-header">Mat√©rias Salvas</div>
            <div id="saved-articles-container">
                <!-- As mat√©rias salvas ser√£o exibidas aqui -->
                <div class="empty-saved-articles">Nenhuma mat√©ria salva</div>
            </div>
        </div>
        
        <div class="sidebar-footer">
            <div class="nav-item" onclick="showWordPressConfigModal()">‚öôÔ∏è Configura√ß√µes WordPress</div>
            <div class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Sair do sistema
            </div>
        </div>
    </div>

    <!-- Adicionar o modal de configura√ß√£o do WordPress -->
    <div id="wordpress-config-modal" class="wordpress-modal">
        <div class="wordpress-modal-content">
            <div class="wordpress-modal-header">
                <h2>üîå Configura√ß√µes do WordPress</h2>
                <button class="wordpress-modal-close" onclick="closeWordPressModal()">&times;</button>
            </div>
            <div class="wordpress-modal-body">
                <div class="wordpress-form-group">
                    <label for="wp-site-url">URL do Site WordPress</label>
                    <input type="url" id="wp-site-url" placeholder="https://seusite.com.br">
                    <p class="help-text">URL completa do seu site WordPress</p>
                </div>
                <div class="wordpress-form-group">
                    <label for="wp-username">Nome de usu√°rio</label>
                    <input type="text" id="wp-username" placeholder="Seu nome de usu√°rio">
                </div>
                <div class="wordpress-form-group">
                    <label for="wp-app-password">Senha de aplicativo</label>
                    <input type="password" id="wp-app-password" placeholder="Senha de aplicativo do WordPress">
                    <p class="help-text">Use uma <a href="https://make.wordpress.org/core/2020/11/05/application-passwords-integration-guide/" target="_blank" style="color: var(--primary-color);">senha de aplicativo</a> para maior seguran√ßa</p>
                </div>
                <div class="wordpress-form-group">
                    <label for="wp-default-category">Categoria padr√£o</label>
                    <input type="text" id="wp-default-category" placeholder="ID da categoria (ex: 1)">
                    <p class="help-text">ID num√©rico da categoria padr√£o para publica√ß√µes</p>
                </div>
                <div class="wordpress-form-group">
                    <label for="wp-default-status">Status padr√£o de publica√ß√£o</label>
                    <select id="wp-default-status">
                        <option value="draft">Rascunho</option>
                        <option value="publish">Publicar imediatamente</option>
                        <option value="pending">Pendente de revis√£o</option>
                    </select>
                </div>
                <div class="wordpress-status" id="wordpress-connection-status"></div>
            </div>
            <div class="wordpress-modal-footer">
                <button class="wordpress-test-btn" onclick="testWordPressConnection()">Testar Conex√£o</button>
                <button class="wordpress-save-btn" onclick="saveWordPressConfig()">Salvar Configura√ß√µes</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de publica√ß√£o no WordPress -->
    <div id="wordpress-publish-modal" class="wordpress-modal">
        <div class="wordpress-modal-content">
            <div class="wordpress-modal-header">
                <h2>üì§ Publicar no WordPress</h2>
                <button class="wordpress-modal-close" onclick="closeWordPressPublishModal()">&times;</button>
            </div>
            <div class="wordpress-modal-body">
                <div class="wordpress-preview-section">
                    <h3>Pr√©-visualiza√ß√£o do conte√∫do</h3>
                    <div class="wordpress-preview-item">
                        <div class="label">T√≠tulo:</div>
                        <div class="value" id="wp-preview-title"></div>
                    </div>
                    <div class="wordpress-preview-item">
                        <div class="label">Subt√≠tulo (Resumo):</div>
                        <div class="value" id="wp-preview-subtitle"></div>
                    </div>
                    <div class="wordpress-preview-item">
                        <div class="label">Tags:</div>
                        <div class="value" id="wp-preview-tags"></div>
                    </div>
                    <div class="wordpress-preview-item">
                        <div class="label">Palavra-chave:</div>
                        <div class="value" id="wp-preview-keyword"></div>
                    </div>
                </div>
                
                <div class="wordpress-form-group">
                    <label for="wp-post-category">Categoria</label>
                    <input type="text" id="wp-post-category" placeholder="ID da categoria">
                    <p class="help-text">Deixe em branco para usar a categoria padr√£o</p>
                </div>
                
                <div class="wordpress-form-group">
                    <label for="wp-post-status">Status da publica√ß√£o</label>
                    <select id="wp-post-status">
                        <option value="draft">Rascunho</option>
                        <option value="publish">Publicar imediatamente</option>
                        <option value="pending">Pendente de revis√£o</option>
                    </select>
                </div>
                
                <div class="wordpress-status" id="wordpress-publish-status"></div>
                
                <button class="wordpress-publish-btn" onclick="publishToWordPress()">Publicar no WordPress</button>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="container">
           

            <div class="chat-container">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('chat')">üí¨ Chat Geral</button>
                    <button class="tab" onclick="switchTab('seo')">üîç An√°lise SEO</button>
                    <button class="tab disabled" style="opacity: 0.5; cursor: not-allowed; pointer-events: none;" title="Temporariamente indispon√≠vel">‚úçÔ∏è Reescrever</button>
                    <button class="tab disabled" style="opacity: 0.5; cursor: not-allowed; pointer-events: none;" title="Temporariamente indispon√≠vel">üì∞ Criar Mat√©ria</button>
                </div>

                <!-- Chat Geral -->
                <div id="chat-tab" class="tab-content active">
                    <div class="messages" id="chat-messages">
                        <div class="message-row bot">
                            <div class="message">
                                <div class="message-avatar">ü§ñ</div>
                                <div class="message-content">
                                    <p>Ol√°! Eu sou uma IA assistente. Voc√™ pode me fazer perguntas gerais ou extrair conte√∫do de uma URL para interagir com ele.</p>
                                    <p style="margin-top: 10px;"><strong>Novidade:</strong> Agora voc√™ pode editar minhas respostas! Basta passar o mouse sobre qualquer resposta e clicar no bot√£o "Editar" que aparece no canto superior direito.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-area">
                        <div class="url-input-container" id="url-input-container">
                            <textarea id="url-extract-input" placeholder="Cole uma ou mais URLs para extrair conte√∫do (uma URL por linha)..." rows="3" oninput="autoResizeUrl(this)"></textarea>
                            <div class="extract-options">
                                <div class="instagram-options" style="display: none; margin: 10px 0; padding: 10px; background: rgba(225, 19, 108, 0.1); border-radius: 8px; border: 1px solid rgba(225, 19, 108, 0.3);">
                                    <label style="color: #E1306C; font-weight: 500; display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <span style="font-size: 18px;">üì±</span>
                                        <span>Op√ß√µes para Instagram:</span>
                                    </label>
                                    <label class="instagram-option" style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: var(--text-primary);">
                                        <input type="checkbox" id="include-video-transcription" checked style="width: 16px; height: 16px; accent-color: #E1306C;">
                                        <span style="font-size: 14px;">üé¨ Baixar e transcrever v√≠deos (processo mais lento, mas com transcri√ß√£o completa)</span>
                                    </label>
                                    <p style="margin: 8px 0 0 24px; font-size: 12px; color: var(--text-secondary); font-style: italic;">
                                        ‚úÖ Marcado = Texto + Coment√°rios + Transcri√ß√£o de v√≠deo<br>
                                        ‚ùå Desmarcado = Apenas texto + Coment√°rios (mais r√°pido)
                                    </p>
                                </div>
                                <button class="extract-url-btn" onclick="extractUrlContent()">Extrair</button>
                            </div>
                        </div>
                        <div class="url-input-container" id="text-input-container">
                            <textarea id="text-extract-input" placeholder="Ou cole aqui um texto para analisar ou reescrever (artigos, not√≠cias, conte√∫do)..." rows="3" oninput="autoResizeText(this)"></textarea>
                            <div class="extract-options">
                                <button class="extract-url-btn" onclick="processTextContent()">Processar</button>
                            </div>
                        </div>
                        
                        <!-- Bot√µes para adicionar mais conte√∫do (inicialmente ocultos) -->
                        <div class="add-content-buttons" id="add-content-buttons" style="display: none; margin-bottom: 12px;">
                            <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 10px;">
                                <button class="add-content-btn" onclick="showUrlInput()" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                                    <span>üîó</span> Adicionar mais URLs
                                </button>
                                <button class="add-content-btn" onclick="showTextInput()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                                    <span>üìù</span> Adicionar mais texto
                                </button>
                                <button class="add-content-btn" onclick="openRewriteModal()" style="background: linear-gradient(135deg, #8e44ad, #9b59b6); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                                    <span>‚úçÔ∏è</span> Reescrever como mat√©ria
                                </button>
                            </div>
                            <div style="text-align: center;">
                                <button onclick="hideContentOptions()" style="background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s ease;">
                                    ‚ñ≤ Ocultar op√ß√µes
                                </button>
                            </div>
                        </div>
                        
                        <div class="empty-state-message" id="empty-state-message">
                            <p>üëÜ Extraia conte√∫do de URLs ou cole um texto para come√ßar a interagir</p>
                        </div>
                        <div class="chat-input-container" id="chat-input-container" style="display: none;">
                            <textarea id="chat-input" placeholder="Digite sua mensagem... (Enter para enviar, Shift+Enter para nova linha)" rows="1" style="min-height: 56px; height: 56px;" oninput="autoResize(this)" onkeydown="handleChatKeyDown(event)"></textarea>
                            <button class="send-button" onclick="sendChatMessage()">‚û§</button>
                        </div>
                    </div>
                </div>

                <!-- An√°lise SEO -->
                <div id="seo-tab" class="tab-content">
                    <div class="messages" id="seo-messages">
                        <div class="message-row bot">
                            <div class="message">
                                <div class="message-avatar">üîç</div>
                                <div class="message-content">
                                    Digite a URL do site que deseja analisar para receber um relat√≥rio completo de SEO e sugest√µes de melhoria.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-container">
                        <div class="input-form">
                            <div class="input-group">
                                <input type="url" id="seo-url" placeholder="https://exemplo.com.br">
                                <button class="send-button" onclick="analyzeSEO()">‚û§</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reescrever Conte√∫do -->
                <div id="rewrite-tab" class="tab-content">
                    <div class="messages" id="rewrite-messages">
                        <div class="message-row bot">
                            <div class="message">
                                <div class="message-avatar">‚úçÔ∏è</div>
                                <div class="message-content">
                                    Digite a URL de um artigo para extrair e reescrever o conte√∫do de forma original, evitando pl√°gio.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-container">
                        <div class="input-form">
                            <div class="input-group" style="background-color: rgba(16, 163, 127, 0.05); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color);">
                                <h4 style="margin-top: 0; margin-bottom: 15px; color: var(--primary-color); font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 20px;">‚úçÔ∏è</span> Configura√ß√µes de Reescrita
                                </h4>
                                
                                <div class="form-row" style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; margin-bottom: 15px;">
                                    <div style="background-color: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 8px; border: 1px solid var(--border-color);">
                                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-primary);">URL do artigo:</label>
                                        <input type="url" id="rewrite-url" placeholder="https://site.com/artigo" style="width: 100%; padding: 12px; border-radius: 6px; background-color: var(--surface-color); color: white; border: 1px solid var(--border-color);">
                                    </div>
                                    <div style="background-color: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 8px; border: 1px solid var(--border-color);">
                                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-primary);">Tom da mat√©ria:</label>
                                        <select id="rewrite-tone" style="width: 100%; padding: 12px; border-radius: 6px; background-color: var(--surface-color); color: white; border: 1px solid var(--border-color);">
                                            <option value="jornal√≠stico">Jornal√≠stico</option>
                                            <option value="informal">Informal</option>
                                            <option value="t√©cnico">T√©cnico</option>
                                            <option value="opinativo">Opinativo</option>
                                    </select>
                                </div>
                                </div>
                                
                                <div class="form-row" style="margin-bottom: 15px; background-color: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 8px; border: 1px solid var(--border-color);">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-primary);">Instru√ß√µes espec√≠ficas:</label>
                                    <textarea id="rewrite-observation" placeholder="Digite instru√ß√µes espec√≠ficas para a reescrita (ex: 'Quero que o ponto central da mat√©ria seja...')" rows="4" style="width: 100%; padding: 12px; border-radius: 6px; background-color: var(--surface-color); color: white; border: 1px solid var(--border-color); min-height: 100px; resize: vertical;"></textarea>
                            </div>
                                
                                <div style="margin-bottom: 15px; padding: 10px; background-color: rgba(16, 163, 127, 0.1); border-radius: 6px;">
                                    <span style="color: var(--primary-color); font-weight: 500; display: flex; align-items: center; gap: 6px;">
                                        <span>‚úì</span> A mat√©ria ser√° reescrita com t√≠tulo, subt√≠tulo, tags e palavra-chave otimizados para SEO
                                    </span>
                                </div>
                                
                                <button class="send-button" onclick="rewriteContent()" style="width: 100%; padding: 12px; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: 600; font-size: 16px; background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); border-radius: 8px;">
                                    <span style="font-size: 18px;">‚úçÔ∏è</span>
                                    <span>Reescrever Conte√∫do</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Criar Mat√©ria -->
                <div id="create-tab" class="tab-content">
                    <div class="messages" id="create-messages">
                        <div class="message-row bot">
                            <div class="message">
                                <div class="message-avatar">üì∞</div>
                                <div class="message-content">
                                    <h3 class="feature-title">Gerador de Mat√©rias Jornal√≠sticas</h3>
                                    <p class="feature-description">Crie mat√©rias jornal√≠sticas completas e bem estruturadas com base em palavras-chave.</p>
                                    <div class="info-card">
                                        <div class="info-card-header">
                                            <span class="info-icon">‚ö†Ô∏è</span>
                                            <span class="info-title">Verifica√ß√£o de Fatos</span>
                                        </div>
                                        <div class="info-card-content">
                                            O sistema verifica a veracidade das informa√ß√µes antes de criar mat√©rias. Eventos falsos ou n√£o verific√°veis n√£o ser√£o processados.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-container">
                        <div class="form-card">
                            <h4 class="form-card-title">Configura√ß√µes da Mat√©ria</h4>
                            <div class="form-grid">
                                <div class="form-row">
                                    <div class="input-group">
                                        <label for="create-keyword">Palavra-chave ou Tema</label>
                                        <input type="text" id="create-keyword" placeholder="Ex: tecnologia, pol√≠tica, esportes">
                                    </div>
                                    <div class="input-group">
                                        <label for="create-tone">Tom da Mat√©ria</label>
                                        <select id="create-tone">
                                            <option value="jornal√≠stico">Jornal√≠stico</option>
                                            <option value="informal">Informal</option>
                                            <option value="t√©cnico">T√©cnico</option>
                                            <option value="opinativo">Opinativo</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="options-group">
                                    <label class="options-label">Op√ß√µes de Pesquisa</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="use-google" checked>
                                            <label for="use-google">Pesquisar na web</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="use-gnews">
                                            <label for="use-gnews">Incluir GNews</label>
                                        </div>
                                    </div>
                                </div>
                                <button class="create-button" onclick="createArticle()">
                                    <span class="button-icon">üìù</span>
                                    <span class="button-text">Gerar Mat√©ria</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Reescrita -->
    <div id="rewrite-modal" class="rewrite-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.8); display: none; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;">
        <div class="modal-content" style="background-color: var(--surface-color); border-radius: 12px; border: 1px solid var(--border-color); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);">
            <div style="padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between;">
                <h2 style="margin: 0; color: var(--primary-color); font-size: 18px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">‚úçÔ∏è</span> Reescrever como mat√©ria humanizada
                </h2>
                <button onclick="closeRewriteModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 22px; cursor: pointer;">&times;</button>
            </div>
            <div style="padding: 20px;">
                <!-- Op√ß√µes de Tom e Tamanho -->
                <div style="margin-bottom: 20px;">
                    <div class="rewrite-options-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div class="rewrite-option" style="background-color: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
                            <label for="rewrite-tone-chat" style="font-weight: 500; color: var(--text-primary); margin-bottom: 8px; display: block;">Tom da mat√©ria:</label>
                            <select id="rewrite-tone-chat" style="width: 100%; padding: 10px; border-radius: 6px; background-color: var(--surface-color); color: white; border: 1px solid var(--border-color);">
                                <option value="jornal√≠stico">Jornal√≠stico</option>
                                <option value="informal">Informal</option>
                                <option value="t√©cnico">T√©cnico</option>
                                <option value="opinativo">Opinativo</option>
                            </select>
                        </div>
                        <div class="rewrite-option" style="background-color: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
                            <label for="rewrite-length-chat" style="font-weight: 500; color: var(--text-primary); margin-bottom: 8px; display: block;">Tamanho do texto:</label>
                            <select id="rewrite-length-chat" style="width: 100%; padding: 10px; border-radius: 6px; background-color: var(--surface-color); color: white; border: 1px solid var(--border-color);">
                                <option value="m√©dio">M√©dio</option>
                                <option value="curto">Curto</option>
                                <option value="longo">Longo</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Op√ß√£o de remover subt√≠tulos -->
                <div style="margin-bottom: 20px;">
                    <div class="rewrite-option" style="background-color: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
                        <label class="chat-option-item" style="font-weight: 500; color: var(--text-primary); display: flex; align-items: center; margin-bottom: 0;">
                            <input type="checkbox" id="remove-subtitles" style="width: 16px; height: 16px; margin-right: 8px;">
                            <span style="font-size: 14px;">Remover subt√≠tulos/t√≥picos da mat√©ria</span>
                        </label>
                    </div>
                </div>
                
                <!-- Instru√ß√µes espec√≠ficas -->
                <div style="margin-bottom: 20px;">
                    <div class="rewrite-option" style="background-color: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
                        <label for="rewrite-observation" style="font-weight: 500; color: var(--text-primary); margin-bottom: 8px; display: block;">Instru√ß√µes espec√≠ficas:</label>
                        <textarea id="rewrite-observation" placeholder="Digite instru√ß√µes espec√≠ficas para a reescrita (ex: 'Quero que o ponto central da mat√©ria seja...')" rows="3" style="width: 100%; padding: 12px; border-radius: 6px; background-color: var(--surface-color); color: white; border: 1px solid var(--border-color); min-height: 80px; resize: vertical;"></textarea>
                    </div>
                </div>
            </div>
            <div style="padding: 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end;">
                <button id="start-rewrite-btn" onclick="startRewrite()" style="width: 100%; padding: 15px; font-weight: 600; font-size: 16px; border-radius: 8px; background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                    <span style="margin-right: 10px; font-size: 18px;">‚úçÔ∏è</span>
                    <span>Iniciar Reescrita Humanizada</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'chat';
        let sidebarOpen = false;
        
        // Fun√ß√µes para controlar o modal de reescrita
        function openRewriteModal() {
            const modal = document.getElementById('rewrite-modal');
            if (modal) {
                modal.style.display = 'flex';
                // For√ßar um reflow
                modal.offsetHeight;
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Transferir valores dos campos
                if (document.getElementById('rewrite-tone-chat')) {
                    const modalTone = document.getElementById('modal-rewrite-tone');
                    if (modalTone) {
                        modalTone.value = document.getElementById('rewrite-tone-chat').value;
                    }
                }
                
                if (document.getElementById('rewrite-length-chat')) {
                    const modalLength = document.getElementById('modal-rewrite-length');
                    if (modalLength) {
                        modalLength.value = document.getElementById('rewrite-length-chat').value;
                    }
                }
                
                if (document.getElementById('remove-subtitles')) {
                    const modalSubtitles = document.getElementById('modal-remove-subtitles');
                    if (modalSubtitles) {
                        modalSubtitles.checked = document.getElementById('remove-subtitles').checked;
                    }
                }
                
                if (document.getElementById('rewrite-observation')) {
                    const modalObservation = document.getElementById('modal-rewrite-observation');
                    if (modalObservation) {
                        modalObservation.value = document.getElementById('rewrite-observation').value;
                    }
                }
            }
        }
        
        function closeRewriteModal() {
            const modal = document.getElementById('rewrite-modal');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => {
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                }, 300);
            }
        }
        
        // Fun√ß√£o para alternar a exibi√ß√£o da sidebar em dispositivos m√≥veis
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebarOpen = !sidebarOpen;
            
            if (sidebarOpen) {
                sidebar.classList.add('mobile-open');
            } else {
                sidebar.classList.remove('mobile-open');
            }
        }
        
        // Verificar o tamanho da tela ao carregar e redimensionar
        function checkScreenSize() {
            const isMobile = window.innerWidth <= 768;
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const savedArticlesMobileBtn = document.getElementById('saved-articles-mobile-btn');
            
            if (isMobile) {
                mobileMenuBtn.style.display = 'block';
                savedArticlesMobileBtn.style.display = 'flex';
            } else {
                mobileMenuBtn.style.display = 'none';
                savedArticlesMobileBtn.style.display = 'none';
                // Garantir que a sidebar esteja vis√≠vel em telas maiores
                document.getElementById('sidebar').classList.remove('mobile-open');
                sidebarOpen = false;
            }
        }
        
        // Adicionar ouvinte de evento para redimensionamento da janela
        window.addEventListener('resize', checkScreenSize);
        
        // Verificar tamanho da tela ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            checkScreenSize();
        });

        function autoResize(textarea) {
            // Salvar a posi√ß√£o de scroll atual
            const scrollPos = window.scrollY;
            
            // Resetar a altura para calcular corretamente, mas manter uma altura m√≠nima
            textarea.style.height = 'auto';
            
            // Definir a nova altura com base no conte√∫do, com um m√≠nimo de 56px
            const minHeight = 56; // Altura m√≠nima em pixels
            const newHeight = Math.max(minHeight, Math.min(textarea.scrollHeight, 200));
            textarea.style.height = newHeight + 'px';
            
            // Configurar overflow com base na altura
            if (textarea.scrollHeight > 200) {
                textarea.style.overflowY = 'auto';
            } else {
                textarea.style.overflowY = 'hidden';
            }
            
            // Restaurar a posi√ß√£o de scroll para evitar saltos na p√°gina
            window.scrollTo(0, scrollPos);
            
            // Focar no textarea se ainda n√£o estiver focado
            if (document.activeElement !== textarea) {
                textarea.focus();
                // Posicionar o cursor no final do texto
                textarea.selectionStart = textarea.selectionEnd = textarea.value.length;
            }
            
            // Verificar se a altura √© zero ou muito pequena e corrigir
            if (parseInt(textarea.style.height) < minHeight) {
                textarea.style.height = minHeight + 'px';
            }
        }

        function handleChatKeyDown(event) {
            // Verificar se √© a tecla Enter sem Shift
            if (event.key === 'Enter' && !event.shiftKey) {
                // Prevenir a quebra de linha padr√£o
                event.preventDefault();
                
                // Verificar se a op√ß√£o de reescrita est√° ativada
                const rewriteAsHuman = document.getElementById('rewrite-as-human').checked;
                
                if (rewriteAsHuman) {
                    // Se a op√ß√£o de reescrita estiver ativada, iniciar a reescrita
                    startRewrite();
                } else {
                    // Caso contr√°rio, enviar a mensagem normalmente
                    sendChatMessage();
                }
            }
        }

        function startNewChat() {
            // Limpa todas as mensagens
            document.querySelectorAll('.messages').forEach(container => {
                const firstMsg = container.querySelector('.message-row');
                if (firstMsg) {
                    container.innerHTML = '';
                    container.appendChild(firstMsg);
                }
            });
            
            // Limpar conte√∫do extra√≠do
            extractedUrlContent = [];
            
            // Resetar estado dos campos
            resetInputState();
            
            // Remover bot√£o de mostrar op√ß√µes se existir
            const showOptionsBtn = document.getElementById('show-options-btn');
            if (showOptionsBtn) {
                showOptionsBtn.remove();
            }
            
            // Volta para o chat
            switchTab('chat');
        }

        function switchTab(tabName) {
            // Verificar se a aba est√° desativada
            if (tabName === 'rewrite' || tabName === 'create') {
                // Mostrar mensagem informativa
                alert('Esta funcionalidade est√° temporariamente indispon√≠vel.');
                return;
            }
            
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            Array.from(document.querySelectorAll('.tab')).find(tab => tab.textContent.includes(tabName === 'chat' ? 'Chat' : 
                                                                        tabName === 'seo' ? 'SEO' : 
                                                                        tabName === 'rewrite' ? 'Reescrever' : 'Mat√©ria')).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            currentTab = tabName;
        }

        function addMessage(containerSelector, type, content, avatar = null) {
            const container = document.querySelector(containerSelector);
            const messageRow = document.createElement('div');
            messageRow.className = `message-row ${type}`;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            avatarDiv.textContent = avatar || (type === 'user' ? 'üë§' : 'ü§ñ');
            
            // Substituir os caracteres \n literais por <br> para exibi√ß√£o correta
            let processedContent = content;
            if (typeof processedContent === 'string') {
                processedContent = processedContent.replace(/\\n/g, '<br>');
            }
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = processedContent;
            
            // Adicionar bot√£o de edi√ß√£o apenas para mensagens do bot
            if (type === 'bot') {
                const editControls = document.createElement('div');
                editControls.className = 'edit-controls';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'edit-btn';
                editBtn.innerHTML = '<span>‚úèÔ∏è</span> Editar';
                editBtn.onclick = function() {
                    startEditing(contentDiv);
                };
                
                const exportBtn = document.createElement('button');
                exportBtn.className = 'edit-btn';
                exportBtn.innerHTML = '<span>üìÑ</span> Exportar';
                exportBtn.onclick = function() {
                    exportText(getCleanContent(contentDiv.innerHTML));
                };
                
                editControls.appendChild(editBtn);
                editControls.appendChild(exportBtn);
                contentDiv.appendChild(editControls);
                
                // Adicionar ID √∫nico para a mensagem
                const messageId = 'msg-' + Date.now();
                contentDiv.id = messageId;
                contentDiv.dataset.originalContent = content;
            }
            
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            
            messageRow.appendChild(messageDiv);
            container.appendChild(messageRow);
            
            // Rolar para o final
            container.scrollTop = container.scrollHeight;
            
            return messageRow;
        }

        function showLoading(containerSelector) {
            const container = document.querySelector(containerSelector);
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message-row bot loading';
            loadingDiv.innerHTML = `
                <div class="message">
                    <div class="message-avatar">ü§ñ</div>
                    <div class="message-content">
                        <div class="loading-indicator">
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(loadingDiv);
            container.scrollTop = container.scrollHeight;
            return loadingDiv;
        }

        function showExtractionProgress(containerSelector) {
            const container = document.querySelector(containerSelector);
            const progressDiv = document.createElement('div');
            progressDiv.className = 'message-row bot extraction-progress';
            progressDiv.innerHTML = `
                <div class="message">
                    <div class="message-avatar">ü§ñ</div>
                    <div class="message-content">
                        <div class="progress-steps">
                            <p><span class="step-indicator" id="step-connect">‚è≥</span> <span id="step-connect-message">Conectando ao site...</span></p>
                            <p><span class="step-indicator" id="step-extract">‚è≥</span> <span id="step-extract-message">Extraindo conte√∫do...</span></p>
                            <p><span class="step-indicator" id="step-process">‚è≥</span> <span id="step-process-message">Processando texto...</span></p>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(progressDiv);
            container.scrollTop = container.scrollHeight;
            return progressDiv;
        }

        function removeLoading(loadingElement) {
            if (loadingElement && loadingElement.parentNode) {
                loadingElement.parentNode.removeChild(loadingElement);
            }
        }

        // Vari√°vel global para armazenar o conte√∫do extra√≠do
        let extractedUrlContent = [];
        
        // Fun√ß√µes para mostrar/ocultar campos de entrada
        function hideInputFields() {
            document.getElementById('url-input-container').style.display = 'none';
            document.getElementById('text-input-container').style.display = 'none';
            document.getElementById('empty-state-message').style.display = 'none';
            document.getElementById('add-content-buttons').style.display = 'block';
        }

        function showUrlInput() {
            document.getElementById('url-input-container').style.display = 'block';
            document.getElementById('text-input-container').style.display = 'none';
            document.getElementById('add-content-buttons').style.display = 'none';
            
            // Limpar e focar no campo de URL
            const urlInput = document.getElementById('url-extract-input');
            urlInput.value = '';
            urlInput.focus();
        }

        function showTextInput() {
            document.getElementById('text-input-container').style.display = 'block';
            document.getElementById('url-input-container').style.display = 'none';
            document.getElementById('add-content-buttons').style.display = 'none';
            
            // Limpar e focar no campo de texto
            const textInput = document.getElementById('text-extract-input');
            textInput.value = '';
            textInput.focus();
        }

        function resetInputState() {
            // Mostrar campos iniciais
            document.getElementById('url-input-container').style.display = 'block';
            document.getElementById('text-input-container').style.display = 'block';
            document.getElementById('add-content-buttons').style.display = 'none';
            document.getElementById('empty-state-message').style.display = 'block';
            document.getElementById('chat-input-container').style.display = 'none';
        }
        
        // Fun√ß√£o para ocultar as op√ß√µes de conte√∫do
        function hideContentOptions() {
            document.getElementById('add-content-buttons').style.display = 'none';
            
            // Mostrar um bot√£o pequeno para reabrir as op√ß√µes
            const showOptionsBtn = document.createElement('div');
            showOptionsBtn.id = 'show-options-btn';
            showOptionsBtn.style.cssText = `
                text-align: center; 
                margin-bottom: 12px; 
                animation: fadeInUp 0.3s ease-out;
            `;
            showOptionsBtn.innerHTML = `
                <button onclick="showContentOptions()" style="background: rgba(16, 163, 127, 0.1); border: 1px solid var(--primary-color); color: var(--primary-color); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s ease; display: flex; align-items: center; gap: 6px; margin: 0 auto;">
                    <span>‚ñº</span> Mostrar op√ß√µes de conte√∫do
                </button>
            `;
            
            // Inserir o bot√£o ap√≥s o chat-input-container
            const chatContainer = document.getElementById('chat-input-container');
            chatContainer.parentNode.insertBefore(showOptionsBtn, chatContainer.nextSibling);
        }

        // Fun√ß√£o para mostrar as op√ß√µes de conte√∫do
        function showContentOptions() {
            document.getElementById('add-content-buttons').style.display = 'block';
            
            // Remover o bot√£o de mostrar op√ß√µes
            const showOptionsBtn = document.getElementById('show-options-btn');
            if (showOptionsBtn) {
                showOptionsBtn.remove();
            }
        }
        
        // Fun√ß√£o para detectar URLs do Instagram e mostrar op√ß√µes
        function checkForInstagramUrls() {
            const urlInput = document.getElementById('url-extract-input');
            const instagramOptions = document.querySelector('.instagram-options');
            
            if (!urlInput || !instagramOptions) return;
            
            const urls = urlInput.value.split('\n').map(url => url.trim()).filter(url => url.length > 0);
            const hasInstagramUrl = urls.some(url => 
                url.includes('instagram.com/p/') || 
                url.includes('instagram.com/reel/') ||
                url.includes('instagram.com/tv/')
            );
            
            if (hasInstagramUrl) {
                instagramOptions.style.display = 'block';
            } else {
                instagramOptions.style.display = 'none';
            }
        }

        function autoResizeUrl(textarea) {
            // Salvar a posi√ß√£o de scroll atual
            const scrollPos = window.scrollY;
            
            // Resetar a altura para calcular corretamente
            textarea.style.height = 'auto';
            
            // Definir a nova altura com base no conte√∫do
            const newHeight = Math.min(textarea.scrollHeight, 120);
            textarea.style.height = newHeight + 'px';
            
            // Configurar overflow com base na altura
            if (textarea.scrollHeight > 120) {
                textarea.style.overflowY = 'auto';
            } else {
                textarea.style.overflowY = 'hidden';
            }
            
            // Restaurar a posi√ß√£o de scroll para evitar saltos na p√°gina
            window.scrollTo(0, scrollPos);
            
            // ADICIONAR: Verificar URLs do Instagram
            checkForInstagramUrls();
        }

        function autoResizeText(textarea) {
            // Salvar a posi√ß√£o de scroll atual
            const scrollPos = window.scrollY;
            
            // Resetar a altura para calcular corretamente
            textarea.style.height = 'auto';
            
            // Definir a nova altura com base no conte√∫do
            const newHeight = Math.min(textarea.scrollHeight, 120);
            textarea.style.height = newHeight + 'px';
            
            // Configurar overflow com base na altura
            if (textarea.scrollHeight > 120) {
                textarea.style.overflowY = 'auto';
            } else {
                textarea.style.overflowY = 'hidden';
            }
            
            // Restaurar a posi√ß√£o de scroll para evitar saltos na p√°gina
            window.scrollTo(0, scrollPos);
        }

        function processTextContent() {
            const textInput = document.getElementById('text-extract-input');
            const text = textInput.value.trim();
            
            if (!text) {
                alert('Por favor, digite ou cole algum texto para processar');
                return;
            }
            
            // Verificar se j√° existem URLs extra√≠das
            const hasExistingUrls = extractedUrlContent && extractedUrlContent.length > 0;
            
            // Se n√£o houver URLs extra√≠das, limpar o array
            if (!hasExistingUrls) {
                extractedUrlContent = [];
            }
            
            // Adicionar o texto como conte√∫do extra√≠do
            extractedUrlContent.push({
                title: "Texto fornecido pelo usu√°rio",
                content: text,
                wordCount: text.split(/\s+/).length,
                url: "texto_do_usuario"
            });
            
            // Mostrar mensagem do usu√°rio
            addMessage('#chat-messages', 'user', `Processar texto (${text.length} caracteres)`);
            
            // Criar resumo do texto processado e URLs extra√≠das (se houver)
            const totalWords = extractedUrlContent.reduce((total, item) => total + item.wordCount, 0);
            
            let resultHtml = `
                <div>
                    <div class="extracted-content-banner">
                        <p>‚úÖ ${hasExistingUrls ? 'Conte√∫do combinado' : 'Texto'} processado com sucesso! (${totalWords} palavras no total)</p>
                        <button onclick="clearExtractedContent()">Limpar</button>
                    </div>
                    <div class="extracted-urls-summary">
            `;
            
            // Adicionar resumo de cada URL e texto
            extractedUrlContent.forEach((item, index) => {
                let contentPreview = item.content.substring(0, 100) + (item.content.length > 100 ? '...' : '');
                contentPreview = contentPreview.replace(/\\n/g, ' ');
                
                if (item.url === "texto_do_usuario") {
                    resultHtml += `
                        <div class="extracted-url-item" style="border-left: 3px solid #667eea;">
                            <h4>Texto fornecido pelo usu√°rio</h4>
                            <p class="word-count">${item.wordCount} palavras</p>
                            <p class="content-preview">${contentPreview}</p>
                        </div>
                    `;
                } else {
                    resultHtml += `
                        <div class="extracted-url-item">
                            <h4>${index + 1}. ${item.title}</h4>
                            <p class="url-source">Fonte: ${item.url}</p>
                            <p class="word-count">${item.wordCount} palavras</p>
                            <p class="content-preview">${contentPreview}</p>
                        </div>
                    `;
                }
            });
            
            resultHtml += `
                    </div>
                    <p style="margin-top: 15px; color: #10a37f;">Agora voc√™ pode fazer perguntas sobre ${hasExistingUrls ? 'estes conte√∫dos combinados' : 'este texto'} ou reescrev√™-los!</p>
                </div>
            `;
            
            addMessage('#chat-messages', 'bot', resultHtml);
            
            // Limpar o campo de texto
            textInput.value = '';
            textInput.style.height = 'auto';
            
            // Ocultar campos de entrada ap√≥s processamento bem-sucedido
            hideInputFields();
            
            // Mostrar o campo de mensagem e esconder a mensagem de estado vazio
            document.getElementById('chat-input-container').style.display = 'flex';
        }

        async function extractUrlContent() {
            const urlInput = document.getElementById('url-extract-input');
            const urlsText = urlInput.value.trim();
            
            if (!urlsText) {
                alert('Por favor, digite pelo menos uma URL v√°lida');
                return;
            }
            
            // Dividir o texto em linhas e filtrar linhas vazias
            const urls = urlsText.split('\n')
                .map(url => url.trim())
                .filter(url => url.length > 0);
            
            if (urls.length === 0) {
                alert('Por favor, digite pelo menos uma URL v√°lida');
                return;
            }
            
            // Verificar se j√° existe texto processado
            const hasProcessedText = extractedUrlContent && extractedUrlContent.some(item => item.url === "texto_do_usuario");
            
            // Armazenar qualquer texto processado existente
            let processedTextContent = null;
            if (hasProcessedText) {
                processedTextContent = extractedUrlContent.find(item => item.url === "texto_do_usuario");
                // Filtrar o texto processado do array
                extractedUrlContent = extractedUrlContent.filter(item => item.url !== "texto_do_usuario");
            } else {
                // Se n√£o houver texto processado, limpar o array
                extractedUrlContent = [];
            }
            
            // Verificar se h√° URLs do Instagram e obter prefer√™ncia do usu√°rio
            const hasInstagramUrls = urls.some(url => 
                url.includes('instagram.com/p/') || 
                url.includes('instagram.com/reel/') ||
                url.includes('instagram.com/tv/')
            );
            
            let includeVideoTranscription = true; // padr√£o
            if (hasInstagramUrls) {
                const transcriptionCheckbox = document.getElementById('include-video-transcription');
                includeVideoTranscription = transcriptionCheckbox ? transcriptionCheckbox.checked : true;
                
                console.log('URLs do Instagram detectadas. Incluir transcri√ß√£o de v√≠deo:', includeVideoTranscription);
            }
            
            // Mostrar as URLs que ser√£o extra√≠das
            addMessage('#chat-messages', 'user', `Extrair conte√∫do de ${urls.length} URL(s)${hasInstagramUrls ? (includeVideoTranscription ? ' (com transcri√ß√£o de v√≠deo)' : ' (apenas texto e coment√°rios)') : ''}:\n${urls.join('\n')}`);
            
            const progressDiv = showExtractionProgress('#chat-messages');
            
            try {
                // Verificar se h√° URLs do Instagram
                const hasInstagramUrls = urls.some(url => 
                    url.includes('instagram.com/p/') || 
                    url.includes('instagram.com/reel/') ||
                    url.includes('instagram.com/tv/')
                );
                
                // Se houver URLs do Instagram, mostrar um aviso especial
                if (hasInstagramUrls) {
                    const instaWarning = document.createElement('div');
                    instaWarning.className = 'message-row bot';
                    instaWarning.innerHTML = `
                        <div class="message">
                            <div class="message-avatar">üì±</div>
                            <div class="message-content">
                                <div style="background-color: rgba(16, 163, 127, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid var(--primary-color);">
                                    <p style="margin: 0 0 8px 0; font-weight: 600; color: var(--primary-color); display: flex; align-items: center; gap: 8px;">
                                        <span class="instagram-loading-indicator" style="display: inline-block; width: 18px; height: 18px; border: 2px solid rgba(16, 163, 127, 0.3); border-top: 2px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite;"></span>
                                        URL do Instagram detectada
                                    </p>
                                    <p style="margin: 0; font-size: 14px;">A extra√ß√£o de conte√∫do do Instagram pode levar mais tempo (10-15 minutos para v√≠deos longos). Para v√≠deos, ser√£o extra√≠das informa√ß√µes t√©cnicas como dura√ß√£o, resolu√ß√£o e formato.</p>
                                    <div id="instagram-progress" style="margin-top: 10px; height: 4px; width: 100%; background-color: rgba(16, 163, 127, 0.2); border-radius: 2px; overflow: hidden;">
                                        <div style="height: 100%; width: 0%; background-color: var(--primary-color); animation: progress-bar 5s ease-in-out infinite;"></div>
                                    </div>
                                </div>
                                
                                <style>
                                    @keyframes spin {
                                        0% { transform: rotate(0deg); }
                                        100% { transform: rotate(360deg); }
                                    }
                                    
                                    @keyframes progress-bar {
                                        0% { width: 0%; }
                                        30% { width: 40%; }
                                        60% { width: 70%; }
                                        90% { width: 85%; }
                                        100% { width: 95%; }
                                    }
                                </style>
                            </div>
                        </div>
                    `;
                    document.getElementById('chat-messages').appendChild(instaWarning);
                    document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
                }
                
                // Configurar eventos SSE para receber atualiza√ß√µes de progresso
                const eventSource = new EventSource('/api/progress-events');
                
                eventSource.addEventListener('message', function(event) {
                    const data = JSON.parse(event.data);
                    
                    if (data.event === 'extraction_start') {
                        document.getElementById('step-connect').textContent = '‚úì';
                        document.getElementById('step-extract').textContent = '‚è≥';
                        document.getElementById('step-extract-message').textContent = data.message;
                    } else if (data.event === 'extraction_complete') {
                        document.getElementById('step-extract').textContent = '‚úì';
                        document.getElementById('step-process').textContent = '‚è≥';
                        document.getElementById('step-process-message').textContent = 'Finalizando...';
                        
                        // Parar anima√ß√µes de carregamento do Instagram quando a extra√ß√£o estiver completa
                        const loadingIndicators = document.querySelectorAll('.instagram-loading-indicator');
                        loadingIndicators.forEach(indicator => {
                            indicator.style.animation = 'none';
                            indicator.style.borderTop = '2px solid var(--primary-color)';
                            indicator.style.borderRight = '2px solid var(--primary-color)';
                            indicator.style.borderBottom = '2px solid var(--primary-color)';
                            indicator.style.borderLeft = '2px solid var(--primary-color)';
                        });
                        
                        const progressBars = document.querySelectorAll('#instagram-progress > div');
                        progressBars.forEach(bar => {
                            bar.style.animation = 'none';
                            bar.style.width = '100%';
                        });
                    } else if (data.event === 'extraction_failed') {
                        document.getElementById('step-extract').textContent = '‚ùå';
                        document.getElementById('step-extract-message').textContent = data.message;
                        
                        // Parar anima√ß√µes de carregamento do Instagram em caso de falha
                        const loadingIndicators = document.querySelectorAll('.instagram-loading-indicator');
                        loadingIndicators.forEach(indicator => {
                            indicator.style.animation = 'none';
                            indicator.style.borderColor = '#ff4d4f';
                        });
                        
                        const progressBars = document.querySelectorAll('#instagram-progress > div');
                        progressBars.forEach(bar => {
                            bar.style.animation = 'none';
                            bar.style.backgroundColor = '#ff4d4f';
                            bar.style.width = '100%';
                        });
                    } else if (data.event === 'instagram_detected') {
                        document.getElementById('step-extract').textContent = 'üì±';
                        document.getElementById('step-extract-message').textContent = data.message;
                    } else if (data.event === 'instagram_extraction') {
                        document.getElementById('step-extract').textContent = '‚è≥';
                        document.getElementById('step-extract-message').textContent = data.message;
                    } else if (data.event === 'video_download_start') {
                        document.getElementById('step-extract').textContent = 'üì•';
                        document.getElementById('step-extract-message').textContent = data.message;
                    } else if (data.event === 'audio_extraction_start') {
                        document.getElementById('step-extract').textContent = 'üîä';
                        document.getElementById('step-extract-message').textContent = data.message;
                    } else if (data.event === 'audio_analysis_start') {
                        document.getElementById('step-extract').textContent = 'üìä';
                        document.getElementById('step-extract-message').textContent = data.message;
                    } else if (data.event === 'video_processing_start') {
                        document.getElementById('step-extract').textContent = 'üé¨';
                        document.getElementById('step-extract-message').textContent = data.message;
                    } else if (data.event === 'video_processing_complete') {
                        document.getElementById('step-extract').textContent = '‚úì';
                        document.getElementById('step-process').textContent = '‚è≥';
                        document.getElementById('step-process-message').textContent = 'Processando conte√∫do do Instagram...';
                    } else if (data.event === 'instagram_error') {
                        document.getElementById('step-extract').textContent = '‚ùå';
                        document.getElementById('step-extract-message').textContent = data.message;
                        
                        // Parar anima√ß√µes de carregamento do Instagram em caso de erro espec√≠fico do Instagram
                        const loadingIndicators = document.querySelectorAll('.instagram-loading-indicator');
                        loadingIndicators.forEach(indicator => {
                            indicator.style.animation = 'none';
                            indicator.style.borderColor = '#ff4d4f';
                        });
                        
                        const progressBars = document.querySelectorAll('#instagram-progress > div');
                        progressBars.forEach(bar => {
                            bar.style.animation = 'none';
                            bar.style.backgroundColor = '#ff4d4f';
                            bar.style.width = '100%';
                        });
                    }
                });
                
                // Extrair cada URL sequencialmente
                for (let i = 0; i < urls.length; i++) {
                    const url = urls[i];
                    
                    // Atualizar o primeiro passo
                    document.getElementById('step-connect').textContent = '‚è≥';
                    document.getElementById('step-connect-message').textContent = `Conectando ao site ${i+1}/${urls.length}: ${url}`;
                    
                    const response = await fetch('/api/extract-url-content', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 
                            url,
                            includeVideoTranscription: includeVideoTranscription
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        // Adicionar mensagem de erro para esta URL espec√≠fica
                        addMessage('#chat-messages', 'bot', `Erro na URL ${url}: ${data.error}`);
                    } else {
                        // Armazenar o conte√∫do extra√≠do
                        extractedUrlContent.push({
                            title: data.title,
                            content: data.content,
                            wordCount: data.wordCount,
                            url: url,
                            platform: data.platform || null
                        });
                    }
                }
                
                // Reincluir o texto processado, se existir
                if (processedTextContent) {
                    extractedUrlContent.push(processedTextContent);
                }
                
                // Fechar a conex√£o SSE
                eventSource.close();
                
                // Remover o div de progresso
                if (progressDiv && progressDiv.parentNode) {
                    progressDiv.parentNode.removeChild(progressDiv);
                }
                
                if (extractedUrlContent.length === 0) {
                    addMessage('#chat-messages', 'bot', `N√£o foi poss√≠vel extrair conte√∫do de nenhuma das URLs fornecidas.`);
                } else {
                    // Calcular o total de palavras
                    const totalWords = extractedUrlContent.reduce((total, item) => total + item.wordCount, 0);
                    
                    // Criar resumo dos conte√∫dos extra√≠dos
                    let resultHtml = `
                        <div>
                            <div class="extracted-content-banner">
                                <p>‚úÖ ${hasProcessedText ? 'Conte√∫do combinado' : 'Conte√∫do extra√≠do'} de ${extractedUrlContent.filter(item => item.url !== "texto_do_usuario").length} URL(s) com sucesso! (${totalWords} palavras no total)</p>
                                <button onclick="clearExtractedContent()">Limpar</button>
                            </div>
                            <div class="extracted-urls-summary">
                    `;
                    
                    // Adicionar resumo de cada URL e texto
                    extractedUrlContent.forEach((item, index) => {
                        // Garantir que n√£o haja caracteres \n no preview
                        let contentPreview = item.content.substring(0, 100) + (item.content.length > 100 ? '...' : '');
                        contentPreview = contentPreview.replace(/\\n/g, ' ');
                        
                        if (item.url === "texto_do_usuario") {
                            resultHtml += `
                                <div class="extracted-url-item" style="border-left: 3px solid #667eea;">
                                    <h4>Texto fornecido pelo usu√°rio</h4>
                                    <p class="word-count">${item.wordCount} palavras</p>
                                    <p class="content-preview">${contentPreview}</p>
                                </div>
                            `;
                        } else if (item.platform === 'Instagram') {
                            // Estilo especial para conte√∫do do Instagram
                            resultHtml += `
                                <div class="extracted-url-item" style="border-left: 3px solid #E1306C;">
                                    <h4 style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 18px;">üì±</span>
                                        ${index + 1}. ${item.title}
                                    </h4>
                                    <p class="url-source">Fonte Instagram: ${item.url}</p>
                                    <p class="word-count">${item.wordCount} palavras</p>
                                    <p class="content-preview">${contentPreview}</p>
                                </div>
                            `;
                        } else {
                            resultHtml += `
                                <div class="extracted-url-item">
                                    <h4>${index + 1}. ${item.title}</h4>
                                    <p class="url-source">Fonte: ${item.url}</p>
                                    <p class="word-count">${item.wordCount} palavras</p>
                                    <p class="content-preview">${contentPreview}</p>
                                </div>
                            `;
                        }
                    });
                    
                    resultHtml += `
                            </div>
                            <p style="margin-top: 15px; color: #10a37f;">Agora voc√™ pode fazer perguntas sobre ${hasProcessedText ? 'estes conte√∫dos combinados' : 'estes conte√∫dos'} ou reescrev√™-los!</p>
                        </div>
                    `;
                    
                    addMessage('#chat-messages', 'bot', resultHtml);
                    
                    // Limpar o campo de URL
                    urlInput.value = '';
                    urlInput.style.height = 'auto';
                    
                    // Ocultar campos de entrada ap√≥s extra√ß√£o bem-sucedida
                    if (extractedUrlContent.length > 0) {
                        hideInputFields();
                        // Mostrar o campo de mensagem
                    document.getElementById('chat-input-container').style.display = 'flex';
                    }
                }
            } catch (error) {
                // Remover o div de progresso
                if (progressDiv && progressDiv.parentNode) {
                    progressDiv.parentNode.removeChild(progressDiv);
                }
                
                addMessage('#chat-messages', 'bot', `Erro de conex√£o: ${error.message}`);
            }
        }

        function clearExtractedContent() {
            extractedUrlContent = [];
            addMessage('#chat-messages', 'bot', 'Conte√∫dos extra√≠dos foram limpos. Voc√™ pode extrair novas URLs ou fazer perguntas gerais.');
            
            // Resetar o estado dos campos de entrada
            resetInputState();
            
            // Remover bot√£o de mostrar op√ß√µes se existir
            const showOptionsBtn = document.getElementById('show-options-btn');
            if (showOptionsBtn) {
                showOptionsBtn.remove();
            }
            
            // Limpar o campo de mensagem
            document.getElementById('chat-input').value = '';
        }

        function toggleRewriteOptions() {
            // Abrir o modal diretamente
            openRewriteModal();
        }
        
        function startRewriteFromModal() {
            // Obt√©m os valores do modal
            const tone = document.getElementById('modal-rewrite-tone').value;
            const length = document.getElementById('modal-rewrite-length').value;
            const removeSubtitles = document.getElementById('modal-remove-subtitles').checked;
            const observation = document.getElementById('modal-rewrite-observation').value;
            
            // Transfere os valores para os campos originais (para compatibilidade)
            if (document.getElementById('rewrite-tone-chat')) {
                document.getElementById('rewrite-tone-chat').value = tone;
            }
            
            if (document.getElementById('rewrite-length-chat')) {
                document.getElementById('rewrite-length-chat').value = length;
            }
            
            if (document.getElementById('remove-subtitles')) {
                document.getElementById('remove-subtitles').checked = removeSubtitles;
            }
            
            if (document.getElementById('rewrite-observation')) {
                document.getElementById('rewrite-observation').value = observation;
            }
            
            // Fecha o modal
            closeRewriteModal();
            
            // Inicia a reescrita humanizada com as op√ß√µes selecionadas
            startRewrite();
        }
        
        // Nova fun√ß√£o para iniciar a reescrita
        async function startRewrite() {
            // Obter qualquer instru√ß√£o adicional do usu√°rio
            const input = document.getElementById('chat-input');
            const userText = input.value.trim();
            
            // Verificar se h√° conte√∫do extra√≠do OU texto digitado pelo usu√°rio
            if ((!extractedUrlContent || extractedUrlContent.length === 0) && !userText) {
                alert('Por favor, extraia o conte√∫do de uma URL ou digite um texto para reescrever.');
                return;
            }
            
            // Verificar se h√° apenas texto digitado (sem URLs extra√≠das)
            const isTextOnlyRewrite = (!extractedUrlContent || extractedUrlContent.length === 0) && userText;
            
            // Verificar se h√° conte√∫do combinado (URLs + texto processado)
            const hasCombinedContent = extractedUrlContent && extractedUrlContent.some(item => item.url === "texto_do_usuario") && 
                                       extractedUrlContent.some(item => item.url !== "texto_do_usuario");
            
            // Obter as op√ß√µes de reescrita
            const tone = document.getElementById('rewrite-tone-chat').value;
            const length = document.getElementById('rewrite-length-chat').value;
            
            // Verificar se a op√ß√£o de remover subt√≠tulos est√° marcada
            const removeSubtitles = document.getElementById('remove-subtitles').checked;
            
            // Obter observa√ß√£o do campo espec√≠fico
            const observation = document.getElementById('rewrite-observation').value.trim();
            
            // Limpar o campo de entrada
            input.value = '';
            input.style.height = 'auto';
            
            // Adicionar mensagem do usu√°rio indicando a reescrita
            let userMessage;
            const subtitlesInfo = removeSubtitles ? ' | Sem subt√≠tulos' : '';
            
            if (isTextOnlyRewrite) {
                userMessage = `Reescrever texto como mat√©ria jornal√≠stica (Tom: ${tone}, Tamanho: ${length}${subtitlesInfo})${observation ? ' | Observa√ß√£o: ' + observation : ''}`;
            } else if (hasCombinedContent) {
                const urlCount = extractedUrlContent.filter(item => item.url !== "texto_do_usuario").length;
                userMessage = `Reescrever conte√∫do combinado (${urlCount} URL(s) + texto) como mat√©ria jornal√≠stica (Tom: ${tone}, Tamanho: ${length}${subtitlesInfo})${userText ? ': ' + userText : ''}${observation ? ' | Observa√ß√£o: ' + observation : ''}`;
            } else {
                userMessage = `Reescrever ${extractedUrlContent.length} URL(s) como mat√©ria jornal√≠stica (Tom: ${tone}, Tamanho: ${length}${subtitlesInfo})${userText ? ': ' + userText : ''}${observation ? ' | Observa√ß√£o: ' + observation : ''}`;
            }
            addMessage('#chat-messages', 'user', userMessage);
            
            // Mostrar indicador de carregamento
            const loading = showLoading('#chat-messages');
            
            try {
                // Coletar todas as mensagens anteriores do usu√°rio para contexto adicional
                const chatMessages = document.querySelectorAll('#chat-messages .message-row');
                let previousUserMessages = [];
                
                chatMessages.forEach(messageRow => {
                    if (messageRow.classList.contains('user')) {
                        const messageContent = messageRow.querySelector('.message-content').innerText;
                        if (!messageContent.startsWith('Extrair conte√∫do de')) { // Ignorar mensagens de extra√ß√£o
                            previousUserMessages.push(messageContent);
                        }
                    }
                });
                
                // Filtrar para obter apenas as √∫ltimas 5 mensagens do usu√°rio (para n√£o sobrecarregar o prompt)
                previousUserMessages = previousUserMessages.slice(-5);
                
                // Preparar o conte√∫do para reescrita
                let combinedTitle, combinedContent;
                
                if (isTextOnlyRewrite) {
                    // Usar o texto digitado pelo usu√°rio
                    combinedTitle = "Texto fornecido pelo usu√°rio";
                    combinedContent = `TEXTO DO USU√ÅRIO:\n\n${userText}`;
                } else {
                    // Separar URLs e texto processado
                    const urlContents = extractedUrlContent.filter(item => item.url !== "texto_do_usuario");
                    const textContent = extractedUrlContent.find(item => item.url === "texto_do_usuario");
                    
                    // Criar t√≠tulo combinado
                    if (hasCombinedContent) {
                        combinedTitle = urlContents.map(item => item.title).join(" | ") + " + Texto do usu√°rio";
                    } else {
                        combinedTitle = urlContents.map(item => item.title).join(" | ");
                    }
                    
                    // Criar conte√∫do combinado
                    combinedContent = '';
                    
                    // Adicionar conte√∫do das URLs
                    if (urlContents.length > 0) {
                        combinedContent += urlContents.map((item, index) => {
                            return `FONTE ${index + 1}: ${item.url}\nT√çTULO: ${item.title}\n\n${item.content}`;
                        }).join("\n\n----------\n\n");
                    }
                    
                    // Adicionar texto processado, se existir
                    if (textContent) {
                        if (urlContents.length > 0) {
                            combinedContent += "\n\n----------\n\n";
                        }
                        combinedContent += `TEXTO FORNECIDO PELO USU√ÅRIO:\n\n${textContent.content}`;
                    }
                }
                
                // Adicionar contexto das mensagens anteriores do usu√°rio
                let userContext = '';
                if (previousUserMessages.length > 0) {
                    userContext = `CONTEXTO ADICIONAL DO USU√ÅRIO (mensagens anteriores):\n${previousUserMessages.join('\n')}\n\n`;
                }
                
                // Criar o prompt para reescrita com instru√ß√µes para texto humanizado e anti-pl√°gio
                const sourceCount = isTextOnlyRewrite ? 1 : extractedUrlContent.length;
                const sourceType = isTextOnlyRewrite ? "texto fornecido" : (hasCombinedContent ? "conte√∫do combinado (URLs + texto)" : "fonte(s)");
                const rewritePrompt = `Reescreva completamente o seguinte ${sourceType} como uma √∫nica mat√©ria jornal√≠stica original, 
garantindo ZERO pl√°gio e ZERO gerado por inteligencia artificial e usando uma estrutura e linguagem totalmente diferentes dos originais.
Use tom ${tone} e tamanho ${length}:

${isTextOnlyRewrite ? 'TEXTO FORNECIDO PELO USU√ÅRIO:' : (hasCombinedContent ? 'CONTE√öDO COMBINADO (URLs + TEXTO DO USU√ÅRIO):' : `CONTE√öDO COMBINADO DE ${extractedUrlContent.length} FONTE(S):`)}
${combinedContent}

${userContext}${!isTextOnlyRewrite && userText ? `INSTRU√á√ïES ADICIONAIS DO USU√ÅRIO: ${userText}\n\n` : ''}${observation ? `OBSERVA√á√ÉO DO USU√ÅRIO (foco da reescrita): ${observation}\n\n` : ''}

Escreva como rep√≥rter do portal, seguindo este padr√£o:

Lead direto - comece com o fato principal, sem rodeios. O que aconteceu, quando e onde.

Desenvolva a mat√©ria assim:
- Par√°grafos curtos. Uma ou duas frases no m√°ximo. √Äs vezes s√≥ uma.
- Dados concretos: n√∫meros, datas, locais espec√≠ficos
- Cite fontes oficiais ("segundo a", "de acordo com", "informou")
- Coloque aspas nas declara√ß√µes exatas
- Contextualize com informa√ß√µes anteriores quando relevante
- Use verbos no passado ou presente, evite futuro do pret√©rito

Para dar ritmo:
- Alterne par√°grafos informativos com cita√ß√µes
- Quando houver lista de pontos, use emoji (üì∏, ‚û°Ô∏è, üìä)
- Destaque informa√ß√µes-chave em negrito se necess√°rio
- Quebre o texto com intert√≠tulos quando for longo

Tom ${tone}, ${removeSubtitles ? 'texto corrido sem intert√≠tulos' : 'com intert√≠tulos quando necess√°rio'}.
${observation ? `Foco em: ${observation}` : ''}

FORMATO OBRIGAT√ìRIO:

T√çTULO: [fato principal + complemento ap√≥s dois pontos ou ponto e v√≠rgula]
SUBT√çTULO: [detalhamento com mais informa√ß√µes. Pode ter duas frases curtas]
TAGS: [5-7 palavras-chave simples, sem artigos]
PALAVRA-CHAVE DE CAUDA LONGA: [frase de busca natural]
CONTE√öDO:
[Lead com fato principal]

[Desenvolvimento em par√°grafos curtos]

[Contextualiza√ß√£o e desdobramentos]

[Fechamento com informa√ß√µes adicionais ou pr√≥ximos passos]`;

                // Enviar a solicita√ß√£o para a API
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: rewritePrompt })
                });
                
                const data = await response.json();
                removeLoading(loading);
                
                if (data.error) {
                    addMessage('#chat-messages', 'bot', `Erro: ${data.error}`);
                } else {
                    // Formatar a resposta como uma mat√©ria estruturada
                    const formattedResponse = formatRewrittenContent(data.response);
                    const botMessage = addMessage('#chat-messages', 'bot', formattedResponse);
                    
                    // Salvar a resposta original para refer√™ncia
                    const contentDiv = botMessage.querySelector('.message-content');
                    if (contentDiv) {
                        contentDiv.dataset.originalResponse = data.response;
                    }
                    
                    // Resetar a op√ß√£o de reescrita
                    document.getElementById('rewrite-as-human').checked = false;
                    toggleRewriteOptions();
                }
            } catch (error) {
                removeLoading(loading);
                addMessage('#chat-messages', 'bot', `Erro de conex√£o: ${error.message}`);
            }
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage('#chat-messages', 'user', message);
            input.value = '';
            input.style.height = 'auto';
            
            const loading = showLoading('#chat-messages');
            
            try {
                const endpoint = '/api/chat';
                
                // Verificar se h√° conte√∫do extra√≠do para incluir na solicita√ß√£o
                let extractedContents = [];
                let contextMessage = message;
                
                if (extractedUrlContent && extractedUrlContent.length > 0) {
                    // Adicionar conte√∫do extra√≠do diretamente na mensagem para garantir que a IA o processe
                    let contextualContent = "CONTE√öDO EXTRA√çDO:\n\n";
                    
                    extractedUrlContent.forEach((item, index) => {
                        if (item.url === "texto_do_usuario") {
                            contextualContent += `TEXTO FORNECIDO PELO USU√ÅRIO:\n`;
                        } else {
                            contextualContent += `FONTE ${index + 1}: ${item.url}\n`;
                            contextualContent += `T√çTULO: ${item.title}\n`;
                        }
                        contextualContent += `CONTE√öDO:\n${item.content}\n\n`;
                        
                        // Tamb√©m adicionar √† lista de conte√∫dos extra√≠dos para o backend
                        extractedContents.push({
                            title: item.title,
                            content: item.content,
                            url: item.url,
                            wordCount: item.wordCount
                        });
                    });
                    
                    contextualContent += "\nPERGUNTA DO USU√ÅRIO: " + message;
                    contextMessage = contextualContent;
                }
                
                const requestBody = { 
                    message: contextMessage,
                    originalMessage: message,
                    extractedContents: extractedContents
                };
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                removeLoading(loading);
                
                if (data.error) {
                    addMessage('#chat-messages', 'bot', `Erro: ${data.error}`);
                } else {
                    // Adicionar a resposta normal
                    const botMessage = addMessage('#chat-messages', 'bot', data.response);
                    
                    // Salvar a resposta original para refer√™ncia
                    const contentDiv = botMessage.querySelector('.message-content');
                    if (contentDiv) {
                        contentDiv.dataset.originalResponse = data.response;
                    }
                }
            } catch (error) {
                removeLoading(loading);
                addMessage('#chat-messages', 'bot', `Erro de conex√£o: ${error.message}`);
            }
        }
        
        // Fun√ß√£o para formatar o conte√∫do reescrito
        function formatRewrittenContent(content) {
            console.log("Conte√∫do recebido para formata√ß√£o:", content);
            
            // Verificar se o conte√∫do est√° vazio ou √© inv√°lido
            if (!content || typeof content !== 'string' || content.trim() === '') {
                console.error("Conte√∫do recebido vazio ou inv√°lido:", content);
                return `
                    <div class="rewritten-content">
                        <div class="result-section">
                            <h3 style="color: #ff4d4f; margin-bottom: 15px;">‚ö†Ô∏è Erro na gera√ß√£o do conte√∫do</h3>
                            <p>Ocorreu um erro ao processar a resposta da IA. Por favor, tente novamente.</p>
                            <button onclick="window.location.reload()" style="background: #10a37f; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; margin-top: 15px;">Recarregar p√°gina</button>
                        </div>
                    </div>
                `;
            }
            
            // Extrair partes do conte√∫do com padr√µes mais flex√≠veis
            const titleMatch = content.match(/T√çTULO:\s*(.*?)(?=\n|SUBT√çTULO:|$)/is) || 
                              content.match(/\*\*T√≠tulo:\*\*\s*(.*?)(?=\n|\*\*Subt√≠tulo:|$)/is) ||
                              content.match(/\*\*T√çTULO:\*\*\s*(.*?)(?=\n|\*\*SUBT√çTULO:|$)/is) ||
                              content.match(/T√≠tulo:\s*(.*?)(?=\n|Subt√≠tulo:|$)/is);
                              
            const subtitleMatch = content.match(/SUBT√çTULO:\s*(.*?)(?=\n|TAGS:|$)/is) ||
                                content.match(/\*\*Subt√≠tulo:\*\*\s*(.*?)(?=\n|\*\*Tags:|$)/is) ||
                                content.match(/\*\*SUBT√çTULO:\*\*\s*(.*?)(?=\n|\*\*TAGS:|$)/is) ||
                                content.match(/Subt√≠tulo:\s*(.*?)(?=\n|Tags:|$)/is);
                                
            const tagsMatch = content.match(/TAGS:\s*(.*?)(?=\n|PALAVRA-CHAVE DE CAUDA LONGA:|PALAVRA-CHAVE:|$)/is) ||
                            content.match(/\*\*Tags:\*\*\s*(.*?)(?=\n|\*\*Palavra-chave de cauda longa:|\*\*Palavra-chave:|$)/is) ||
                            content.match(/\*\*TAGS:\*\*\s*(.*?)(?=\n|\*\*PALAVRA-CHAVE DE CAUDA LONGA:|\*\*PALAVRA-CHAVE:|$)/is) ||
                            content.match(/Tags:\s*(.*?)(?=\n|Palavra-chave de cauda longa:|Palavra-chave:|$)/is);
                            
            const keywordMatch = content.match(/PALAVRA-CHAVE DE CAUDA LONGA:\s*(.*?)(?=\n|CONTE√öDO:|$)/is) ||
                               content.match(/\*\*Palavra-chave de cauda longa:\*\*\s*(.*?)(?=\n|\*\*Conte√∫do:|$)/is) ||
                               content.match(/\*\*PALAVRA-CHAVE DE CAUDA LONGA:\*\*\s*(.*?)(?=\n|\*\*CONTE√öDO:|$)/is) ||
                               content.match(/Palavra-chave de cauda longa:\s*(.*?)(?=\n|Conte√∫do:|$)/is) ||
                               content.match(/PALAVRA-CHAVE:\s*(.*?)(?=\n|CONTE√öDO:|$)/is) ||
                               content.match(/\*\*Palavra-chave:\*\*\s*(.*?)(?=\n|\*\*Conte√∫do:|$)/is) ||
                               content.match(/Palavra-chave:\s*(.*?)(?=\n|Conte√∫do:|$)/is);
                               
            const contentMatch = content.match(/CONTE√öDO:\s*([\s\S]*)/is) ||
                               content.match(/\*\*Conte√∫do:\*\*\s*([\s\S]*)/is) ||
                               content.match(/\*\* Conte√∫do:\*\*\s*([\s\S]*)/is) ||
                               content.match(/Conte√∫do:\s*([\s\S]*)/is);
            
            console.log("Matches encontrados:", {
                titleMatch: titleMatch ? "Sim" : "N√£o",
                subtitleMatch: subtitleMatch ? "Sim" : "N√£o",
                tagsMatch: tagsMatch ? "Sim" : "N√£o",
                keywordMatch: keywordMatch ? "Sim" : "N√£o",
                contentMatch: contentMatch ? "Sim" : "N√£o"
            });
            
            // Extrair o conte√∫do dos matches
            const title = titleMatch ? titleMatch[1].trim().replace(/^"|"$/g, '') : '';
            const subtitle = subtitleMatch ? subtitleMatch[1].trim().replace(/^"|"$/g, '') : '';
            const tags = tagsMatch ? tagsMatch[1].trim() : '';
            const keyword = keywordMatch ? keywordMatch[1].trim().replace(/^"|"$/g, '') : '';
            
            console.log("Metadados extra√≠dos:", { title, subtitle, tags, keyword });
            
            // Tentar extrair metadados do conte√∫do se n√£o foram encontrados pelos padr√µes regulares
            let extractedTitle = title;
            let extractedSubtitle = subtitle;
            let extractedTags = tags;
            let extractedKeyword = keyword;
            let mainContent = '';
            
            // Se n√£o encontrou a estrutura esperada, tentar extrair manualmente
            if (!contentMatch && (!title || !subtitle || !tags || !keyword)) {
                console.log("Tentando extrair metadados manualmente do conte√∫do");
                
                // Dividir o conte√∫do em linhas
                const lines = content.split('\n');
                let inContent = false;
                let contentLines = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // Tentar extrair t√≠tulo
                    if (!extractedTitle && (line.startsWith("T√≠tulo:") || line.match(/^".*"$/))) {
                        extractedTitle = line.replace(/^T√≠tulo:\s*/, '').replace(/^"|"$/g, '').trim();
                        continue;
                    }
                    
                    // Tentar extrair subt√≠tulo
                    if (!extractedSubtitle && (line.startsWith("Subt√≠tulo:") || (i > 0 && lines[i-1].includes("T√≠tulo:")))) {
                        extractedSubtitle = line.replace(/^Subt√≠tulo:\s*/, '').replace(/^"|"$/g, '').trim();
                        continue;
                    }
                    
                    // Tentar extrair tags
                    if (!extractedTags && line.startsWith("Tags:")) {
                        extractedTags = line.replace(/^Tags:\s*/, '').trim();
                        continue;
                    }
                    
                    // Tentar extrair palavra-chave
                    if (!extractedKeyword && (line.startsWith("Palavra-chave") || line.includes("cauda longa"))) {
                        extractedKeyword = line.replace(/^Palavra-chave.*?:\s*/, '').replace(/^"|"$/g, '').trim();
                        continue;
                    }
                    
                    // Detectar in√≠cio do conte√∫do
                    if (line.startsWith("Conte√∫do:") || line.includes("**Conte√∫do:**")) {
                        inContent = true;
                        continue;
                    }
                    
                    // Coletar linhas de conte√∫do
                    if (inContent) {
                        contentLines.push(line);
                    }
                }
                
                // Se encontrou conte√∫do manualmente
                if (contentLines.length > 0) {
                    mainContent = contentLines.join('\n').trim();
                }
            } else if (contentMatch) {
                mainContent = contentMatch[1].trim();
                
                // Remover qualquer t√≠tulo, subt√≠tulo, tags e palavra-chave que possam estar duplicados no conte√∫do
                mainContent = mainContent.replace(/\*\*T√≠tulo:\*\*.*?\n\n/s, '')
                                        .replace(/\*\*Subt√≠tulo:\*\*.*?\n\n/s, '')
                                        .replace(/\*\*Tags:\*\*.*?\n\n/s, '')
                                        .replace(/\*\*Palavra-chave de cauda longa:\*\*.*?\n\n/s, '');
            } else {
                // Se n√£o encontrar a estrutura esperada, usar todo o conte√∫do
                mainContent = content;
                
                // Tentar extrair t√≠tulo e subt√≠tulo do in√≠cio do conte√∫do
                const lines = content.split('\n');
                if (lines.length > 1 && !extractedTitle) {
                    extractedTitle = lines[0].trim();
                    if (lines.length > 2 && !extractedSubtitle) {
                        extractedSubtitle = lines[1].trim();
                    }
                }
                
                // Gerar tags gen√©ricas se n√£o encontrou
                if (!extractedTags) {
                    const words = content.split(/\s+/).filter(word => word.length > 4);
                    const uniqueWords = [...new Set(words)];
                    const selectedWords = uniqueWords.slice(0, 5);
                    extractedTags = selectedWords.join(', ');
                }
                
                // Gerar palavra-chave de cauda longa gen√©rica
                if (!extractedKeyword && extractedTitle) {
                    extractedKeyword = extractedTitle;
                }
            }
            
            // Usar os metadados extra√≠dos manualmente se necess√°rio
            const finalTitle = extractedTitle || title || "Mat√©ria Reescrita";
            const finalSubtitle = extractedSubtitle || subtitle || "Conte√∫do reescrito sem pl√°gio";
            const finalTags = extractedTags || tags || "reescrita, conte√∫do, artigo";
            const finalKeyword = extractedKeyword || keyword || "mat√©ria reescrita humanizada";
            
            // Verificar se o conte√∫do principal est√° vazio
            if (!mainContent || mainContent.trim() === '') {
                mainContent = "N√£o foi poss√≠vel extrair o conte√∫do principal da resposta. Por favor, tente novamente.";
            }
            
            // Formatar tags como spans
            const formattedTags = finalTags ? finalTags.split(',').map(tag => 
                `<span class="tag" style="background: #e9ecef; color: #495057; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-right: 5px; margin-bottom: 5px; display: inline-block;">${tag.trim()}</span>`
            ).join('') : '';
            
            // Formatar o conte√∫do principal para HTML
            const formattedContent = mainContent
                // Converter subt√≠tulos em negrito para tags h3
                .replace(/\*\*(.*?)\*\*/g, '<h3>$1</h3>')
                // Converter quebras de linha em par√°grafos
                .split('\n\n')
                .map(paragraph => paragraph.trim() ? `<p>${paragraph.trim()}</p>` : '')
                .join('');
            
            // Criar HTML formatado
            return `
                <div class="rewritten-content">
                    <div class="result-section">
                        <h3 style="color: #10a37f; margin-bottom: 15px;">‚úçÔ∏è Mat√©ria Reescrita</h3>
                        
                        <div class="article-metadata" style="background: rgba(16, 163, 127, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid rgba(16, 163, 127, 0.2);">
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #10a37f; font-size: 14px;">T√≠tulo:</strong>
                                <h2 style="margin: 5px 0; color: white; font-size: 20px;">${finalTitle}</h2>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #10a37f; font-size: 14px;">Subt√≠tulo:</strong>
                                <p style="margin: 5px 0; color: #ececf1; font-style: italic;">${finalSubtitle}</p>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #10a37f; font-size: 14px;">Tags:</strong>
                                <div style="margin: 5px 0; display: flex; flex-wrap: wrap; gap: 5px;">
                                    ${formattedTags}
                                </div>
                            </div>
                            
                            <div>
                                <strong style="color: #10a37f; font-size: 14px;">Palavra-chave de cauda longa:</strong>
                                <p style="margin: 5px 0; color: #ececf1; font-weight: 500;">${finalKeyword}</p>
                            </div>
                        </div>
                        
                        <div class="article-content-container" style="background: rgba(255, 255, 255, 0.03); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color);">
                            <div class="article-content" style="color: #ececf1; line-height: 1.8;">
                                ${formattedContent}
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button onclick="copyFormattedArticle(this.parentNode.parentNode)" style="background: #10a37f; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; font-weight: 500;">
                                <span>üìã</span> Copiar Tudo
                            </button>
                            <button onclick="downloadArticle(this.parentNode.parentNode)" style="background: transparent; border: 1px solid #ececf1; color: #ececf1; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; font-weight: 500;">
                                <span>üì•</span> Baixar
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Fun√ß√£o para copiar o artigo formatado
        function copyFormattedArticle(container) {
            // Obter o conte√∫do principal
            const contentContainer = container.querySelector('.article-content');
            let content = '';
            
            // Extrair o texto de todos os par√°grafos e cabe√ßalhos no conte√∫do
            const paragraphs = contentContainer.querySelectorAll('p, h3');
            paragraphs.forEach(p => {
                if (p.tagName === 'H3') {
                    content += `\n\n${p.textContent}\n\n`;
                } else {
                    content += `${p.textContent}\n\n`;
                }
            });
            
            // Se n√£o encontrou par√°grafos formatados, usar o texto bruto
            if (!content) {
                content = contentContainer.textContent;
            }
            
            // Montar o texto formatado (apenas o conte√∫do)
            const formattedText = content.trim();
            
            // Copiar para a √°rea de transfer√™ncia
            copyToClipboard(formattedText);
            showCopyNotification();
        }
        
        // Fun√ß√£o para baixar o artigo como arquivo de texto
        function downloadArticle(container) {
            const title = container.querySelector('h2')?.textContent || 'materia';
            
            // Obter o conte√∫do principal
            const contentContainer = container.querySelector('.article-content');
            let content = '';
            
            // Extrair o texto de todos os par√°grafos e cabe√ßalhos no conte√∫do
            const paragraphs = contentContainer.querySelectorAll('p, h3');
            paragraphs.forEach(p => {
                if (p.tagName === 'H3') {
                    content += `\n\n${p.textContent}\n\n`;
                } else {
                    content += `${p.textContent}\n\n`;
                }
            });
            
            // Se n√£o encontrou par√°grafos formatados, usar o texto bruto
            if (!content) {
                content = contentContainer.textContent;
            }
            
            // Montar o texto formatado (apenas o conte√∫do)
            const formattedText = content.trim();
            
            // Criar um elemento de link para download
            const element = document.createElement('a');
            const file = new Blob([formattedText], {type: 'text/plain'});
            element.href = URL.createObjectURL(file);
            element.download = `materia_${title.substring(0, 30).replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        async function analyzeSEO() {
            const url = document.getElementById('seo-url').value.trim();
            
            if (!url) {
                alert('Por favor, digite uma URL v√°lida');
                return;
            }
            
            addMessage('#seo-messages', 'user', `Analisar SEO: ${url}`);
            
            const loading = showLoading('#seo-messages');
            
            try {
                const response = await fetch('/api/analyze-seo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url })
                });
                
                const data = await response.json();
                removeLoading(loading);
                
                if (data.error) {
                    addMessage('#seo-messages', 'bot', `Erro: ${data.error}`, '‚ùå');
                } else {
                    const seoData = data.seoData;
                    const suggestions = data.suggestions;
                    
                    const resultHtml = `
                        <div class="result-section">
                            <h3>üìä Dados SEO Coletados</h3>
                            <div class="seo-data">
                                <div class="seo-item">
                                    <h4>T√≠tulo</h4>
                                    <p>${seoData.title || 'N√£o encontrado'}</p>
                                </div>
                                <div class="seo-item">
                                    <h4>Meta Description</h4>
                                    <p>${seoData.metaDescription || 'N√£o encontrada'}</p>
                                </div>
                                <div class="seo-item">
                                    <h4>Tags H1</h4>
                                    <p>${seoData.h1Tags.length || 0}</p>
                                </div>
                                <div class="seo-item">
                                    <h4>Tags H2</h4>
                                    <p>${seoData.h2Tags.length || 0}</p>
                                </div>
                                <div class="seo-item">
                                    <h4>Imagens</h4>
                                    <p>${seoData.images.length || 0}</p>
                                </div>
                                <div class="seo-item">
                                    <h4>Links Internos</h4>
                                    <p>${seoData.internalLinks || 0}</p>
                                </div>
                                <div class="seo-item">
                                    <h4>Links Externos</h4>
                                    <p>${seoData.externalLinks || 0}</p>
                                </div>
                                <div class="seo-item">
                                    <h4>Tamanho do Conte√∫do</h4>
                                    <p>${seoData.textContent || 0} caracteres</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-section">
                            <h3>üí° Sugest√µes de Melhoria</h3>
                            <div class="pre-formatted">${suggestions}</div>
                        </div>
                    `;
                    
                    addMessage('#seo-messages', 'bot', resultHtml, 'üîç');
                }
            } catch (error) {
                removeLoading(loading);
                addMessage('#seo-messages', 'bot', `Erro de conex√£o: ${error.message}`, '‚ùå');
            }
        }
        
        function formatArticleContent(content) {
            // Verificar se o conte√∫do est√° no formato antigo ou no novo formato
            if (typeof content === 'object') {
                // Novo formato: objeto com t√≠tulo, subt√≠tulo e conte√∫do
                const { title, subtitle, content: mainContent, tags, longTailKeyword } = content;
                
                // Escapar corretamente o conte√∫do para uso em strings JavaScript
                const escapedMainContent = mainContent
                    .replace(/'/g, "\\'")
                    .replace(/"/g, '\\"')
                    // N√£o substituir \n por \\n para evitar problemas de exibi√ß√£o
                    .replace(/\r/g, '');
                
                // Escapar t√≠tulo, subt√≠tulo e tags
                const escapedTitle = title.replace(/'/g, "\\'").replace(/"/g, '\\"');
                const escapedSubtitle = subtitle.replace(/'/g, "\\'").replace(/"/g, '\\"');
                const escapedTags = tags.replace(/'/g, "\\'").replace(/"/g, '\\"');
                const escapedKeyword = longTailKeyword.replace(/'/g, "\\'").replace(/"/g, '\\"');
                
                // Criar HTML formatado
                return `
                    <div class="article-formatted">
                        <div class="article-section">
                            <div class="section-header">
                                <h4>T√≠tulo</h4>
                                <button class="copy-btn" onclick="copyToClipboard('${escapedTitle}')">Copiar</button>
                            </div>
                            <div class="section-content">
                                <h2>${title}</h2>
                            </div>
                        </div>
                        
                        <div class="article-section">
                            <div class="section-header">
                                <h4>Subt√≠tulo</h4>
                                <button class="copy-btn" onclick="copyToClipboard('${escapedSubtitle}')">Copiar</button>
                            </div>
                            <div class="section-content">
                                <p><em>${subtitle}</em></p>
                            </div>
                        </div>
                        
                        <div class="article-section">
                            <div class="section-header">
                                <h4>Tags</h4>
                                <button class="copy-btn" onclick="copyToClipboard('${escapedTags}')">Copiar</button>
                            </div>
                            <div class="section-content">
                                <div class="tags-container">
                                    ${tags.split(',').map(tag => `<span class="tag">${tag.trim()}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <div class="article-section">
                            <div class="section-header">
                                <h4>Palavra-chave de Cauda Longa</h4>
                                <button class="copy-btn" onclick="copyToClipboard('${escapedKeyword}')">Copiar</button>
                            </div>
                            <div class="section-content">
                                <p class="keyword">${longTailKeyword}</p>
                            </div>
                        </div>
                        
                        <div class="article-section article-content-section">
                            <div class="content-with-copy">
                                <button class="copy-btn content-copy-btn" onclick="copyPlainText('content')">Copiar</button>
                                <div id="content" class="article-content">${mainContent}</div>
                            </div>
                        </div>
                        
                        <div class="article-actions" style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="copy-all-btn" onclick="copyFullArticle()">Copiar Tudo</button>
                            <button class="save-article-btn" onclick="saveArticleForLater()" style="background: linear-gradient(135deg, #8e44ad, #9b59b6); color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; display: flex; align-items: center;">
                                <span style="margin-right: 5px;">üíæ</span> Salvar para depois
                            </button>
                        </div>
                    </div>
                `;
            } else {
                // Formato antigo: texto com se√ß√µes
                let title = '';
                let subtitle = '';
                let tags = '';
                let longTailKeyword = '';
                let mainContent = '';
                
                // Extrair t√≠tulo
                const titleMatch = content.match(/T√çTULO:\s*(.*?)(?=\n|SUBT√çTULO:|$)/s);
                if (titleMatch) {
                    title = titleMatch[1].trim();
                }
                
                // Extrair subt√≠tulo
                const subtitleMatch = content.match(/SUBT√çTULO:\s*(.*?)(?=\n|TAGS:|$)/s);
                if (subtitleMatch) {
                    subtitle = subtitleMatch[1].trim();
                }
                
                // Extrair tags
                const tagsMatch = content.match(/TAGS:\s*(.*?)(?=\n|PALAVRA-CHAVE DE CAUDA LONGA:|$)/s);
                if (tagsMatch) {
                    tags = tagsMatch[1].trim();
                }
                
                // Extrair palavra-chave de cauda longa
                const keywordMatch = content.match(/PALAVRA-CHAVE DE CAUDA LONGA:\s*(.*?)(?=\n|CONTE√öDO:|$)/s);
                if (keywordMatch) {
                    longTailKeyword = keywordMatch[1].trim();
                }
                
                // Extrair conte√∫do principal
                const contentMatch = content.match(/CONTE√öDO:\s*([\s\S]*)/);
                if (contentMatch) {
                    mainContent = contentMatch[1].trim();
                } else {
                    // Se n√£o encontrar a estrutura esperada, usar o conte√∫do original
                    mainContent = content;
                }
                
                // Remover hashtags do conte√∫do principal
                mainContent = mainContent.replace(/^#+\s*/gm, '');
                
                // Escapar corretamente o conte√∫do para uso em strings JavaScript
                const escapedTitle = title.replace(/'/g, "\\'").replace(/"/g, '\\"');
                const escapedSubtitle = subtitle.replace(/'/g, "\\'").replace(/"/g, '\\"');
                const escapedTags = tags.replace(/'/g, "\\'").replace(/"/g, '\\"');
                const escapedKeyword = longTailKeyword.replace(/'/g, "\\'").replace(/"/g, '\\"');
                
                // Criar HTML formatado
                return `
                    <div class="article-formatted">
                        <div class="article-section">
                            <div class="section-header">
                                <h4>T√≠tulo</h4>
                                <button class="copy-btn" onclick="copyToClipboard('${escapedTitle}')">Copiar</button>
                            </div>
                            <div class="section-content">
                                <h2>${title}</h2>
                            </div>
                        </div>
                        
                        <div class="article-section">
                            <div class="section-header">
                                <h4>Subt√≠tulo</h4>
                                <button class="copy-btn" onclick="copyToClipboard('${escapedSubtitle}')">Copiar</button>
                            </div>
                            <div class="section-content">
                                <p><em>${subtitle}</em></p>
                            </div>
                        </div>
                        
                        <div class="article-section">
                            <div class="section-header">
                                <h4>Tags</h4>
                                <button class="copy-btn" onclick="copyToClipboard('${escapedTags}')">Copiar</button>
                            </div>
                            <div class="section-content">
                                <div class="tags-container">
                                    ${tags.split(',').map(tag => `<span class="tag">${tag.trim()}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <div class="article-section">
                            <div class="section-header">
                                <h4>Palavra-chave de Cauda Longa</h4>
                                <button class="copy-btn" onclick="copyToClipboard('${escapedKeyword}')">Copiar</button>
                            </div>
                            <div class="section-content">
                                <p class="keyword">${longTailKeyword}</p>
                            </div>
                        </div>
                        
                        <div class="article-section article-content-section">
                            <div class="content-with-copy">
                                <button class="copy-btn content-copy-btn" onclick="copyPlainText('content')">Copiar</button>
                                <div id="content" class="article-content">${mainContent}</div>
                            </div>
                        </div>
                        
                        <div class="article-actions" style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="copy-all-btn" onclick="copyFullArticle()">Copiar Tudo</button>
                            <button class="save-article-btn" onclick="saveArticleForLater()" style="background: linear-gradient(135deg, #8e44ad, #9b59b6); color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; display: flex; align-items: center;">
                                <span style="margin-right: 5px;">üíæ</span> Salvar para depois
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function copyToClipboard(text) {
            // Verificar se o texto cont√©m HTML
            const containsHTML = /<[a-z][\s\S]*>/i.test(text);
            
            // Se contiver HTML, usar uma abordagem diferente para preservar formata√ß√£o e links
            if (containsHTML) {
                try {
                    // Criar um elemento tempor√°rio
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = text;
                    document.body.appendChild(tempDiv);
                    
                    // Selecionar o conte√∫do
                    const range = document.createRange();
                    range.selectNodeContents(tempDiv);
                    
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                    
                    // Copiar o conte√∫do formatado
                    document.execCommand('copy');
                    
                    // Limpar a sele√ß√£o e remover o elemento tempor√°rio
                    selection.removeAllRanges();
                    document.body.removeChild(tempDiv);
                    
                    showCopyNotification();
                } catch (err) {
                    console.error('Erro ao copiar texto formatado: ', err);
                    // Fallback para o m√©todo simples
                    copyPlainTextToClipboard(text);
                }
            } else {
                // Para texto simples, usar a API Clipboard ou o m√©todo fallback
                copyPlainTextToClipboard(text);
            }
        }
        
        function copyPlainTextToClipboard(text) {
            // Usar a API Clipboard moderna se dispon√≠vel
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showCopyNotification();
                    })
                    .catch(err => {
                        console.error('Erro ao copiar texto: ', err);
                        // Fallback para o m√©todo antigo
                        copyToClipboardFallback(text);
                    });
            } else {
                // M√©todo antigo como fallback
                copyToClipboardFallback(text);
            }
        }
        
        function copyToClipboardFallback(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                showCopyNotification();
            } catch (err) {
                console.error('Erro ao copiar texto: ', err);
                alert('N√£o foi poss√≠vel copiar o texto. Por favor, tente novamente.');
            } finally {
                document.body.removeChild(textarea);
            }
        }
        
        function copyPlainText(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            // Copiar o texto com formata√ß√£o HTML
            copyToClipboard(element.innerHTML);
        }
        
        function copyFullArticle() {
            // Obter os elementos
            const title = document.querySelector('.article-formatted .section-content h2').textContent;
            const subtitle = document.querySelector('.article-formatted .section-content em').textContent;
            const contentElement = document.querySelector('.article-formatted .article-content');
            const content = contentElement.innerHTML || contentElement.textContent;
            
            // Montar o texto completo com HTML
            const fullText = `<h1>${title}</h1><h2>${subtitle}</h2>${content}`;
            
            // Copiar o texto com formata√ß√£o
            copyToClipboard(fullText);
        }
        
        function showCopyNotification() {
            // Feedback visual
            const notification = document.createElement('div');
            notification.className = 'copy-notification';
            notification.textContent = 'Copiado!';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 1500);
            }, 10);
        }

        async function rewriteContent() {
            const url = document.getElementById('rewrite-url').value.trim();
            const tone = document.getElementById('rewrite-tone').value;
            const observation = document.getElementById('rewrite-observation').value.trim();
            
            if (!url) {
                alert('Por favor, digite uma URL v√°lida');
                return;
            }
            
            addMessage('#rewrite-messages', 'user', `Reescrever conte√∫do de: ${url} (Tom: ${tone})${observation ? ' | Observa√ß√£o: ' + observation : ''}`);
            
            const loading = showLoading('#rewrite-messages');
            
            try {
                const response = await fetch('/api/rewrite-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url, tone, observation })
                });
                
                const data = await response.json();
                removeLoading(loading);
                
                if (data.error) {
                    addMessage('#rewrite-messages', 'bot', `Erro: ${data.error}`, '‚ùå');
                } else {
                    const resultHtml = `
                        <div class="result-section">
                            <h3>üìÑ Conte√∫do Original</h3>
                            <h4><strong>${data.original.title}</strong></h4>
                            <p><em>${data.original.wordCount} palavras</em></p>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                ${data.original.content}
                            </div>
                        </div>
                        
                        <div class="result-section">
                            <h3>‚úçÔ∏è Conte√∫do Reescrito</h3>
                            ${formatArticleContent(data.rewritten)}
                        </div>
                    `;
                    
                    addMessage('#rewrite-messages', 'bot', resultHtml, '‚úçÔ∏è');
                }
            } catch (error) {
                removeLoading(loading);
                addMessage('#rewrite-messages', 'bot', `Erro de conex√£o: ${error.message}`, '‚ùå');
            }
        }

        async function createArticle() {
            const keyword = document.getElementById('create-keyword').value.trim();
            const tone = document.getElementById('create-tone').value;
            const useGoogle = document.getElementById('use-google').checked;
            const useGnews = document.getElementById('use-gnews').checked;
            
            if (!keyword) {
                alert('Por favor, digite uma palavra-chave');
                return;
            }
            
            addMessage('#create-messages', 'user', `Criar mat√©ria sobre: "${keyword}" (Tom: ${tone}, Pesquisar: ${useGoogle ? 'Sim' : 'N√£o'}, GNews: ${useGnews ? 'Sim' : 'N√£o'})`);
            
            const loading = showLoading('#create-messages');
            
            try {
                const response = await fetch('/api/create-article', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        keyword, 
                        tone, 
                        length: 'm√©dio',
                        useGoogle,
                        useGnews
                    })
                });
                
                const data = await response.json();
                removeLoading(loading);
                
                if (data.error) {
                    // Verificar se √© um erro de verifica√ß√£o de fatos
                    if (data.isFactualError) {
                        // Exibir mensagem de alerta com estilo diferenciado
                        const errorHtml = `
                            <div class="result-section" style="border-left-color: #ff4d4f;">
                                <h3>‚ö†Ô∏è Alerta de Verifica√ß√£o de Fatos</h3>
                                <p>${data.error}</p>
                                <p style="margin-top: 10px;">Por favor, tente outro tema ou verifique a veracidade da informa√ß√£o antes de prosseguir.</p>
                            </div>
                        `;
                        addMessage('#create-messages', 'bot', errorHtml, 'üîç');
                    } else {
                        // Erro normal
                        addMessage('#create-messages', 'bot', `Erro: ${data.error}`, '‚ùå');
                    }
                } else {
                    // Verificar se h√° fontes v√°lidas
                    const validSources = data.sources.filter(source => source.url && source.url !== '#');
                    
                    let sourcesHtml = '';
                    if (validSources.length > 0) {
                        sourcesHtml = `
                            <div class="result-section">
                                <h3>üìö Fontes Consultadas</h3>
                                <ul style="margin-left: 20px;">
                                    ${validSources.map(source => 
                                        `<li><strong>${source.title}</strong> - <a href="${source.url}" target="_blank">${source.source}</a></li>`
                                    ).join('')}
                                </ul>
                            </div>
                        `;
                    } else {
                        sourcesHtml = `
                            <div class="result-section" style="border-left-color: #ffc107;">
                                <h3>üìö Informa√ß√£o sobre Fontes</h3>
                                <p>N√£o foi poss√≠vel encontrar fontes espec√≠ficas sobre este tema, mas a mat√©ria foi criada com base em informa√ß√µes gen√©ricas dispon√≠veis.</p>
                            </div>
                        `;
                    }
                    
                    const resultHtml = `
                        ${sourcesHtml}
                        
                        <div class="result-section">
                            <h3>üì∞ Mat√©ria Criada</h3>
                            ${formatArticleContent(data.article)}
                        </div>
                        
                        <div class="result-section">
                            <h3>üí¨ Melhorar Mat√©ria</h3>
                            <p class="chat-instruction">Converse com a IA para melhorar sua mat√©ria. Voc√™ pode pedir para alterar o t√≠tulo, reescrever partes, adicionar links, etc.</p>
                            <div class="article-chat-messages" id="article-chat-messages">
                                <!-- Mensagens de chat ser√£o adicionadas aqui -->
                            </div>
                            <div class="article-chat-input">
                                <textarea id="article-chat-input" placeholder="Ex: Reescreva o t√≠tulo para ficar mais atrativo..." rows="1" oninput="autoResize(this)"></textarea>
                                <button class="send-button" onclick="sendArticleChat('${keyword.replace(/'/g, "\\'")}')">‚û§</button>
                            </div>
                        </div>
                    `;
                    
                    addMessage('#create-messages', 'bot', resultHtml, 'üì∞');
                }
            } catch (error) {
                removeLoading(loading);
                addMessage('#create-messages', 'bot', `Erro de conex√£o: ${error.message}`, '‚ùå');
            }
        }

        // Event listeners para Enter
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendChatMessage();
            }
        });

        document.getElementById('seo-url').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                analyzeSEO();
            }
        });

        document.getElementById('rewrite-url').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                rewriteContent();
            }
        });

        document.getElementById('create-keyword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                createArticle();
            }
        });
        
        // Adicionar event listener para o chat da mat√©ria dinamicamente
        document.addEventListener('click', function(e) {
            // Verificar se o elemento article-chat-input existe
            const chatInput = document.getElementById('article-chat-input');
            if (chatInput && e.target === chatInput) {
                // Adicionar event listener apenas uma vez
                if (!chatInput.hasKeyPressListener) {
                    chatInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            const keyword = document.getElementById('create-keyword').value.trim();
                            sendArticleChat(keyword);
                        }
                    });
                    chatInput.hasKeyPressListener = true;
                }
            }
        });
        
        // Vari√°veis globais para armazenar o √∫ltimo artigo gerado
        let lastGeneratedArticle = null;
        let eventSource = null;
        
        // Fun√ß√£o para conectar ao servidor de eventos
        function connectToEventSource() {
            if (eventSource) {
                eventSource.close();
            }
            
            eventSource = new EventSource('/api/progress-events');
            
            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);
                updateProgressSteps(data.event, data.message);
            };
            
            eventSource.onerror = function() {
                console.error('Erro na conex√£o SSE');
                eventSource.close();
                setTimeout(connectToEventSource, 5000); // Tentar reconectar ap√≥s 5 segundos
            };
        }
        
        // Conectar ao servidor de eventos quando a p√°gina carregar
        window.addEventListener('load', connectToEventSource);
        
        // Fun√ß√£o para atualizar os passos de progresso
        function updateProgressSteps(event, message) {
            // Verificar se h√° um indicador de carregamento vis√≠vel
            const loadingElement = document.querySelector('.loading-message');
            if (!loadingElement) return;
            
            // Atualizar os indicadores de progresso com base no evento
            switch(event) {
                case 'search_start':
                    updateStepIndicator('step-search', '‚è≥');
                    break;
                case 'verification_complete':
                    updateStepIndicator('step-search', '‚úì');
                    updateStepIndicator('step-verify', '‚è≥');
                    break;
                case 'extraction_start':
                    updateStepIndicator('step-verify', '‚úì');
                    updateStepIndicator('step-extract', '‚è≥');
                    break;
                case 'extraction_complete':
                    updateStepIndicator('step-extract', '‚úì');
                    updateStepIndicator('step-generate', '‚è≥');
                    break;
                case 'generating_start':
                    updateStepIndicator('step-extract', '‚úì');
                    updateStepIndicator('step-generate', '‚è≥');
                    break;
                case 'generating_complete':
                    updateStepIndicator('step-generate', '‚úì');
                    updateStepIndicator('step-process', '‚è≥');
                    break;
                case 'formatting_complete':
                case 'article_complete':
                    updateStepIndicator('step-process', '‚úì');
                    break;
            }
        }
        
        // Fun√ß√£o auxiliar para atualizar um indicador de passo
        function updateStepIndicator(id, status) {
            const indicator = document.getElementById(id);
            if (indicator) {
                indicator.textContent = status;
            }
        }
        
        async function sendArticleChat(keyword) {
            const input = document.getElementById('article-chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Adicionar mensagem do usu√°rio ao chat
            addArticleChatMessage('user', message);
            
            // Limpar campo de entrada
            input.value = '';
            input.style.height = 'auto';
            
            // Mostrar indicador de carregamento
            const loading = showArticleChatLoading();
            
            try {
                // Obter o artigo atual
                const articleTitle = document.querySelector('.article-formatted .section-content h2').textContent;
                const articleSubtitle = document.querySelector('.article-formatted .section-content em').textContent;
                const articleContent = document.querySelector('.article-formatted .article-content').innerHTML;
                const articleTags = Array.from(document.querySelectorAll('.article-formatted .tags-container .tag'))
                    .map(tag => tag.textContent)
                    .join(', ');
                const articleKeyword = document.querySelector('.article-formatted .keyword').textContent;
                
                // Criar prompt para a IA
                const prompt = `[Assistente IA - Editando Mat√©ria]

Voc√™ est√° ajudando a melhorar uma mat√©ria jornal√≠stica sobre "${keyword}".
                
Mat√©ria atual:

T√çTULO: ${articleTitle}

SUBT√çTULO: ${articleSubtitle}

TAGS: ${articleTags}

PALAVRA-CHAVE DE CAUDA LONGA: ${articleKeyword}

CONTE√öDO:
${articleContent.replace(/<[^>]*>/g, '')}

O usu√°rio deseja a seguinte modifica√ß√£o: "${message}"

Por favor, forne√ßa a vers√£o atualizada da mat√©ria com as modifica√ß√µes solicitadas. 

IMPORTANTE: Sua resposta DEVE seguir EXATAMENTE este formato para ser corretamente processada:

T√çTULO: [t√≠tulo atualizado]
SUBT√çTULO: [subt√≠tulo atualizado]
TAGS: [tags atualizadas]
PALAVRA-CHAVE DE CAUDA LONGA: [palavra-chave atualizada]
CONTE√öDO: [conte√∫do atualizado]

REGRAS CR√çTICAS:
1. NUNCA invente nomes, datas, locais ou fatos que n√£o estejam presentes no texto original.
2. Use APENAS as informa√ß√µes presentes no texto fornecido.
3. Se for solicitado para adicionar um nome espec√≠fico ao t√≠tulo ou texto, use APENAS nomes que j√° aparecem no conte√∫do original.
4. Se for pedido para mencionar uma pessoa, verifique o nome correto no texto original.
5. Mantenha a precis√£o factual do conte√∫do original.

INSTRU√á√ïES IMPORTANTES:
1. Mantenha a estrutura de H3 para os subt√≠tulos no conte√∫do. N√£o use marcadores ** para subt√≠tulos, use tags <h3> em vez disso.
2. Mantenha TOTAL COER√äNCIA com o tema central da mat√©ria. N√£o adicione informa√ß√µes que n√£o estejam relacionadas ao assunto principal.
3. N√£o inclua conte√∫do religioso, m√≠stico ou espiritual (como "a volta de Jesus") a menos que a mat√©ria original j√° trate especificamente desse tema.
4. Qualquer adi√ß√£o de conte√∫do deve ser factual, jornal√≠stica e diretamente relacionada ao tema principal da mat√©ria.
5. Se o usu√°rio solicitar adi√ß√µes que n√£o s√£o coerentes com o tema (como adicionar conte√∫do religioso a uma mat√©ria pol√≠tica), adapte o pedido para manter a integridade jornal√≠stica e a coer√™ncia tem√°tica.`;

                // Enviar para a API
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: prompt })
                });
                
                const data = await response.json();
                removeArticleChatLoading(loading);
                
                if (data.error) {
                    addArticleChatMessage('bot', `Erro: ${data.error}`);
                } else {
                    // Processar a resposta para extrair as partes atualizadas
                    const response = data.response;
                    
                    // Extrair t√≠tulo
                    let updatedTitle = articleTitle;
                    const titleMatch = response.match(/T√çTULO:\s*(.*?)(?=\n|SUBT√çTULO:|$)/s);
                    if (titleMatch) updatedTitle = titleMatch[1].trim();
                    
                    // Extrair subt√≠tulo
                    let updatedSubtitle = articleSubtitle;
                    const subtitleMatch = response.match(/SUBT√çTULO:\s*(.*?)(?=\n|TAGS:|$)/s);
                    if (subtitleMatch) updatedSubtitle = subtitleMatch[1].trim();
                    
                    // Extrair tags
                    let updatedTags = articleTags;
                    const tagsMatch = response.match(/TAGS:\s*(.*?)(?=\n|PALAVRA-CHAVE DE CAUDA LONGA:|$)/s);
                    if (tagsMatch) updatedTags = tagsMatch[1].trim();
                    
                    // Extrair palavra-chave
                    let updatedKeyword = articleKeyword;
                    const keywordMatch = response.match(/PALAVRA-CHAVE DE CAUDA LONGA:\s*(.*?)(?=\n|CONTE√öDO:|$)/s);
                    if (keywordMatch) updatedKeyword = keywordMatch[1].trim();
                    
                    // Extrair conte√∫do
                    let updatedContent = articleContent;
                    const contentMatch = response.match(/CONTE√öDO:\s*([\s\S]*)/);
                    if (contentMatch) {
                        updatedContent = contentMatch[1].trim();
                        // Garantir que os subt√≠tulos estejam em H3
                        updatedContent = updatedContent.replace(/\*\*(.*?)\*\*/g, '<h3>$1</h3>');
                    }
                    
                    // Atualizar o artigo na p√°gina
                    document.querySelector('.article-formatted .section-content h2').textContent = updatedTitle;
                    document.querySelector('.article-formatted .section-content em').textContent = updatedSubtitle;
                    document.querySelector('.article-formatted .article-content').innerHTML = updatedContent;
                    
                    // Atualizar tags
                    const tagsContainer = document.querySelector('.article-formatted .tags-container');
                    tagsContainer.innerHTML = updatedTags.split(',').map(tag => `<span class="tag">${tag.trim()}</span>`).join('');
                    
                    // Atualizar palavra-chave
                    document.querySelector('.article-formatted .keyword').textContent = updatedKeyword;
                    
                    // Atualizar bot√µes de c√≥pia
                    document.querySelectorAll('.article-formatted .copy-btn').forEach((btn, index) => {
                        if (index === 0) btn.onclick = () => copyToClipboard(updatedTitle);
                        if (index === 1) btn.onclick = () => copyToClipboard(updatedSubtitle);
                        if (index === 2) btn.onclick = () => copyToClipboard(updatedTags);
                        if (index === 3) btn.onclick = () => copyToClipboard(updatedKeyword);
                    });
                    
                    // Garantir que o bot√£o de copiar conte√∫do use a fun√ß√£o copyPlainText
                    document.querySelector('.article-formatted .content-copy-btn').onclick = () => copyPlainText('content');
                    
                    // Atualizar bot√£o de copiar tudo
                    document.querySelector('.article-formatted .copy-all-btn').onclick = copyFullArticle;
                    
                    // Adicionar mensagem de resposta
                    addArticleChatMessage('bot', 'Mat√©ria atualizada com sucesso! As altera√ß√µes foram aplicadas conforme solicitado.');
                }
            } catch (error) {
                removeArticleChatLoading(loading);
                addArticleChatMessage('bot', `Erro de conex√£o: ${error.message}`);
            }
        }
        
        function addArticleChatMessage(type, content) {
            const messagesContainer = document.getElementById('article-chat-messages');
            const messageRowDiv = document.createElement('div');
            messageRowDiv.className = `message-row ${type}`;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            const avatarText = type === 'user' ? 'üë§' : 'AI';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatarText}</div>
                <div class="message-content pre-formatted">${content}</div>
            `;
            
            messageRowDiv.appendChild(messageDiv);
            messagesContainer.appendChild(messageRowDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function showArticleChatLoading() {
            const messagesContainer = document.getElementById('article-chat-messages');
            const loadingRowDiv = document.createElement('div');
            loadingRowDiv.className = 'message-row bot loading-message';
            
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message';
            
            loadingDiv.innerHTML = `
                <div class="message-avatar">AI</div>
                <div class="message-content">
                    <div class="loading">
                        <div class="spinner"></div>
                        Atualizando mat√©ria...
                    </div>
                </div>
            `;
            
            loadingRowDiv.appendChild(loadingDiv);
            messagesContainer.appendChild(loadingRowDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            return loadingRowDiv;
        }
        
        function removeArticleChatLoading(loadingElement) {
            if (loadingElement && loadingElement.parentNode) {
                loadingElement.parentNode.removeChild(loadingElement);
            }
        }

        // Fun√ß√µes para edi√ß√£o de texto
        function startEditing(contentDiv) {
            console.log('Iniciando edi√ß√£o para:', contentDiv.id);
            // Guardar o conte√∫do original
            const originalContent = contentDiv.innerHTML;
            
            // Verificar se estamos editando uma mat√©ria reescrita
            const isArticle = contentDiv.querySelector('.article-content') !== null;
            
            // Extrair conte√∫do para o modo visual, preservando a estrutura HTML
            const visualContent = preserveHtmlStructure(originalContent);
            
            // Criar container para o editor (com estilo fullscreen melhorado)
            const editorContainer = document.createElement('div');
            editorContainer.className = 'editor-container';
            editorContainer.style.position = 'fixed';
            editorContainer.style.top = '0';
            editorContainer.style.left = '0';
            editorContainer.style.width = '100%';
            editorContainer.style.height = '100%';
            editorContainer.style.zIndex = '9999';
            editorContainer.style.background = 'var(--background-color)';
            editorContainer.style.display = 'flex';
            editorContainer.style.flexDirection = 'column';
            editorContainer.style.fontFamily = 'Inter, sans-serif';
            
            // Criar cabe√ßalho do editor
            const editorHeader = document.createElement('div');
            editorHeader.style.background = 'var(--primary-color)';
            editorHeader.style.color = 'white';
            editorHeader.style.padding = '15px 20px';
            editorHeader.style.fontWeight = 'bold';
            editorHeader.style.fontSize = '18px';
            editorHeader.style.display = 'flex';
            editorHeader.style.justifyContent = 'space-between';
            editorHeader.style.alignItems = 'center';
            
            editorHeader.innerHTML = `
                <div>Editando ${isArticle ? 'Mat√©ria' : 'Conte√∫do'}</div>
                <button id="close-editor-btn" style="background: none; border: 1px solid white; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Fechar ‚úï</button>
            `;
            
            // Adicionar evento de clique ao bot√£o depois de cri√°-lo no DOM
            setTimeout(() => {
                const closeBtn = document.getElementById('close-editor-btn');
                if (closeBtn) {
                    closeBtn.onclick = function() {
                        cancelEdits(document.getElementById(contentDiv.id), originalContent);
                    };
                }
            }, 0);
            
            // Criar barra de ferramentas
            const toolbar = document.createElement('div');
            toolbar.className = 'editor-toolbar';
            toolbar.style.padding = '15px';
            toolbar.style.background = 'var(--surface-hover)';
            toolbar.style.borderBottom = '1px solid var(--border-color)';
            toolbar.innerHTML = `
                <button type="button" title="T√≠tulo H1" onclick="formatText('h1')" style="font-size: 16px; padding: 8px 12px; margin-right: 5px;">H1</button>
                <button type="button" title="T√≠tulo H2" onclick="formatText('h2')" style="font-size: 16px; padding: 8px 12px; margin-right: 5px;">H2</button>
                <button type="button" title="T√≠tulo H3" onclick="formatText('h3')" style="font-size: 16px; padding: 8px 12px; margin-right: 5px;">H3</button>
                <div class="separator" style="display: inline-block; width: 1px; height: 20px; background: var(--border-color); margin: 0 10px; vertical-align: middle;"></div>
                <button type="button" title="Negrito" onclick="formatText('bold')" style="font-weight: bold; font-size: 16px; padding: 8px 12px; margin-right: 5px;">B</button>
                <button type="button" title="It√°lico" onclick="formatText('italic')" style="font-style: italic; font-size: 16px; padding: 8px 12px; margin-right: 5px;">I</button>
                <button type="button" title="Sublinhado" onclick="formatText('underline')" style="text-decoration: underline; font-size: 16px; padding: 8px 12px; margin-right: 5px;">U</button>
                <div class="separator" style="display: inline-block; width: 1px; height: 20px; background: var(--border-color); margin: 0 10px; vertical-align: middle;"></div>
                <button type="button" title="Inserir Link" onclick="showLinkDialog()" style="font-size: 16px; padding: 8px 12px; margin-right: 5px;">üîó Link</button>
                <div class="separator" style="display: inline-block; width: 1px; height: 20px; background: var(--border-color); margin: 0 10px; vertical-align: middle;"></div>
                <button type="button" id="toggle-edit-mode" title="Alternar Modo de Edi√ß√£o" onclick="toggleEditMode()" style="font-size: 16px; padding: 8px 12px; margin-right: 5px;">üîÑ Modo Visual</button>
                <div class="separator" style="display: inline-block; width: 1px; height: 20px; background: var(--border-color); margin: 0 10px; vertical-align: middle;"></div>
                <button type="button" title="Assistente IA" onclick="toggleAIPanel()" style="font-size: 16px; padding: 8px 12px; margin-right: 5px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border: none; border-radius: 5px;">ü§ñ Assistente IA</button>
            `;
            
            // Criar √°rea principal com editor e painel de IA (layout melhorado)
            const mainArea = document.createElement('div');
            mainArea.style.display = 'flex';
            mainArea.style.flex = '1';
            mainArea.style.position = 'relative';
            mainArea.style.maxWidth = '1400px';
            mainArea.style.margin = '0 auto';
            mainArea.style.width = '100%';
            mainArea.style.padding = '0 20px';
            
            // Criar textarea para edi√ß√£o (layout centralizado)
            const textarea = document.createElement('textarea');
            textarea.className = 'message-editable';
            textarea.id = 'current-editor';
            textarea.value = visualContent;
            textarea.dataset.originalContent = originalContent;
            textarea.dataset.editMode = 'visual';
            textarea.dataset.visualContent = visualContent;
            textarea.dataset.codeContent = originalContent;
            textarea.style.flex = '1';
            textarea.style.minHeight = '70vh';
            textarea.style.padding = '30px';
            textarea.style.fontSize = '16px';
            textarea.style.lineHeight = '1.8';
            textarea.style.color = '#fff';
            textarea.style.background = 'var(--surface-color)';
            textarea.style.border = '2px solid var(--border-color)';
            textarea.style.borderRadius = '12px';
            textarea.style.outline = 'none';
            textarea.style.resize = 'none';
            textarea.style.fontFamily = 'Inter, -apple-system, BlinkMacSystemFont, sans-serif';
            textarea.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.3)';
            textarea.style.transition = 'border-color 0.3s ease';
            
            // Adicionar evento de foco para destacar o editor
            textarea.addEventListener('focus', function() {
                this.style.borderColor = 'var(--primary-color)';
                this.style.boxShadow = '0 0 0 4px rgba(16, 163, 127, 0.1), 0 4px 20px rgba(0, 0, 0, 0.3)';
            });

            textarea.addEventListener('blur', function() {
                this.style.borderColor = 'var(--border-color)';
                this.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.3)';
            });
            
            // Criar painel lateral de IA (design melhorado)
            const aiPanel = document.createElement('div');
            aiPanel.id = 'ai-side-panel';
            aiPanel.style.width = '0';
            aiPanel.style.height = '100%';
            aiPanel.style.background = 'var(--surface-hover)';
            aiPanel.style.backgroundColor = '#1a1a1a';
            aiPanel.style.borderLeft = '2px solid var(--border-color)';
            aiPanel.style.borderRadius = '12px 0 0 12px';
            aiPanel.style.position = 'absolute';
            aiPanel.style.right = '0';
            aiPanel.style.top = '0';
            aiPanel.style.transition = 'width 0.3s ease';
            aiPanel.style.display = 'flex';
            aiPanel.style.flexDirection = 'column';
            aiPanel.style.overflow = 'hidden';
            aiPanel.style.boxShadow = '-4px 0 20px rgba(0, 0, 0, 0.2)';
            
            // Cabe√ßalho do painel de IA
            const aiPanelHeader = document.createElement('div');
            aiPanelHeader.style.padding = '15px';
            aiPanelHeader.style.borderBottom = '1px solid var(--border-color)';
            aiPanelHeader.style.display = 'flex';
            aiPanelHeader.style.justifyContent = 'space-between';
            aiPanelHeader.style.alignItems = 'center';
            aiPanelHeader.innerHTML = `
                <h3 style="margin: 0; color: var(--primary-color);">ü§ñ Assistente IA</h3>
                <button onclick="toggleAIPanel()" style="background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 18px;">‚úï</button>
            `;
            
            // √Årea de sugest√µes r√°pidas
            const quickSuggestionsArea = document.createElement('div');
            quickSuggestionsArea.style.padding = '15px';
            quickSuggestionsArea.style.borderBottom = '1px solid var(--border-color)';
            
            quickSuggestionsArea.innerHTML = `
                <h4 style="margin-top: 0; color: var(--text-secondary);">Sugest√µes r√°pidas</h4>
                
                
                <div>
                    <h5 style="margin: 10px 0 5px 0; color: var(--text-secondary); font-size: 13px;">Melhorar conte√∫do:</h5>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <button onclick="useAIPrompt('Melhore a introdu√ß√£o para capturar a aten√ß√£o do leitor')" style="background: rgba(16, 163, 127, 0.1); border: 1px solid var(--primary-color); color: var(--primary-color); padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 13px;">Melhorar introdu√ß√£o</button>
                        <button onclick="useAIPrompt('Torne a conclus√£o mais impactante e memor√°vel')" style="background: rgba(16, 163, 127, 0.1); border: 1px solid var(--primary-color); color: var(--primary-color); padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 13px;">Conclus√£o impactante</button>
                        <button onclick="useAIPrompt('Reescreva o texto selecionado para ficar mais claro e objetivo')" style="background: rgba(16, 163, 127, 0.1); border: 1px solid var(--primary-color); color: var(--primary-color); padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 13px;">Melhorar sele√ß√£o</button>
                        <button onclick="useAIPrompt('Adicione mais detalhes e informa√ß√µes relevantes ao texto')" style="background: rgba(16, 163, 127, 0.1); border: 1px solid var(--primary-color); color: var(--primary-color); padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 13px;">Adicionar detalhes</button>
                        <button onclick="useAIPrompt('Simplifique o texto para melhorar a legibilidade')" style="background: rgba(16, 163, 127, 0.1); border: 1px solid var(--primary-color); color: var(--primary-color); padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 13px;">Simplificar texto</button>
                        <button onclick="useAIPrompt('Torne o texto mais persuasivo e envolvente')" style="background: rgba(16, 163, 127, 0.1); border: 1px solid var(--primary-color); color: var(--primary-color); padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 13px;">Mais persuasivo</button>
                    </div>
                </div>
            `;
            
            // √Årea de entrada de instru√ß√µes
            const aiInputArea = document.createElement('div');
            aiInputArea.style.padding = '15px';
            aiInputArea.style.borderBottom = '1px solid var(--border-color)';
            
            aiInputArea.innerHTML = `
                <h4 style="margin-top: 0; color: var(--text-secondary);">Instru√ß√µes para a IA</h4>
                <textarea id="ai-instruction" placeholder="Digite suas instru√ß√µes para a IA (ex: Reescreva a conclus√£o para ser mais impactante)" style="width: 100%; height: 80px; padding: 10px; background: var(--surface-color); color: white; border: 1px solid var(--border-color); border-radius: 5px; resize: none;"></textarea>
                <button onclick="requestAIAssistance()" style="width: 100%; margin-top: 10px; background-color: #2c2c2c !important; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer;">Enviar para IA</button>
            `;
            
            // √Årea de resposta da IA
            const aiResponseArea = document.createElement('div');
            aiResponseArea.style.flex = '1';
            aiResponseArea.style.padding = '15px';
            aiResponseArea.style.display = 'flex';
            aiResponseArea.style.flexDirection = 'column';
            aiResponseArea.style.overflow = 'hidden';
            
            aiResponseArea.innerHTML = `
                <h4 style="margin-top: 0; color: var(--text-secondary);">Resposta da IA</h4>
                <div id="ai-response" style="flex: 1; overflow-y: auto; background: var(--surface-color); border: 1px solid var(--border-color); border-radius: 5px; padding: 15px; margin-bottom: 10px; color: white; font-size: 14px;">
                    <p style="color: var(--text-secondary); font-style: italic;">A resposta da IA aparecer√° aqui...</p>
                </div>
                <button id="apply-ai-changes" onclick="applyAIChanges()" style="width: 100%; background: var(--primary-color); color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; display: none;">Aplicar Mudan√ßas</button>
            `;
            
            // Adicionar componentes ao painel de IA
            aiPanel.appendChild(aiPanelHeader);
            aiPanel.appendChild(quickSuggestionsArea);
            aiPanel.appendChild(aiInputArea);
            aiPanel.appendChild(aiResponseArea);
            
            // Adicionar textarea e painel de IA √† √°rea principal
            mainArea.appendChild(textarea);
            mainArea.appendChild(aiPanel);
            
            // Criar bot√µes de a√ß√£o
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'edit-actions';
            actionsDiv.style.padding = '15px';
            actionsDiv.style.background = 'var(--surface-hover)';
            actionsDiv.style.borderTop = '1px solid var(--border-color)';
            actionsDiv.style.display = 'flex';
            actionsDiv.style.justifyContent = 'space-between';
            
            const actionsLeft = document.createElement('div');
            actionsLeft.className = 'edit-actions-left';
            
            const actionsRight = document.createElement('div');
            actionsRight.className = 'edit-actions-right';
            actionsRight.style.display = 'flex';
            actionsRight.style.gap = '10px';
            
            const saveBtn = document.createElement('button');
            saveBtn.className = 'save-edit-btn';
            saveBtn.innerHTML = '<span>üíæ</span> Salvar';
            saveBtn.style.padding = '10px 20px';
            saveBtn.style.fontSize = '16px';
            saveBtn.style.background = 'var(--primary-color)';
            saveBtn.style.color = 'white';
            saveBtn.style.border = 'none';
            saveBtn.style.borderRadius = '5px';
            saveBtn.style.cursor = 'pointer';
            saveBtn.onclick = function() {
                const currentMode = textarea.dataset.editMode;
                if (currentMode === 'visual') {
                    // No modo visual, precisamos reintegrar o conte√∫do editado na estrutura original
                    const updatedContent = updateContentInOriginalStructure(originalContent, textarea.value);
                    saveEdits(contentDiv, updatedContent, originalContent);
                } else {
                    // No modo c√≥digo, salvamos o HTML diretamente
                    saveEdits(contentDiv, textarea.value, originalContent);
                }
            };
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'cancel-edit-btn';
            cancelBtn.innerHTML = '<span>‚ùå</span> Cancelar';
            cancelBtn.style.padding = '10px 20px';
            cancelBtn.style.fontSize = '16px';
            cancelBtn.style.background = 'transparent';
            cancelBtn.style.color = 'var(--text-secondary)';
            cancelBtn.style.border = '1px solid var(--border-color)';
            cancelBtn.style.borderRadius = '5px';
            cancelBtn.style.cursor = 'pointer';
            cancelBtn.onclick = function() {
                cancelEdits(contentDiv, originalContent);
            };
            
            actionsRight.appendChild(cancelBtn);
            actionsRight.appendChild(saveBtn);
            
            actionsDiv.appendChild(actionsLeft);
            actionsDiv.appendChild(actionsRight);
            
            // Adicionar elementos ao container
            editorContainer.appendChild(editorHeader);
            editorContainer.appendChild(toolbar);
            editorContainer.appendChild(mainArea);
            editorContainer.appendChild(actionsDiv);
            
            // Adicionar dica de edi√ß√£o
            const editorTip = document.createElement('div');
            editorTip.className = 'editor-tip';
            editorTip.style.padding = '10px';
            editorTip.style.background = 'transparent'; // Removendo o fundo verde
            editorTip.style.color = 'var(--text-secondary)';
            editorTip.style.fontSize = '14px';
            editorTip.style.textAlign = 'center';
            editorTip.style.borderTop = '1px solid transparent'; // Removendo a borda verde
          
            editorContainer.appendChild(editorTip);
            
            // Adicionar ao body em vez de substituir o conte√∫do do div
            document.body.appendChild(editorContainer);
            
            // Focar no textarea
            textarea.focus();
        }
        
        // Fun√ß√£o para alternar o painel de IA
        function toggleAIPanel() {
            const aiPanel = document.getElementById('ai-side-panel');
            if (!aiPanel) return;
            
            if (aiPanel.style.width === '0px' || aiPanel.style.width === '') {
                aiPanel.style.width = '350px';
            } else {
                aiPanel.style.width = '0';
            }
        }
        
        // Fun√ß√£o para usar uma sugest√£o r√°pida
        function useAIPrompt(prompt) {
            const instructionField = document.getElementById('ai-instruction');
            if (instructionField) {
                instructionField.value = prompt;
                requestAIAssistance();
            }
        }
        
        // Fun√ß√£o para solicitar assist√™ncia da IA
        async function requestAIAssistance() {
            const instructionField = document.getElementById('ai-instruction');
            const responseArea = document.getElementById('ai-response');
            const applyButton = document.getElementById('apply-ai-changes');
            const textarea = document.getElementById('current-editor');
            
            if (!instructionField || !responseArea || !textarea) return;
            
            const instruction = instructionField.value.trim();
            if (!instruction) {
                alert('Por favor, digite uma instru√ß√£o para a IA.');
                return;
            }
            
            // Obter o texto selecionado ou todo o conte√∫do
            let selectedText = '';
            let fullText = textarea.value;
            let selectionStart = textarea.selectionStart;
            let selectionEnd = textarea.selectionEnd;
            
            if (selectionStart !== selectionEnd) {
                selectedText = fullText.substring(selectionStart, selectionEnd);
            }
            
            // Mostrar indicador de carregamento
            responseArea.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%;">
                    <div style="display: flex; align-items: center;">
                        <div style="width: 20px; height: 20px; border: 2px solid rgba(16, 163, 127, 0.3); border-top: 2px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px;"></div>
                        <span>Processando sua solicita√ß√£o...</span>
                    </div>
                </div>
            `;
            
            try {
                // Verificar se estamos editando uma mat√©ria com estrutura espec√≠fica
                const isArticle = textarea.dataset.editMode === 'visual' && 
                                 (fullText.includes('# ') || fullText.includes('## '));
                
                // Extrair t√≠tulo, subt√≠tulo e conte√∫do principal se for uma mat√©ria
                let title = '';
                let subtitle = '';
                let mainContent = fullText;
                
                if (isArticle) {
                    // Extrair t√≠tulo
                    const titleMatch = fullText.match(/^#\s+(.*?)(\n|$)/m);
                    if (titleMatch && titleMatch[1]) {
                        title = titleMatch[1].trim();
                    }
                    
                    // Extrair subt√≠tulo
                    const subtitleMatch = fullText.match(/^##\s+(.*?)(\n|$)/m);
                    if (subtitleMatch && subtitleMatch[1]) {
                        subtitle = subtitleMatch[1].trim();
                    }
                    
                    // Extrair conte√∫do principal (removendo t√≠tulo e subt√≠tulo)
                    mainContent = fullText
                        .replace(/^#\s+.*?(\n|$)/m, '')
                        .replace(/^##\s+.*?(\n|$)/m, '')
                        .trim();
                }
                
                // Determinar qual parte est√° sendo editada
                let targetPart = 'conte√∫do completo';
                let targetContent = fullText;
                
                if (selectedText) {
                    targetPart = 'texto selecionado';
                    targetContent = selectedText;
                } else if (instruction.toLowerCase().includes('t√≠tulo') || 
                           instruction.toLowerCase().includes('titulo')) {
                    targetPart = 't√≠tulo';
                    targetContent = title;
                } else if (instruction.toLowerCase().includes('subt√≠tulo') || 
                           instruction.toLowerCase().includes('subtitulo')) {
                    targetPart = 'subt√≠tulo';
                    targetContent = subtitle;
                } else if (isArticle) {
                    targetPart = 'conte√∫do principal';
                    targetContent = mainContent;
                }
                
                // Preparar o prompt para a IA
                // Preparar o prompt para a IA
const aiPrompt = `
    Voc√™ √© um assistente de edi√ß√£o de texto especializado em mat√©rias jornal√≠sticas. 
    Por favor, ajude a melhorar o seguinte texto de acordo com a instru√ß√£o fornecida.
    
    INSTRU√á√ÉO: ${instruction}
    
    CONTEXTO COMPLETO DA MAT√âRIA (para refer√™ncia):
    ${fullText}
    
    PARTE A SER EDITADA: ${targetPart}
    
    CONTE√öDO ATUAL DA PARTE:
    ${targetContent}
    
    IMPORTANTE: 
    - Use APENAS informa√ß√µes que est√£o no CONTEXTO COMPLETO DA MAT√âRIA
    - N√ÉO invente nomes, datas ou informa√ß√µes que n√£o estejam no texto
    - Baseie-se exclusivamente no conte√∫do fornecido
    - Se a instru√ß√£o mencionar "nome do pregador" ou similar, use o nome que aparece na mat√©ria
    
    Por favor, forne√ßa apenas o texto melhorado para a parte espec√≠fica mencionada, sem explica√ß√µes adicionais.
    N√£o adicione marcadores como "# " ou "## " a menos que esteja editando explicitamente o t√≠tulo ou subt√≠tulo.
    Mantenha o mesmo formato e estilo do texto original, apenas melhore o conte√∫do conforme solicitado.
`;
                
                // Armazenar informa√ß√µes sobre a parte que est√° sendo editada
                responseArea.dataset.targetPart = targetPart;
                responseArea.dataset.isArticle = isArticle;
                
                // Chamar a API
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: aiPrompt })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    responseArea.innerHTML = `<p style="color: #ff4d4f;">Erro: ${data.error}</p>`;
                    return;
                }
                
                // Exibir a resposta da IA com informa√ß√£o sobre a parte que est√° sendo editada
                let partInfo = '';
                if (targetPart === 't√≠tulo') {
                    partInfo = '<span style="color: #10a37f; font-weight: bold;">Editando o t√≠tulo da mat√©ria</span>';
                } else if (targetPart === 'subt√≠tulo') {
                    partInfo = '<span style="color: #10a37f; font-weight: bold;">Editando o subt√≠tulo da mat√©ria</span>';
                } else if (targetPart === 'conte√∫do principal') {
                    partInfo = '<span style="color: #10a37f; font-weight: bold;">Editando o conte√∫do principal da mat√©ria</span>';
                } else if (targetPart === 'texto selecionado') {
                    partInfo = '<span style="color: #10a37f; font-weight: bold;">Editando o texto selecionado</span>';
                } else {
                    partInfo = '<span style="color: #10a37f; font-weight: bold;">Editando o conte√∫do completo</span>';
                }
                
                responseArea.innerHTML = `
                    <div style="margin-bottom: 10px; padding: 8px; background: rgba(16, 163, 127, 0.1); border-radius: 5px;">
                        ${partInfo}
                    </div>
                    <div style="white-space: pre-wrap; background: var(--surface-hover); padding: 10px; border-radius: 5px; border: 1px solid var(--border-color);">${data.response}</div>
                `;
                
                // Armazenar a resposta da IA e informa√ß√µes de sele√ß√£o para uso posterior
                responseArea.dataset.aiResponse = data.response;
                responseArea.dataset.selectionStart = selectionStart;
                responseArea.dataset.selectionEnd = selectionEnd;
                responseArea.dataset.hadSelection = (selectedText !== '');
                
                // Mostrar o bot√£o para aplicar as mudan√ßas
                applyButton.style.display = 'block';
                
            } catch (error) {
                responseArea.innerHTML = `<p style="color: #ff4d4f;">Erro de conex√£o: ${error.message}</p>`;
            }
        }
        
        // Fun√ß√£o para aplicar as mudan√ßas sugeridas pela IA
        function applyAIChanges() {
            const responseArea = document.getElementById('ai-response');
            const textarea = document.getElementById('current-editor');
            
            if (!responseArea || !textarea) return;
            
            const aiResponse = responseArea.dataset.aiResponse;
            const selectionStart = parseInt(responseArea.dataset.selectionStart || 0);
            const selectionEnd = parseInt(responseArea.dataset.selectionEnd || 0);
            const hadSelection = responseArea.dataset.hadSelection === 'true';
            const targetPart = responseArea.dataset.targetPart || 'conte√∫do completo';
            const isArticle = responseArea.dataset.isArticle === 'true';
            
            if (!aiResponse) return;
            
            const fullText = textarea.value;
            
            // Aplicar as mudan√ßas com base na parte alvo
            if (hadSelection) {
                // Substituir apenas o texto selecionado
                textarea.value = fullText.substring(0, selectionStart) + aiResponse + fullText.substring(selectionEnd);
            } else if (isArticle && targetPart !== 'conte√∫do completo') {
                // Estamos editando uma parte espec√≠fica de uma mat√©ria estruturada
                
                // Extrair as partes existentes
                const titleMatch = fullText.match(/^#\s+(.*?)(\n|$)/m);
                const subtitleMatch = fullText.match(/^##\s+(.*?)(\n|$)/m);
                
                let title = titleMatch && titleMatch[1] ? titleMatch[1].trim() : '';
                let subtitle = subtitleMatch && subtitleMatch[1] ? subtitleMatch[1].trim() : '';
                
                // Extrair conte√∫do principal (removendo t√≠tulo e subt√≠tulo)
                let mainContent = fullText
                    .replace(/^#\s+.*?(\n|$)/m, '')
                    .replace(/^##\s+.*?(\n|$)/m, '')
                    .trim();
                
                // Aplicar as altera√ß√µes √† parte espec√≠fica
                if (targetPart === 't√≠tulo') {
                    title = aiResponse;
                } else if (targetPart === 'subt√≠tulo') {
                    subtitle = aiResponse;
                } else if (targetPart === 'conte√∫do principal') {
                    mainContent = aiResponse;
                }
                
                // Reconstruir o texto completo
                let newText = '';
                if (title) {
                    newText += `# ${title}\n\n`;
                }
                if (subtitle) {
                    newText += `## ${subtitle}\n\n`;
                }
                newText += mainContent;
                
                textarea.value = newText;
            } else {
                // Substituir todo o texto
                textarea.value = aiResponse;
            }
            
            // Focar no textarea
            textarea.focus();
            
            // Notificar o usu√°rio
            alert('Mudan√ßas aplicadas com sucesso!');
        }

        // Fun√ß√£o para preservar a estrutura HTML no modo visual
        function preserveHtmlStructure(html) {
            // Criar um elemento tempor√°rio para analisar o HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            
            // Remover os bot√µes de edi√ß√£o
            const editControls = tempDiv.querySelector('.edit-controls');
            if (editControls) {
                editControls.remove();
            }
            
            // Remover indicador de salvo
            const savedIndicator = tempDiv.querySelector('.saved-indicator');
            if (savedIndicator) {
                savedIndicator.remove();
            }
            
            // Tentar encontrar o conte√∫do da mat√©ria reescrita
            const articleContent = tempDiv.querySelector('.article-content');
            
            if (articleContent) {
                // Estamos lidando com uma mat√©ria reescrita
                // Vamos extrair os componentes principais
                
                // Extrair t√≠tulo
                const title = tempDiv.querySelector('h2')?.innerText || '';
                
                // Extrair subt√≠tulo
                const subtitle = tempDiv.querySelector('.article-metadata p[style*="font-style: italic"]')?.innerText || '';
                
                // Extrair o conte√∫do principal
                const mainContent = articleContent.innerHTML || '';
                
                // Montar o conte√∫do formatado com marcadores claros
                let formattedContent = '';
                
                if (title) {
                    formattedContent += `# ${title}\n\n`;
                }
                
                if (subtitle) {
                    formattedContent += `## ${subtitle}\n\n`;
                }
                
                // Processar o conte√∫do principal
                let processedContent = mainContent
                    // Preservar os t√≠tulos H3 antes de remover as tags
                    .replace(/<h3[^>]*>(.*?)<\/h3>/gi, '\n\n### $1\n\n')
                    // Preservar par√°grafos
                    .replace(/<p[^>]*>(.*?)<\/p>/gi, '$1\n\n')
                    // Preservar negrito
                    .replace(/<strong[^>]*>(.*?)<\/strong>/gi, '**$1**')
                    .replace(/<b[^>]*>(.*?)<\/b>/gi, '**$1**')
                    // Preservar it√°lico
                    .replace(/<em[^>]*>(.*?)<\/em>/gi, '*$1*')
                    .replace(/<i[^>]*>(.*?)<\/i>/gi, '*$1*')
                    // Preservar links
                    .replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, '[$2]($1)')
                    // Remover outras tags HTML
                    .replace(/<[^>]*>/g, '')
                    // Limpar espa√ßos extras e linhas em branco
                    .replace(/\n\s*\n\s*\n/g, '\n\n')
                    .trim();
                
                formattedContent += processedContent;
                
                return formattedContent;
            }
            
            // Fallback: retornar o conte√∫do HTML limpo
            return tempDiv.innerText || tempDiv.textContent;
        }
        
        // Fun√ß√£o para atualizar o conte√∫do na estrutura HTML original
        function updateContentInOriginalStructure(originalHtml, newContent) {
            // Criar um elemento tempor√°rio para analisar o HTML original
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = originalHtml;
            
            // Verificar se estamos lidando com uma mat√©ria reescrita
            const articleContent = tempDiv.querySelector('.article-content');
            const articleMetadata = tempDiv.querySelector('.article-metadata');
            
            if (articleContent && articleMetadata) {
                // Estamos lidando com uma mat√©ria reescrita
                
                // Extrair t√≠tulo e subt√≠tulo do conte√∫do editado
                const titleMatch = newContent.match(/^#\s+(.*?)(\n|$)/m);
                const subtitleMatch = newContent.match(/^##\s+(.*?)(\n|$)/m);
                
                // Atualizar o t√≠tulo se encontrado
                if (titleMatch && titleMatch[1]) {
                    const titleElement = articleMetadata.querySelector('h2');
                    if (titleElement) {
                        titleElement.textContent = titleMatch[1].trim();
                    }
                }
                
                // Atualizar o subt√≠tulo se encontrado
                if (subtitleMatch && subtitleMatch[1]) {
                    const subtitleElement = articleMetadata.querySelector('p[style*="font-style: italic"]');
                    if (subtitleElement) {
                        subtitleElement.textContent = subtitleMatch[1].trim();
                    }
                }
                
                // Remover os marcadores de t√≠tulo e subt√≠tulo do conte√∫do
                let mainContent = newContent
                    .replace(/^#\s+.*?(\n|$)/m, '')
                    .replace(/^##\s+.*?(\n|$)/m, '')
                    .trim();
                
                // Converter o conte√∫do editado de volta para HTML
                let htmlContent = mainContent
                    // Converter t√≠tulos H3
                    .replace(/###\s*(.*?)(\n|$)/g, '<h3>$1</h3>')
                    // Converter par√°grafos (blocos de texto separados por linhas em branco)
                    .replace(/([^\n]+)(\n\n|$)/g, '<p>$1</p>')
                    // Converter links
                    .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>')
                    // Converter negrito
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    // Converter it√°lico
                    .replace(/\*(.*?)\*/g, '<em>$1</em>');
                
                // Atualizar o conte√∫do principal
                articleContent.innerHTML = htmlContent;
                
                return tempDiv.innerHTML;
            }
            
            // Fallback: converter o conte√∫do editado para HTML b√°sico
            let htmlContent = newContent
                // Converter t√≠tulos H3
                .replace(/###\s*(.*?)(\n|$)/g, '<h3>$1</h3>')
                // Converter par√°grafos (blocos de texto separados por linhas em branco)
                .replace(/([^\n]+)(\n\n|$)/g, '<p>$1</p>')
                // Converter links
                .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>')
                // Converter negrito
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // Converter it√°lico
                .replace(/\*(.*?)\*/g, '<em>$1</em>');
                
            return htmlContent;
        }
        
        // Fun√ß√£o para alternar entre os modos de edi√ß√£o
        function toggleEditMode() {
            const textarea = document.getElementById('current-editor');
            const toggleButton = document.getElementById('toggle-edit-mode');
            const editorTip = document.querySelector('.editor-tip');
            
            if (!textarea || !toggleButton) return;
            
            const currentMode = textarea.dataset.editMode;
            
            if (currentMode === 'visual') {
                // Mudar para o modo c√≥digo
                textarea.dataset.editMode = 'code';
                textarea.dataset.visualContent = textarea.value; // Salvar o conte√∫do visual atual
                textarea.value = textarea.dataset.codeContent; // Carregar o conte√∫do HTML
                toggleButton.innerHTML = '<span>üîÑ</span> Modo C√≥digo';
                
                // Atualizar dica de edi√ß√£o
                editorTip.innerHTML = `
                    <strong>Modo C√≥digo:</strong> Voc√™ est√° editando o HTML diretamente. Tenha cuidado para n√£o quebrar a estrutura HTML.
                `;
                
                // Adicionar aviso sobre edi√ß√£o de HTML
                if (!textarea.dataset.htmlWarningShown) {
                    alert('Aten√ß√£o: Voc√™ est√° editando o HTML diretamente. Tenha cuidado para n√£o remover ou alterar as tags HTML importantes.');
                    textarea.dataset.htmlWarningShown = 'true';
                }
            } else {
                // Mudar para o modo visual
                textarea.dataset.editMode = 'visual';
                textarea.dataset.codeContent = textarea.value; // Salvar o conte√∫do HTML atual
                textarea.value = textarea.dataset.visualContent; // Carregar o conte√∫do visual
                toggleButton.innerHTML = '<span>üîÑ</span> Modo Visual';
                
                // Restaurar dica de edi√ß√£o
                editorTip.innerHTML = '';
            }
            
            textarea.focus();
        }
        
        // Fun√ß√£o para formatar texto
        function formatText(command) {
            const textarea = document.getElementById('current-editor');
            if (!textarea) return;
            
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            let formattedText = '';
            let prefix = '';
            let suffix = '';
            
            switch(command) {
                case 'bold':
                    prefix = '**';
                    suffix = '**';
                    break;
                case 'italic':
                    prefix = '*';
                    suffix = '*';
                    break;
                case 'underline':
                    prefix = '<u>';
                    suffix = '</u>';
                    break;
                case 'h2':
                    prefix = '## ';
                    suffix = '\n\n';
                    break;
                case 'h3':
                    prefix = '### ';
                    suffix = '\n\n';
                    break;
                case 'p':
                    suffix = '\n\n';
                    break;
                case 'unlink':
                    // Remove links da sele√ß√£o
                    formattedText = selectedText.replace(/\[(.*?)\]\(.*?\)/g, '$1');
                    break;
                default:
                    formattedText = selectedText;
            }
            
            if (selectedText && command !== 'unlink') {
                formattedText = prefix + selectedText + suffix;
                
                // Substituir o texto selecionado pelo texto formatado
                textarea.value = 
                    textarea.value.substring(0, start) + 
                    formattedText + 
                    textarea.value.substring(end);
                
                // Reposicionar o cursor ap√≥s o texto formatado
                textarea.selectionStart = start + formattedText.length;
                textarea.selectionEnd = start + formattedText.length;
            } else if (command === 'unlink' && selectedText) {
                // Aplicar a remo√ß√£o de links
                textarea.value = 
                    textarea.value.substring(0, start) + 
                    formattedText + 
                    textarea.value.substring(end);
            }
            
            textarea.focus();
        }
        
        // Fun√ß√£o para mostrar o di√°logo de inser√ß√£o de link
        function showLinkDialog() {
            const textarea = document.getElementById('current-editor');
            if (!textarea) return;
            
            // Verificar se j√° existe um di√°logo aberto
            let existingDialog = document.querySelector('.link-dialog');
            if (existingDialog) {
                existingDialog.remove();
            }
            
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (!selectedText) {
                alert('Por favor, selecione o texto que deseja transformar em link.');
                return;
            }
            
            // Criar o di√°logo
            const dialog = document.createElement('div');
            dialog.className = 'link-dialog';
            dialog.style.position = 'fixed';
            dialog.style.top = '50%';
            dialog.style.left = '50%';
            dialog.style.transform = 'translate(-50%, -50%)';
            dialog.style.zIndex = '10000';
            dialog.style.width = '400px';
            
            dialog.innerHTML = `
                <div>
                    <label for="link-url">URL:</label>
                    <input type="url" id="link-url" placeholder="https://exemplo.com">
                </div>
                <div>
                    <label for="link-text">Texto do link:</label>
                    <input type="text" id="link-text" value="${selectedText}">
                </div>
                <div class="link-dialog-buttons">
                    <button class="cancel-link-btn" onclick="closeLinkDialog()">Cancelar</button>
                    <button class="add-link-btn" onclick="insertLink()">Inserir Link</button>
                </div>
            `;
            
            document.body.appendChild(dialog);
            
            // Focar no campo de URL
            setTimeout(() => {
                document.getElementById('link-url').focus();
            }, 100);
        }
        
        // Fun√ß√£o para fechar o di√°logo de link
        function closeLinkDialog() {
            const dialog = document.querySelector('.link-dialog');
            if (dialog) {
                dialog.remove();
            }
            
            // Focar de volta no textarea
            const textarea = document.getElementById('current-editor');
            if (textarea) {
                textarea.focus();
            }
        }
        
        // Fun√ß√£o para inserir o link
        function insertLink() {
            const textarea = document.getElementById('current-editor');
            const urlInput = document.getElementById('link-url');
            const textInput = document.getElementById('link-text');
            
            if (!textarea || !urlInput || !textInput) return;
            
            const url = urlInput.value.trim();
            const text = textInput.value.trim();
            
            if (!url) {
                alert('Por favor, insira uma URL v√°lida.');
                urlInput.focus();
                return;
            }
            
            if (!text) {
                alert('Por favor, insira o texto do link.');
                textInput.focus();
                return;
            }
            
            // Criar o link no formato markdown
            const linkMarkdown = `[${text}](${url})`;
            
            // Substituir a sele√ß√£o pelo link
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            
            textarea.value = 
                textarea.value.substring(0, start) + 
                linkMarkdown + 
                textarea.value.substring(end);
            
            // Fechar o di√°logo
            closeLinkDialog();
            
            // Reposicionar o cursor ap√≥s o link
            textarea.selectionStart = start + linkMarkdown.length;
            textarea.selectionEnd = start + linkMarkdown.length;
            textarea.focus();
        }
        
        // Limpar o conte√∫do HTML para edi√ß√£o
        function getCleanContent(html) {
            // Remover controles de edi√ß√£o
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            
            // Remover os bot√µes de edi√ß√£o
            const editControls = tempDiv.querySelector('.edit-controls');
            if (editControls) {
                editControls.remove();
            }
            
            // Remover indicador de salvo
            const savedIndicator = tempDiv.querySelector('.saved-indicator');
            if (savedIndicator) {
                savedIndicator.remove();
            }
            
            // Substituir qualquer \n literal por quebras de linha reais
            let cleanContent = tempDiv.innerHTML;
            if (typeof cleanContent === 'string') {
                cleanContent = cleanContent.replace(/\\n/g, '\n');
            }
            
            return cleanContent;
        }
        
        // Salvar as edi√ß√µes
        async function saveEdits(contentDiv, editedText, originalContent) {
            // Remover o editor da tela
            const editorContainer = document.querySelector('.editor-container');
            if (editorContainer) {
                document.body.removeChild(editorContainer);
            }
            
            // Mostrar indicador de carregamento
            contentDiv.innerHTML = '<div class="loading-indicator"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>';
            
            try {
                // Chamar a API para salvar o texto editado
                const response = await fetch('/api/save-edited-text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        originalText: originalContent,
                        editedText: editedText,
                        context: currentTab,
                        enhance: false // Desativar aprimoramento para preservar HTML
                    })
                });
                
                // Verificar se a resposta √© bem-sucedida
                if (!response.ok) {
                    throw new Error(`Erro do servidor: ${response.status} ${response.statusText}`);
                }
                
                // Verificar o tipo de conte√∫do da resposta
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error('Resposta inv√°lida do servidor: n√£o √© JSON');
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // Usar o texto editado diretamente para preservar a estrutura HTML
                const finalText = editedText;
                
                // Remover quaisquer controles de edi√ß√£o existentes
                const existingControls = contentDiv.querySelector('.edit-controls');
                if (existingControls) {
                    existingControls.remove();
                }
                
                // Restaurar o conte√∫do com o texto editado
                contentDiv.innerHTML = finalText;
                
                // Adicionar novamente os controles de edi√ß√£o
                const editControls = document.createElement('div');
                editControls.className = 'edit-controls';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'edit-btn';
                editBtn.innerHTML = '<span>‚úèÔ∏è</span> Editar';
                // Usar o addEventListener para garantir que o evento n√£o seja perdido
                editBtn.addEventListener('click', function() {
                    startEditing(contentDiv);
                });
                
                const exportBtn = document.createElement('button');
                exportBtn.className = 'edit-btn';
                exportBtn.innerHTML = '<span>üìÑ</span> Exportar';
                exportBtn.addEventListener('click', function() {
                    exportText(finalText);
                });
                
                editControls.appendChild(editBtn);
                editControls.appendChild(exportBtn);
                
                // Garantir que todos os eventos est√£o ativos antes de adicionar ao DOM
                setTimeout(() => {
                contentDiv.appendChild(editControls);
                    
                    // Verificar se os eventos foram anexados corretamente
                    console.log('Controles de edi√ß√£o adicionados. ID do conte√∫do:', contentDiv.id);
                    console.log('Bot√£o de edi√ß√£o criado com eventos:', editBtn);
                    
                    // Verificar se estamos em um artigo reescrito
                    // Procurar pelo result-section de v√°rias formas poss√≠veis
                    let resultSection = contentDiv.closest('.result-section');
                    
                    // Se n√£o encontrou diretamente, tente procurar pelo container pai
                    if (!resultSection) {
                        const container = contentDiv.closest('.article-content-container');
                        if (container) {
                            resultSection = container.closest('.result-section');
                        }
                    }
                    
                    // Se ainda n√£o encontrou, procure subindo mais n√≠veis na √°rvore DOM
                    if (!resultSection) {
                        let parent = contentDiv.parentElement;
                        for (let i = 0; i < 5 && parent; i++) { // Limite de 5 n√≠veis para evitar loop infinito
                            if (parent.classList.contains('result-section')) {
                                resultSection = parent;
                                break;
                            }
                            // Procurar tamb√©m por um elemento que contenha um result-section
                            const nestedResultSection = parent.querySelector('.result-section');
                            if (nestedResultSection) {
                                resultSection = nestedResultSection;
                                break;
                            }
                            parent = parent.parentElement;
                        }
                    }
                    
                    // Se encontrou o result-section, adicione o bot√£o
                    if (resultSection) {
                        // Readicionar o bot√£o de WordPress ap√≥s a edi√ß√£o
                        setTimeout(() => {
                            addWordPressPublishButton(resultSection);
                            console.log('Bot√£o de WordPress readicionado ap√≥s edi√ß√£o para:', resultSection);
                        }, 100);
                    } else {
                        console.warn('N√£o foi poss√≠vel encontrar o result-section para adicionar o bot√£o de WordPress');
                        
                        // √öltima tentativa - procurar qualquer result-section na p√°gina
                        const allResultSections = document.querySelectorAll('.result-section');
                        if (allResultSections.length > 0) {
                            // Pegar o √∫ltimo result-section (provavelmente o mais recente)
                            const lastResultSection = allResultSections[allResultSections.length - 1];
                            setTimeout(() => {
                                addWordPressPublishButton(lastResultSection);
                                console.log('Bot√£o de WordPress adicionado ao √∫ltimo result-section como fallback');
                            }, 100);
                        }
                    }
                }, 100);
                
                // Adicionar indicador de salvo
                const savedIndicator = document.createElement('div');
                savedIndicator.className = 'saved-indicator';
                savedIndicator.innerHTML = '<span>‚úì</span> Salvo com sucesso';
                contentDiv.appendChild(savedIndicator);
                
                // Mostrar o indicador brevemente
                setTimeout(() => {
                    savedIndicator.classList.add('show');
                    
                    setTimeout(() => {
                        savedIndicator.classList.remove('show');
                    }, 2000);
                }, 100);
                
            } catch (error) {
                console.error('Erro ao salvar edi√ß√£o:', error);
                
                // Mostrar mensagem de erro mais amig√°vel
                let errorMessage = 'Erro ao salvar. Por favor, tente novamente.';
                
                if (error.message.includes('JSON')) {
                    errorMessage = 'Erro de comunica√ß√£o com o servidor. O servidor pode estar sobrecarregado ou reiniciando.';
                } else if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
                    errorMessage = 'Erro de conex√£o. Verifique sua internet e tente novamente.';
                } else if (error.message) {
                    errorMessage = `Erro ao salvar: ${error.message}`;
                }
                
                alert(errorMessage);
                
                // Restaurar o conte√∫do original
                cancelEdits(contentDiv, originalContent);
            }
        }
        
        // Cancelar a edi√ß√£o
        function cancelEdits(contentDiv, originalContent) {
            // Remover o editor da tela
            const editorContainer = document.querySelector('.editor-container');
            if (editorContainer) {
                document.body.removeChild(editorContainer);
            }
            
            // Processar o conte√∫do original para substituir \n por <br>
            let processedContent = originalContent;
            if (typeof processedContent === 'string') {
                processedContent = processedContent.replace(/\\n/g, '<br>');
            }
            
            // Restaurar o conte√∫do original processado
            contentDiv.innerHTML = processedContent;
        }
        
        // Exportar texto como documento
        function exportText(text) {
            // Criar um elemento de link para download
            const element = document.createElement('a');
            
            // Criar o conte√∫do do arquivo
            const fileContent = text;
            
            // Criar um Blob com o conte√∫do
            const blob = new Blob([fileContent], {type: 'text/plain'});
            
            // Criar URL para o Blob
            const fileUrl = URL.createObjectURL(blob);
            
            // Configurar o elemento de link
            element.setAttribute('href', fileUrl);
            element.setAttribute('download', `texto_editado_${new Date().toISOString().slice(0,10)}.txt`);
            
            // Ocultar o elemento
            element.style.display = 'none';
            
            // Adicionar ao documento
            document.body.appendChild(element);
            
            // Simular clique para iniciar o download
            element.click();
            
            // Remover o elemento
            document.body.removeChild(element);
            
            // Liberar a URL
            URL.revokeObjectURL(fileUrl);
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se h√° par√¢metros na URL para iniciar com uma aba espec√≠fica
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            
            if (tab) {
                switchTab(tab);
            }
            
            // Inicializar o estado do chat
            document.getElementById('chat-input-container').style.display = 'none';
            document.getElementById('empty-state-message').style.display = 'block';
            
            // Garantir que o textarea de chat tenha altura m√≠nima adequada
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.style.minHeight = '56px';
                chatInput.style.height = '56px';
            }
            
            // Configurar o resizing autom√°tico dos textareas
            document.querySelectorAll('textarea').forEach(textarea => {
                // Garantir altura m√≠nima para todos os textareas
                if (!textarea.style.minHeight) {
                    textarea.style.minHeight = '56px';
                }
                
                if (textarea.id === 'url-extract-input') {
                    autoResizeUrl(textarea);
                } else if (textarea.id === 'text-extract-input') {
                    autoResizeText(textarea);
                } else {
                    autoResize(textarea);
                }
            });
            
            // Adicionar um manipulador de eventos para quando o chat-input-container for exibido
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.target.id === 'chat-input-container' && 
                        mutation.target.style.display !== 'none') {
                        const textarea = document.getElementById('chat-input');
                        if (textarea) {
                            // For√ßar altura m√≠nima quando o container for exibido
                            textarea.style.height = '56px';
                            autoResize(textarea);
                        }
                    }
                });
            });
            
            observer.observe(document.getElementById('chat-input-container'), {
                attributes: true,
                attributeFilter: ['style']
            });
        });
        
        // Fun√ß√µes para integra√ß√£o com WordPress
        // Armazenar configura√ß√µes do WordPress
        let wordpressConfig = {
            siteUrl: '',
            username: '',
            appPassword: '',
            defaultCategory: '1',
            defaultStatus: 'draft'
        };
        
        // Carregar configura√ß√µes salvas
        function loadWordPressConfig() {
            const savedConfig = localStorage.getItem('wordpressConfig');
            if (savedConfig) {
                try {
                    wordpressConfig = JSON.parse(savedConfig);
                    
                    // Preencher os campos do formul√°rio
                    document.getElementById('wp-site-url').value = wordpressConfig.siteUrl || '';
                    document.getElementById('wp-username').value = wordpressConfig.username || '';
                    document.getElementById('wp-app-password').value = wordpressConfig.appPassword || '';
                    document.getElementById('wp-default-category').value = wordpressConfig.defaultCategory || '1';
                    document.getElementById('wp-default-status').value = wordpressConfig.defaultStatus || 'draft';
                } catch (error) {
                    console.error('Erro ao carregar configura√ß√µes do WordPress:', error);
                }
            }
        }
        
        // Salvar configura√ß√µes
        function saveWordPressConfig() {
            // Obter valores dos campos
            const siteUrl = document.getElementById('wp-site-url').value.trim();
            const username = document.getElementById('wp-username').value.trim();
            const appPassword = document.getElementById('wp-app-password').value.trim();
            const defaultCategory = document.getElementById('wp-default-category').value.trim() || '1';
            const defaultStatus = document.getElementById('wp-default-status').value;
            
            // Validar campos obrigat√≥rios
            if (!siteUrl || !username || !appPassword) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }
            
            // Atualizar configura√ß√µes
            wordpressConfig = {
                siteUrl,
                username,
                appPassword,
                defaultCategory,
                defaultStatus
            };
            
            // Salvar no localStorage
            localStorage.setItem('wordpressConfig', JSON.stringify(wordpressConfig));
            
            // Mostrar mensagem de sucesso
            const statusDiv = document.getElementById('wordpress-connection-status');
            statusDiv.className = 'wordpress-status success';
            statusDiv.textContent = 'Configura√ß√µes salvas com sucesso!';
            
            // Esconder a mensagem ap√≥s 3 segundos
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }
        
        // Testar conex√£o com o WordPress
        async function testWordPressConnection() {
            // Obter valores dos campos
            const siteUrl = document.getElementById('wp-site-url').value.trim();
            const username = document.getElementById('wp-username').value.trim();
            const appPassword = document.getElementById('wp-app-password').value.trim();
            
            // Validar campos obrigat√≥rios
            if (!siteUrl || !username || !appPassword) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }
            
            // Mostrar indicador de carregamento
            const statusDiv = document.getElementById('wordpress-connection-status');
            statusDiv.className = 'wordpress-status loading';
            statusDiv.textContent = 'Testando conex√£o...';
            statusDiv.style.display = 'flex';
            
            try {
                // Montar a URL da API do WordPress
                let apiUrl = siteUrl;
                if (!apiUrl.endsWith('/')) apiUrl += '/';
                apiUrl += 'wp-json/wp/v2/posts';
                
                // Criar credenciais de autentica√ß√£o
                const authString = btoa(`${username}:${appPassword}`);
                
                // Fazer requisi√ß√£o de teste
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Basic ${authString}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                // Verificar resposta
                if (response.ok) {
                    statusDiv.className = 'wordpress-status success';
                    statusDiv.textContent = 'Conex√£o estabelecida com sucesso!';
                } else {
                    const errorData = await response.json();
                    throw new Error(`Erro ${response.status}: ${errorData.message || 'Falha na autentica√ß√£o'}`);
                }
            } catch (error) {
                statusDiv.className = 'wordpress-status error';
                statusDiv.textContent = `Erro ao conectar: ${error.message}`;
                console.error('Erro ao testar conex√£o com WordPress:', error);
            }
        }
        
        // Mostrar modal de configura√ß√£o do WordPress
        function showWordPressConfigModal() {
            const modal = document.getElementById('wordpress-config-modal');
            modal.classList.add('show');
            
            // Carregar configura√ß√µes salvas
            loadWordPressConfig();
        }
        
        // Fechar modal de configura√ß√£o
        function closeWordPressModal() {
            const modal = document.getElementById('wordpress-config-modal');
            modal.classList.remove('show');
        }
        
        // Mostrar modal de publica√ß√£o no WordPress
        function showWordPressPublishModal(title, subtitle, tags, keyword, content) {
            console.log("Abrindo modal de publica√ß√£o WordPress:", { title, subtitle, tags });
            
            // Verificar se as configura√ß√µes do WordPress foram definidas
            if (!wordpressConfig.siteUrl || !wordpressConfig.username || !wordpressConfig.appPassword) {
                alert('Por favor, configure suas credenciais do WordPress primeiro.');
                showWordPressConfigModal();
                return;
            }
            
            try {
            // Preencher os campos de pr√©-visualiza√ß√£o
            document.getElementById('wp-preview-title').textContent = title;
            document.getElementById('wp-preview-subtitle').textContent = subtitle;
            document.getElementById('wp-preview-tags').textContent = tags;
            document.getElementById('wp-preview-keyword').textContent = keyword;
            
            // Armazenar o conte√∫do para uso posterior
            document.getElementById('wordpress-publish-modal').dataset.content = content;
            
            // Preencher campos com valores padr√£o
            document.getElementById('wp-post-category').value = wordpressConfig.defaultCategory;
            document.getElementById('wp-post-status').value = wordpressConfig.defaultStatus;
            
                // Limpar qualquer status anterior
                const statusDiv = document.getElementById('wordpress-publish-status');
                statusDiv.className = 'wordpress-status';
                statusDiv.textContent = '';
                statusDiv.style.display = 'none';
                
                            // Mostrar o modal com uma pequena anima√ß√£o para garantir que seja renderizado corretamente
            const modal = document.getElementById('wordpress-publish-modal');
            
            // Primeiro garantir que o modal esteja vis√≠vel no DOM
            modal.style.display = 'block';
            modal.style.opacity = '0';
            
            // For√ßar um reflow para garantir que as mudan√ßas de estilo sejam aplicadas
            void modal.offsetWidth;
            
            // Agora adicionar a classe show com um pequeno atraso
            setTimeout(() => {
            modal.classList.add('show');
                modal.style.opacity = '1';
                console.log("Modal de publica√ß√£o WordPress aberto com sucesso");
            }, 50);
            } catch (error) {
                console.error("Erro ao abrir modal de publica√ß√£o WordPress:", error);
                alert("Erro ao abrir janela de publica√ß√£o. Por favor, tente novamente.");
            }
        }
        
        // Fechar modal de publica√ß√£o
        function closeWordPressPublishModal() {
            const modal = document.getElementById('wordpress-publish-modal');
            modal.classList.remove('show');
            
            // Limpar status
            const statusDiv = document.getElementById('wordpress-publish-status');
            statusDiv.className = 'wordpress-status';
            statusDiv.style.display = 'none';
        }
        
        // Publicar no WordPress
        async function publishToWordPress() {
            // Obter valores dos campos
            const title = document.getElementById('wp-preview-title').textContent;
            const subtitle = document.getElementById('wp-preview-subtitle').textContent;
            const tags = document.getElementById('wp-preview-tags').textContent;
            
            // Verificar se h√° conte√∫do no dataset do corpo ou no dataset do modal
            let content;
            if (document.body.hasAttribute('data-publish-content')) {
                // Usar o conte√∫do armazenado no dataset do body (para artigos salvos)
                content = document.body.getAttribute('data-publish-content');
                // Limpar o atributo ap√≥s uso
                document.body.removeAttribute('data-publish-content');
            } else {
                // Usar o conte√∫do do modal (m√©todo tradicional)
                content = document.getElementById('wordpress-publish-modal').dataset.content;
            }
            
            const category = document.getElementById('wp-post-category').value.trim() || wordpressConfig.defaultCategory;
            const status = document.getElementById('wp-post-status').value;
            
            // Mostrar indicador de carregamento
            const statusDiv = document.getElementById('wordpress-publish-status');
            statusDiv.className = 'wordpress-status loading';
            statusDiv.textContent = 'Publicando no WordPress...';
            statusDiv.style.display = 'flex';
            
            try {
                // Montar a URL da API do WordPress
                let apiUrl = wordpressConfig.siteUrl;
                if (!apiUrl.endsWith('/')) apiUrl += '/';
                apiUrl += 'wp-json/wp/v2/posts';
                
                // Criar credenciais de autentica√ß√£o
                const authString = btoa(`${wordpressConfig.username}:${wordpressConfig.appPassword}`);
                
                // Preparar o conte√∫do para publica√ß√£o
                // Remover o subt√≠tulo do conte√∫do se estiver presente
                let cleanContent = content;
                if (subtitle) {
                    // Tenta remover o subt√≠tulo do conte√∫do se ele estiver l√°
                    cleanContent = content.replace(subtitle, '');
                    cleanContent = cleanContent.replace('<p><em>Colocar o subt√≠tulo aqui</em></p>', '');
                    cleanContent = cleanContent.replace('<p>Colocar o subt√≠tulo aqui</p>', '');
                }
                
                const postData = {
                    title: title,
                    content: cleanContent,
                    status: status,
                    categories: [parseInt(category, 10)],
                    meta: {
                        _yoast_wpseo_focuskw: tags.split(',')[0].trim(), // Usar a primeira tag como palavra-chave
                        tie_post_sub_title: subtitle // Campo personalizado para o subt√≠tulo no tema
                    }
                };
                
                // Adicionar tags se dispon√≠veis
                if (tags) {
                    // Precisamos primeiro verificar se as tags existem e criar as que n√£o existem
                    const tagNames = tags.split(',').map(tag => tag.trim());
                    const tagIds = await createOrGetTags(tagNames, authString);
                    postData.tags = tagIds;
                    
                    // Adicionar tags como string para o campo personalizado
                    postData.meta.post_tag = tags;
                }
                
                // Fazer requisi√ß√£o para criar o post
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Basic ${authString}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(postData)
                });
                
                // Verificar resposta
                if (response.ok) {
                    const postData = await response.json();
                    
                    // Tentar atualizar campos personalizados diretamente via REST API
                    try {
                        await updateCustomFields(postData.id, subtitle, tags, authString);
                    } catch (customFieldError) {
                        console.error('Erro ao atualizar campos personalizados:', customFieldError);
                        // Continuar mesmo se falhar, pois o post j√° foi criado
                    }
                    
                    statusDiv.className = 'wordpress-status success';
                    statusDiv.innerHTML = `
                        Post criado com sucesso!<br>
                        <a href="${postData.link}" target="_blank" style="color: inherit; text-decoration: underline;">Ver post</a>
                        <br><small>Edite o post para verificar se o subt√≠tulo e tags foram aplicados corretamente</small>
                    `;
                } else {
                    const errorData = await response.json();
                    throw new Error(`Erro ${response.status}: ${errorData.message || 'Falha ao publicar'}`);
                }
            } catch (error) {
                statusDiv.className = 'wordpress-status error';
                statusDiv.textContent = `Erro ao publicar: ${error.message}`;
                console.error('Erro ao publicar no WordPress:', error);
            }
        }
        
        // Fun√ß√£o para atualizar campos personalizados via REST API
        async function updateCustomFields(postId, subtitle, tags, authString) {
            // Montar a URL da API do WordPress
            let apiUrl = wordpressConfig.siteUrl;
            if (!apiUrl.endsWith('/')) apiUrl += '/';
            
            // Tentar atualizar o subt√≠tulo via API REST
            if (subtitle) {
                try {
                    await fetch(`${apiUrl}wp-json/wp/v2/posts/${postId}`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Basic ${authString}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            meta: {
                                tie_post_sub_title: subtitle
                            }
                        })
                    });
                } catch (error) {
                    console.error('Erro ao atualizar subt√≠tulo:', error);
                }
            }
            
            // Tentar atualizar as tags via API REST
            if (tags) {
                try {
                    const tagNames = tags.split(',').map(tag => tag.trim());
                    const tagIds = await createOrGetTags(tagNames, authString);
                    
                    await fetch(`${apiUrl}wp-json/wp/v2/posts/${postId}`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Basic ${authString}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            tags: tagIds
                        })
                    });
                } catch (error) {
                    console.error('Erro ao atualizar tags:', error);
                }
            }
        }
        
        // Fun√ß√£o para criar ou obter IDs de tags
        async function createOrGetTags(tagNames, authString) {
            const tagIds = [];
            
            // Montar a URL da API para tags
            let apiUrl = wordpressConfig.siteUrl;
            if (!apiUrl.endsWith('/')) apiUrl += '/';
            apiUrl += 'wp-json/wp/v2/tags';
            
            // Para cada tag
            for (const tagName of tagNames) {
                try {
                    // Primeiro verificar se a tag j√° existe
                    const searchResponse = await fetch(`${apiUrl}?search=${encodeURIComponent(tagName)}`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Basic ${authString}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const existingTags = await searchResponse.json();
                    let tagId = null;
                    
                    // Verificar se encontrou a tag exata
                    for (const tag of existingTags) {
                        if (tag.name.toLowerCase() === tagName.toLowerCase()) {
                            tagId = tag.id;
                            break;
                        }
                    }
                    
                    // Se n√£o encontrou, criar a tag
                    if (!tagId) {
                        const createResponse = await fetch(apiUrl, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Basic ${authString}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                name: tagName
                            })
                        });
                        
                        if (createResponse.ok) {
                            const newTag = await createResponse.json();
                            tagId = newTag.id;
                        }
                    }
                    
                    // Adicionar o ID da tag √† lista
                    if (tagId) {
                        tagIds.push(tagId);
                    }
                } catch (error) {
                    console.error(`Erro ao processar tag "${tagName}":`, error);
                }
            }
            
            return tagIds;
        }
        
        // Adicionar bot√£o de publica√ß√£o no WordPress na √°rea de resultado da mat√©ria reescrita
        function addWordPressPublishButton(resultSection) {
            console.log("Adicionando bot√£o de WordPress para:", resultSection);
            
            if (!resultSection || !resultSection.isConnected) {
                console.error("resultSection inv√°lido ou n√£o est√° no DOM");
                return;
            }
            
            // Verificar se j√° existe um bot√£o de publica√ß√£o e remover para garantir que seja readicionado corretamente
            const existingButton = resultSection.querySelector('.wordpress-publish-btn');
            if (existingButton) {
                existingButton.remove();
            }
            
            // Criar bot√£o de publica√ß√£o
            const publishButton = document.createElement('button');
            publishButton.className = 'wordpress-publish-btn';
            publishButton.style.marginLeft = '10px';
            publishButton.textContent = 'Publicar no WordPress';
            publishButton.setAttribute('data-action', 'wordpress-publish');
            
            // Usar um ID √∫nico para o bot√£o para facilitar a depura√ß√£o
            const buttonId = 'wp-publish-' + Math.random().toString(36).substring(2, 9);
            publishButton.id = buttonId;
            
            // Adicionar evento de clique diretamente com addEventListener
            publishButton.addEventListener('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
                
                console.log("Bot√£o WordPress clicado:", buttonId);
                
                // Obter os dados da mat√©ria
                const title = resultSection.querySelector('h2')?.textContent || '';
                const subtitle = resultSection.querySelector('.article-metadata p[style*="font-style: italic"]')?.textContent || '';
                
                // Buscar tags de forma mais robusta
                let tags = '';
                const tagsContainer = resultSection.querySelector('.tags-container');
                if (tagsContainer) {
                    tags = Array.from(tagsContainer.querySelectorAll('.tag'))
                    .map(tag => tag.textContent)
                    .join(', ');
                }
                
                const keyword = resultSection.querySelector('.keyword')?.textContent || '';
                
                // Buscar o conte√∫do de forma mais robusta
                let content = '';
                const articleContent = resultSection.querySelector('.article-content');
                if (articleContent) {
                    content = articleContent.innerHTML || '';
                }
                
                console.log("Iniciando publica√ß√£o no WordPress:", { title, subtitle, tags, keyword });
                
                // Mostrar modal de publica√ß√£o
                showWordPressPublishModal(title, subtitle, tags, keyword, content);
                
                return false;
            });
            
            // Encontrar a √°rea de bot√µes existente e adicionar o novo bot√£o
            const buttonArea = resultSection.querySelector('div[style*="display: flex; gap: 10px;"]');
            if (buttonArea) {
                buttonArea.appendChild(publishButton);
                console.log("Bot√£o WordPress adicionado com sucesso ao buttonArea");
            } else {
                // Se n√£o encontrou a √°rea de bot√µes, tente criar uma nova
                console.warn("√Årea de bot√µes n√£o encontrada, criando nova √°rea");
                const newButtonArea = document.createElement('div');
                newButtonArea.style.display = 'flex';
                newButtonArea.style.gap = '10px';
                newButtonArea.style.marginTop = '15px';
                newButtonArea.appendChild(publishButton);
                
                // Adicionar a nova √°rea de bot√µes ao final do result-section
                resultSection.appendChild(newButtonArea);
            }
        }
        
        // Modificar a fun√ß√£o formatRewrittenContent para adicionar o bot√£o de publica√ß√£o no WordPress e salvar
        const originalFormatRewrittenContent = formatRewrittenContent;
        formatRewrittenContent = function(content) {
            // Remover qualquer texto "Colocar o subt√≠tulo aqui" do conte√∫do antes de formatar
            let cleanContent = content.replace(/<p><em>Colocar o subt√≠tulo aqui<\/em><\/p>/g, '');
            cleanContent = cleanContent.replace(/<p>Colocar o subt√≠tulo aqui<\/p>/g, '');
            
            // Obter o conte√∫do formatado original
            let formattedContent = originalFormatRewrittenContent(cleanContent);
            
            // Adicionar o bot√£o de salvar mat√©ria
            formattedContent = formattedContent.replace(
                `<div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button onclick="copyFormattedArticle(this.parentNode.parentNode)" style="background: #10a37f; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; font-weight: 500;">
                                <span>üìã</span> Copiar Tudo
                            </button>
                            <button onclick="downloadArticle(this.parentNode.parentNode)" style="background: transparent; border: 1px solid #ececf1; color: #ececf1; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; font-weight: 500;">
                                <span>üì•</span> Baixar
                            </button>`,
                `<div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button onclick="copyFormattedArticle(this.parentNode.parentNode)" style="background: #10a37f; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; font-weight: 500;">
                                <span>üìã</span> Copiar Tudo
                            </button>
                            <button onclick="downloadArticle(this.parentNode.parentNode)" style="background: transparent; border: 1px solid #ececf1; color: #ececf1; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; font-weight: 500;">
                                <span>üì•</span> Baixar
                            </button>
                            <button onclick="saveArticleForLater()" style="background: linear-gradient(135deg, #8e44ad, #9b59b6); color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; font-weight: 500;">
                                <span>üíæ</span> Salvar Mat√©ria
                            </button>`
            );
            
            // Usar setTimeout para garantir que o DOM esteja atualizado
            setTimeout(() => {
                const resultSection = document.querySelector('.rewritten-content .result-section');
                if (resultSection) {
                    addWordPressPublishButton(resultSection);
                }
            }, 100);
            
            return formattedContent;
        };
        
        // Fun√ß√£o global para publicar no WordPress (pode ser chamada pelo console)
        window.publishToWordPressManually = function() {
            console.log("Tentando publicar no WordPress manualmente");
            
            // Verificar primeiro se h√° artigos salvos
            const savedArticles = getSavedArticles();
            if (savedArticles.length > 0) {
                // Mostrar di√°logo para escolher entre artigo salvo ou atual
                if (confirm("Voc√™ tem artigos salvos. Deseja publicar um artigo salvo? Clique em OK para ver os artigos salvos ou Cancelar para publicar o artigo atual.")) {
                    // Mostrar lista de artigos salvos
                    let articleList = "Escolha o n√∫mero do artigo para publicar:\n\n";
                    savedArticles.forEach((article, index) => {
                        articleList += `${index + 1}. ${article.title}\n`;
                    });
                    
                    const choice = prompt(articleList);
                    if (choice !== null) {
                        const index = parseInt(choice) - 1;
                        if (!isNaN(index) && index >= 0 && index < savedArticles.length) {
                            // Publicar o artigo escolhido
                            publishSavedArticle(savedArticles[index].id);
                            return true;
                        } else {
                            alert("Escolha inv√°lida.");
                        }
                    }
                }
            }
            
            // Se n√£o escolheu um artigo salvo, continuar com a publica√ß√£o normal
            // Encontrar a √∫ltima mat√©ria reescrita
            const resultSections = document.querySelectorAll('.rewritten-content .result-section');
            if (resultSections.length > 0) {
                const lastSection = resultSections[resultSections.length - 1];
                
                // Obter os dados da mat√©ria
                const title = lastSection.querySelector('h2')?.textContent || '';
                const subtitle = lastSection.querySelector('.article-metadata p[style*="font-style: italic"]')?.textContent || '';
                let tags = '';
                const tagsContainer = lastSection.querySelector('.tags-container');
                if (tagsContainer) {
                    tags = Array.from(tagsContainer.querySelectorAll('.tag')).map(tag => tag.textContent).join(', ');
                }
                const keyword = lastSection.querySelector('.keyword')?.textContent || '';
                let content = '';
                const articleContent = lastSection.querySelector('.article-content');
                if (articleContent) {
                    content = articleContent.innerHTML || '';
                }
                
                // Mostrar modal de publica√ß√£o
                showWordPressPublishModal(title, subtitle, tags, keyword, content);
                return true;
            } else {
                console.error("Nenhuma mat√©ria reescrita encontrada");
                alert("Nenhuma mat√©ria reescrita encontrada para publicar");
                return false;
            }
        };
        
        // Carregar configura√ß√µes do WordPress quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            // C√≥digo existente...
            
            // Carregar configura√ß√µes do WordPress
            loadWordPressConfig();
            
            // Adicionar bot√µes de publica√ß√£o para mat√©rias existentes
            setTimeout(() => {
                document.querySelectorAll('.rewritten-content .result-section').forEach(section => {
                    addWordPressPublishButton(section);
                });
            }, 500);
            
            // Adicionar evento de teclado para publicar no WordPress (Ctrl+Shift+P)
            document.addEventListener('keydown', function(event) {
                if (event.ctrlKey && event.shiftKey && event.key === 'P') {
                    event.preventDefault();
                    window.publishToWordPressManually();
                }
            });
        });

        // Fun√ß√µes para gerenciar artigos salvos no banco de dados
        
        // Salvar artigo para publica√ß√£o posterior
        function saveArticleForLater() {
            try {
                // Procurar primeiro por mat√©ria reescrita (chat geral)
                let articleElement = document.querySelector('.rewritten-content .result-section');
                let isRewrittenContent = true;
                
                // Se n√£o encontrar, procurar por mat√©ria formatada (criar mat√©ria)
                if (!articleElement) {
                    articleElement = document.querySelector('.article-formatted');
                    isRewrittenContent = false;
                }
                
                if (!articleElement) {
                    alert('Nenhuma mat√©ria encontrada para salvar.');
                    return;
                }
                
                let title, subtitle, content, tags, keyword;
                
                if (isRewrittenContent) {
                    // Extrair dados de mat√©ria reescrita
                    title = articleElement.querySelector('h2')?.textContent || '';
                    subtitle = articleElement.querySelector('.article-metadata p[style*="font-style: italic"]')?.textContent || '';
                    content = articleElement.querySelector('.article-content')?.innerHTML || '';
                    
                    const tagsContainer = articleElement.querySelector('.tags-container');
                    tags = tagsContainer ? Array.from(tagsContainer.querySelectorAll('.tag')).map(tag => tag.textContent).join(', ') : '';
                    keyword = articleElement.querySelector('.keyword')?.textContent || '';
                } else {
                    // Extrair dados de mat√©ria formatada (c√≥digo existente)
                    title = articleElement.querySelector('.section-content h2').textContent;
                    subtitle = articleElement.querySelector('.section-content em').textContent;
                    content = articleElement.querySelector('.article-content').innerHTML;
                    const tagsElements = articleElement.querySelectorAll('.tags-container .tag');
                    tags = Array.from(tagsElements).map(tag => tag.textContent).join(', ');
                    keyword = articleElement.querySelector('.keyword').textContent;
                }
                
                // Criar objeto do artigo
                const article = {
                    title,
                    subtitle,
                    content,
                    tags,
                    keyword,
                    html: articleElement.outerHTML
                };
                
                // Salvar no banco de dados
                fetch('/api/articles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(article)
                })
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 401) {
                            // Erro de autentica√ß√£o
                            alert('Sua sess√£o expirou. Por favor, fa√ßa login novamente.');
                            window.location.href = '/login.html'; // Redirecionar para a p√°gina de login
                            throw new Error('Sess√£o expirada');
                        }
                        return response.json().then(data => {
                            throw new Error(data.message || 'Erro ao salvar artigo');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    // Notificar o usu√°rio
                    showSaveNotification('Mat√©ria salva com sucesso!');
                    
                    // Atualizar a lista de artigos salvos
                    loadSavedArticles();
                })
                .catch(error => {
                    console.error('Erro ao salvar artigo:', error);
                    alert('Erro ao salvar a mat√©ria. Por favor, tente novamente.');
                });
                
            } catch (error) {
                console.error('Erro ao salvar mat√©ria:', error);
                alert('Erro ao salvar a mat√©ria. Por favor, tente novamente.');
            }
        }
        
        // Obter artigos salvos do banco de dados
        function getSavedArticles(callback) {
            fetch('/api/articles')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro ao buscar artigos');
                    }
                    return response.json();
                })
                .then(articles => {
                    callback(articles);
                })
                .catch(error => {
                    console.error('Erro ao buscar artigos:', error);
                    callback([]);
                });
        }
        
        // Atualizar a lista de artigos salvos na sidebar
        function updateSavedArticlesList(articles) {
            const container = document.getElementById('saved-articles-container');
            if (!container) return;
            
            if (!articles || articles.length === 0) {
                container.innerHTML = '<div class="empty-saved-articles">Nenhuma mat√©ria salva</div>';
                return;
            }
            
            // Limpar o container
            container.innerHTML = '';
            
            // Adicionar cada artigo salvo
            articles.forEach(article => {
                const articleElement = document.createElement('div');
                articleElement.className = 'nav-item saved-article';
                articleElement.setAttribute('data-article-id', article.id);
                articleElement.innerHTML = `
                    <div class="saved-article-title" title="${article.title}">${article.title}</div>
                    <div class="saved-article-actions">
                        <button class="saved-article-action" onclick="loadSavedArticle(${article.id})" title="Carregar mat√©ria">üìù</button>
                        <button class="saved-article-action" onclick="publishSavedArticle(${article.id})" title="Publicar no WordPress">üì§</button>
                        <button class="saved-article-action" onclick="deleteSavedArticle(${article.id})" title="Excluir mat√©ria">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(articleElement);
            });
        }
        
        // Carregar artigos salvos do banco de dados
        function loadSavedArticles() {
            getSavedArticles(articles => {
                updateSavedArticlesList(articles);
            });
        }
        
        // Carregar um artigo salvo
        function loadSavedArticle(articleId) {
            fetch(`/api/articles/${articleId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro ao buscar artigo');
                    }
                    return response.json();
                })
                .then(article => {
                    if (!article) {
                        alert('Artigo n√£o encontrado.');
                        return;
                    }
            
            // Alternar para o chat geral
            switchTab('chat');
            const messagesContainer = document.querySelector('#chat-messages');
            
            // Criar o HTML da mat√©ria com formato rewritten-content
            const rewrittenContentHtml = `
                <div class="rewritten-content">
                    <div class="result-section">
                        <h3 style="color: #10a37f; margin-bottom: 15px;">üìÑ Mat√©ria Carregada</h3>
                        
                        <div class="article-metadata" style="background: rgba(16, 163, 127, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid rgba(16, 163, 127, 0.2);">
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #10a37f; font-size: 14px;">T√≠tulo:</strong>
                                <h2 style="margin: 5px 0; color: white; font-size: 20px;">${article.title}</h2>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #10a37f; font-size: 14px;">Subt√≠tulo:</strong>
                                <p style="margin: 5px 0; color: #ececf1; font-style: italic;">${article.subtitle}</p>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #10a37f; font-size: 14px;">Tags:</strong>
                                <div class="tags-container" style="margin: 5px 0; display: flex; flex-wrap: wrap; gap: 5px;">
                                    ${article.tags.split(',').map(tag => `<span class="tag" style="background: #e9ecef; color: #495057; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-right: 5px; margin-bottom: 5px; display: inline-block;">${tag.trim()}</span>`).join('')}
                                </div>
                            </div>
                            
                            <div>
                                <strong style="color: #10a37f; font-size: 14px;">Palavra-chave de cauda longa:</strong>
                                <p class="keyword" style="margin: 5px 0; color: #ececf1; font-weight: 500;">${article.keyword}</p>
                            </div>
                        </div>
                        
                        <div class="article-content-container" style="background: rgba(255, 255, 255, 0.03); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color);">
                            <div class="article-content" style="color: #ececf1; line-height: 1.8;">
                                ${article.content}
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button onclick="copyFormattedArticle(this.parentNode.parentNode)" style="background: #10a37f; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; font-weight: 500;">
                                <span>üìã</span> Copiar Tudo
                            </button>
                            <button onclick="downloadArticle(this.parentNode.parentNode)" style="background: transparent; border: 1px solid #ececf1; color: #ececf1; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; font-weight: 500;">
                                <span>üì•</span> Baixar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Adicionar a mensagem
            const messageRow = document.createElement('div');
            messageRow.className = 'message-row bot';
            messageRow.innerHTML = `
                <div class="message">
                    <div class="message-avatar">üìÑ</div>
                    <div class="message-content">
                        ${rewrittenContentHtml}
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageRow);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Adicionar controles de edi√ß√£o e bot√£o WordPress ap√≥s um pequeno delay
            setTimeout(() => {
                const contentDiv = messageRow.querySelector('.message-content');
                const resultSection = messageRow.querySelector('.result-section');
                
                // Adicionar ID √∫nico para edi√ß√£o
                const messageId = 'msg-' + Date.now();
                contentDiv.id = messageId;
                contentDiv.dataset.originalContent = rewrittenContentHtml;
                
                // Adicionar controles de edi√ß√£o
                const editControls = document.createElement('div');
                editControls.className = 'edit-controls';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'edit-btn';
                editBtn.innerHTML = '<span>‚úèÔ∏è</span> Editar';
                editBtn.onclick = function() {
                    startEditing(contentDiv);
                };
                
                const exportBtn = document.createElement('button');
                exportBtn.className = 'edit-btn';
                exportBtn.innerHTML = '<span>üìÑ</span> Exportar';
                exportBtn.onclick = function() {
                    exportText(rewrittenContentHtml);
                };
                
                editControls.appendChild(editBtn);
                editControls.appendChild(exportBtn);
                contentDiv.appendChild(editControls);
                
                // Adicionar bot√£o WordPress
                addWordPressPublishButton(resultSection);
                
            }, 100);
            
            showSaveNotification('Mat√©ria carregada com sucesso!');
                })
                .catch(error => {
                    console.error('Erro ao carregar artigo:', error);
                    alert('Erro ao carregar o artigo. Por favor, tente novamente.');
                });
        }
        
        // Publicar um artigo salvo no WordPress
        function publishSavedArticle(articleId) {
            fetch(`/api/articles/${articleId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro ao buscar artigo');
                    }
                    return response.json();
                })
                .then(article => {
                    if (!article) {
                        alert('Artigo n√£o encontrado.');
                        return;
                    }
            
            // Configurar os dados para publica√ß√£o
            document.getElementById('wp-preview-title').textContent = article.title;
            document.getElementById('wp-preview-subtitle').textContent = article.subtitle;
            document.getElementById('wp-preview-tags').textContent = article.tags;
            document.getElementById('wp-preview-keyword').textContent = article.keyword;
            
            // Armazenar o conte√∫do HTML para publica√ß√£o
            document.body.setAttribute('data-publish-content', article.content);
            document.body.setAttribute('data-publish-title', article.title);
            document.body.setAttribute('data-publish-subtitle', article.subtitle);
            document.body.setAttribute('data-publish-tags', article.tags);
            
            // Abrir o modal de publica√ß√£o
            const modal = document.getElementById('wordpress-publish-modal');
            modal.style.display = 'flex';
            
            // Adicionar anima√ß√£o
            setTimeout(() => {
                modal.querySelector('.wordpress-modal-content').style.transform = 'translateY(0)';
                modal.querySelector('.wordpress-modal-content').style.opacity = '1';
            }, 10);
                })
                .catch(error => {
                    console.error('Erro ao buscar artigo para publica√ß√£o:', error);
                    alert('Erro ao buscar o artigo para publica√ß√£o. Por favor, tente novamente.');
                });
        }
        
        // Excluir um artigo salvo
        function deleteSavedArticle(articleId) {
            if (!confirm('Tem certeza que deseja excluir esta mat√©ria?')) {
                return;
            }
            
            fetch(`/api/articles/${articleId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro ao excluir artigo');
                }
                return response.json();
            })
            .then(data => {
                // Atualizar a lista de artigos salvos
                loadSavedArticles();
                
                showSaveNotification('Mat√©ria exclu√≠da com sucesso!');
            })
            .catch(error => {
                console.error('Erro ao excluir artigo:', error);
                alert('Erro ao excluir a mat√©ria. Por favor, tente novamente.');
            });
        }
        
        // Exibir notifica√ß√£o de salvamento
        function showSaveNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'save-notification';
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.background = 'rgba(142, 68, 173, 0.9)';
            notification.style.color = 'white';
            notification.style.padding = '12px 20px';
            notification.style.borderRadius = '5px';
            notification.style.zIndex = '10000';
            notification.style.transform = 'translateY(100px)';
            notification.style.opacity = '0';
            notification.style.transition = 'all 0.3s ease-in-out';
            notification.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
            notification.style.display = 'flex';
            notification.style.alignItems = 'center';
            
            notification.innerHTML = `
                <span style="margin-right: 10px;">üíæ</span>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateY(0)';
                notification.style.opacity = '1';
                
                setTimeout(() => {
                    notification.style.transform = 'translateY(100px)';
                    notification.style.opacity = '0';
                    
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 2500);
            }, 10);
        }
        
        // Inicializar a lista de artigos salvos quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedArticles();
            
            // Adicionar estilos para os artigos salvos
            const style = document.createElement('style');
            style.textContent = `
                .saved-article {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 10px 15px;
                    margin-bottom: 5px;
                }
                
                .saved-article-title {
                    flex: 1;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    font-size: 14px;
                }
                
                .saved-article-actions {
                    display: flex;
                    gap: 5px;
                }
                
                .saved-article-action {
                    background: none;
                    border: none;
                    cursor: pointer;
                    font-size: 14px;
                    padding: 2px;
                    opacity: 0.7;
                    transition: opacity 0.2s;
                }
                
                .saved-article-action:hover {
                    opacity: 1;
                }
                
                .empty-saved-articles {
                    padding: 10px 15px;
                    color: var(--text-secondary);
                    font-style: italic;
                    font-size: 14px;
                }
            `;
            document.head.appendChild(style);
        });

        // Fun√ß√£o para fazer logout
        function logout() {
            fetch('/api/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                window.location.href = '/login.html';
            })
            .catch(error => {
                console.error('Erro ao fazer logout:', error);
                window.location.href = '/login.html';
            });
        }
    </script>
    
    <!-- Modal para reescrita humanizada -->
    <div id="rewrite-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><span style="font-size: 20px;">‚úçÔ∏è</span> Reescrever como mat√©ria humanizada</h3>
                <button class="modal-close" onclick="closeRewriteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Op√ß√µes de Tom e Tamanho -->
                <div style="margin-bottom: 20px;">
                    <div class="rewrite-options-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div class="rewrite-option" style="background-color: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color);">
                            <label for="modal-rewrite-tone" style="font-weight: 500; color: var(--text-primary); margin-bottom: 10px; display: block;">Tom da mat√©ria:</label>
                            <select id="modal-rewrite-tone" style="width: 100%; padding: 12px; border-radius: 6px; background-color: var(--surface-color); color: white; border: 1px solid var(--border-color);">
                                <option value="jornal√≠stico">Jornal√≠stico</option>
                                <option value="informal">Informal</option>
                                <option value="t√©cnico">T√©cnico</option>
                                <option value="opinativo">Opinativo</option>
                            </select>
                        </div>
                        <div class="rewrite-option" style="background-color: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color);">
                            <label for="modal-rewrite-length" style="font-weight: 500; color: var(--text-primary); margin-bottom: 10px; display: block;">Tamanho do texto:</label>
                            <select id="modal-rewrite-length" style="width: 100%; padding: 12px; border-radius: 6px; background-color: var(--surface-color); color: white; border: 1px solid var(--border-color);">
                                <option value="m√©dio">M√©dio</option>
                                <option value="curto">Curto</option>
                                <option value="longo">Longo</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Op√ß√£o de remover subt√≠tulos -->
                <div style="margin-bottom: 20px;">
                    <div class="rewrite-option" style="background-color: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color);">
                        <label class="chat-option-item" style="font-weight: 500; color: var(--text-primary); display: flex; align-items: center; margin-bottom: 0;">
                            <input type="checkbox" id="modal-remove-subtitles" style="width: 18px; height: 18px; margin-right: 10px;">
                            <span style="font-size: 15px;">Remover subt√≠tulos/t√≥picos da mat√©ria</span>
                        </label>
                    </div>
                </div>
                
                <!-- Instru√ß√µes espec√≠ficas -->
                <div style="margin-bottom: 20px;">
                    <div class="rewrite-option" style="background-color: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color);">
                        <label for="modal-rewrite-observation" style="font-weight: 500; color: var(--text-primary); margin-bottom: 10px; display: block;">Instru√ß√µes espec√≠ficas:</label>
                        <textarea id="modal-rewrite-observation" placeholder="Digite instru√ß√µes espec√≠ficas para a reescrita (ex: 'Quero que o ponto central da mat√©ria seja...')" rows="3" style="width: 100%; padding: 12px; border-radius: 6px; background-color: var(--surface-color); color: white; border: 1px solid var(--border-color); min-height: 80px; resize: vertical;"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeRewriteModal()" style="background-color: transparent; border: 1px solid var(--border-color); color: var(--text-primary); padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 14px;">Cancelar</button>
                <button id="modal-start-rewrite-btn" onclick="startRewriteFromModal()" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 16px;">‚úçÔ∏è</span>
                    <span>Iniciar Reescrita</span>
                </button>
            </div>
        </div>
    </div>
</body>
</html>